<div class="wizard-container">
  <!-- Progress Bar -->
  <div class="progress-container">
      <div class="step-indicators">
        <div *ngFor="let step of [1,2,3,4,5,6,7]" 
             [class.active]="step === currentStep"
             [class.completed]="step < currentStep"
             class="step-indicator"
             (click)="goToStep(step)">
          <span class="step-number">{{step}}</span>
        </div>
      </div>
      
      <div class="progress-bar-vertical">
        <div class="progress-vertical" [style.height]="((currentStep - 1) / (totalSteps - 1)) * 100 + '%'"></div>
      </div>
    </div>

  <!-- Step Content -->
  <form class="col-xl-10 col-md-10 col-sm-12" [formGroup]="wizardForm" (ngSubmit)="onSubmit()">
    <!-- STEP 1: InformaciÃ³n General -->
    <div *ngIf="currentStep === 1" class="step-content">
      <h2>InformaciÃ³n General</h2>
      <hr>
      <div class="form-group">
        <label>Â¿CÃ³mo quieres llamar tu chatbot?</label>
        <input
          type="text"
          formControlName="nombre"
          class="form-control"
          placeholder="Nombre del asistente"
        />
      </div>

      <div class="form-group">
        <label>Â¿En quÃ© categorÃ­a encaja mejor tu negocio?</label>
        <select formControlName="categoria" class="form-control">
          <option value="">Selecciona una categorÃ­a</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{cat}}</option>
        </select>
      </div>

      <div class="form-group">
        <label>Â¿En quÃ© idioma va a responder tu chatbot?</label>
        <select formControlName="idioma" class="form-control">
          <option value="es">EspaÃ±ol</option>
          <option value="en">InglÃ©s</option>
          <option value="fr">FrancÃ©s</option>
          <option value="de">AlemÃ¡n</option>
        </select>
      </div>

      <div class="form-group">
        <label>Â¿Quieres subir un avatar o logo para tu bot? (Opcional)</label>
        <file-pond
          #myPond
          [options]="singlepondOptions"
          class="single-fileupload"
          [files]="pondFiles"
          (oninit)="pondHandleInit()"
          (onaddfile)="pondHandleAddFile($event)"
          (onactivatefile)="pondHandleActivateFile($event)"
        >
        </file-pond>
      </div>
    </div>

    <!-- STEP 2: Tono y Personalidad -->
    <div *ngIf="currentStep === 2" class="step-content">
      <h2>Tono y Personalidad</h2>
      <hr>
      <div class="form-group">
        <label>Â¿QuÃ© estilo prefieres?</label>
        <select formControlName="estilo" class="form-control">
          <option value="">Selecciona un estilo</option>
          <option *ngFor="let estilo of estilos" [value]="estilo">
            {{estilo}}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label
          >Â¿QuÃ© tan tÃ©cnico debe ser el chatbot?
          ({{wizardForm.get('nivelTecnico')?.value}}%)</label
        >
        <input
          type="range"
          formControlName="nivelTecnico"
          min="0"
          max="100"
          class="form-range"
        />
        <div class="slider-labels">
          <span>0% = cero tecnicismos</span>
          <span>100% = sÃºper tÃ©cnico</span>
        </div>
      </div>

      <div class="form-group">
        <label>Â¿Quieres que el chatbot use emojis?</label>
        <select formControlName="usoEmojis" class="form-control">
          <option value="">Selecciona una opciÃ³n</option>
          <option *ngFor="let opcion of usoEmojisOptions" [value]="opcion">
            {{opcion}}
          </option>
        </select>
      </div>
    </div>

    <!-- STEP 3: Mensajes AutomÃ¡ticos -->
    <div *ngIf="currentStep === 3" class="step-content">
      <h2>ðŸŸ¦ STEP 3 â€” Mensajes AutomÃ¡ticos</h2>

      <div class="form-group">
        <label>Mensaje de bienvenida:</label>
        <textarea
          formControlName="mensajeBienvenida"
          class="form-control"
          rows="3"
          placeholder="Â¿QuÃ© quieres que el bot diga cuando alguien inicia una conversaciÃ³n?"
        ></textarea>
      </div>

      <div class="form-group">
        <label>Mensaje cuando no estÃ¡s disponible:</label>
        <textarea
          formControlName="mensajeNoDisponible"
          class="form-control"
          rows="3"
          placeholder="Â¿QuÃ© debe responder el bot si alguien escribe fuera de horario?"
        ></textarea>
      </div>

      <div class="form-group">
        <label>Mensaje por ausencia temporal:</label>
        <textarea
          formControlName="mensajeAusencia"
          class="form-control"
          rows="3"
          placeholder="Si no puedes responder por un momento, Â¿quÃ© debe decir?"
        ></textarea>
      </div>

      <div class="form-group">
        <label>Respuestas rÃ¡pidas (opcional):</label>
        <div formArrayName="respuestasRapidas">
          <div
            *ngFor="let respuesta of respuestasRapidas.controls; let i = index"
            class="respuesta-rapida"
          >
            <input
              [formControlName]="i"
              class="form-control"
              placeholder="Ej: Horarios, Tarifas, etc."
            />
            <button
              type="button"
              (click)="removeRespuestaRapida(i)"
              class="btn-remove"
            >
              Ã—
            </button>
          </div>
        </div>
        <button type="button" (click)="addRespuestaRapida()" class="btn-add">
          + Agregar respuesta rÃ¡pida
        </button>
      </div>
    </div>

    <!-- STEP 4: Canales de comunicaciÃ³n -->
    <div *ngIf="currentStep === 4" class="step-content">
      <h2>ðŸŸ¦ STEP 4 â€” Canales de comunicaciÃ³n</h2>

      <div class="form-group">
        <label>Â¿En quÃ© canales deseas activar tu chatbot?</label>
        <div class="checkboxes-group">
          <div *ngFor="let canal of canales" class="checkbox-item">
            <label>
              <input
                type="checkbox"
                [value]="canal"
                (change)="onCanalChange(canal, $event.target.checked)"
              />
              {{canal}}
            </label>
          </div>
        </div>
      </div>

      <div
        *ngIf="canalesArray.value.includes('WhatsApp Business')"
        class="form-group"
      >
        <label
          >Â¿CuÃ¡l es tu nÃºmero de WhatsApp Business para conectar la API?</label
        >
        <input
          type="text"
          formControlName="whatsappBusiness"
          class="form-control"
          placeholder="+34 123 456 789"
        />
      </div>
    </div>

    <!-- STEP 5: Inteligencia / ConfiguraciÃ³n Smart -->
    <div *ngIf="currentStep === 5" class="step-content">
      <h2>ðŸŸ¦ STEP 5 â€” Inteligencia / ConfiguraciÃ³n Smart</h2>

      <div class="form-group">
        <label>Â¿CuÃ¡l es el objetivo principal de tu chatbot?</label>
        <select formControlName="objetivoPrincipal" class="form-control">
          <option value="">Selecciona un objetivo</option>
          <option *ngFor="let objetivo of objetivos" [value]="objetivo">
            {{objetivo}}
          </option>
        </select>
      </div>

      <div class="form-group">
        <label>Â¿QuÃ© preguntas reciben mÃ¡s frecuentemente tus clientes?</label>
        <textarea
          formControlName="preguntasFrecuentes"
          class="form-control"
          rows="4"
          placeholder="Lista las preguntas mÃ¡s comunes separadas por comas"
        ></textarea>
      </div>

      <div class="form-group">
        <label>Â¿Hay temas que NO quieres que el bot responda?</label>
        <textarea
          formControlName="temasExcluidos"
          class="form-control"
          rows="4"
          placeholder="Temas sensibles o informaciÃ³n confidencial"
        ></textarea>
      </div>

      <div class="form-group">
        <label>Â¿Quieres que el bot capture datos?</label>
        <div class="checkboxes-group">
          <div *ngFor="let dato of datosCapturarOptions" class="checkbox-item">
            <label>
              <input
                type="checkbox"
                [value]="dato"
                (change)="onDatoCapturarChange(dato, $event.target.checked)"
              />
              {{dato}}
            </label>
          </div>
        </div>
      </div>
    </div>

    <!-- STEP 6: Vista previa del chatbot -->
    <div *ngIf="currentStep === 6" class="step-content">
      <h2>ðŸŸ¦ STEP 6 â€” Vista previa del chatbot</h2>

      <div class="preview-container">
        <h3>Resumen de tu configuraciÃ³n:</h3>
        <div class="preview-section">
          <h4>InformaciÃ³n General</h4>
          <p><strong>Nombre:</strong> {{wizardForm.get('nombre')?.value}}</p>
          <p>
            <strong>CategorÃ­a:</strong> {{wizardForm.get('categoria')?.value}}
          </p>
          <p><strong>Idioma:</strong> {{wizardForm.get('idioma')?.value}}</p>
        </div>

        <div class="preview-section">
          <h4>Tono y Personalidad</h4>
          <p><strong>Estilo:</strong> {{wizardForm.get('estilo')?.value}}</p>
          <p>
            <strong>Nivel TÃ©cnico:</strong>
            {{wizardForm.get('nivelTecnico')?.value}}%
          </p>
          <p>
            <strong>Uso de Emojis:</strong>
            {{wizardForm.get('usoEmojis')?.value}}
          </p>
        </div>

        <div class="question-section">
          <p>
            <strong
              >Â¿Quieres editar algo del comportamiento antes de
              continuar?</strong
            >
          </p>
          <button type="button" (click)="goToStep(1)" class="btn-edit">
            Volver a pasos anteriores
          </button>
        </div>
      </div>
    </div>

    <!-- STEP 7: ConfirmaciÃ³n y ActivaciÃ³n -->
    <div *ngIf="currentStep === 7" class="step-content">
      <h2>ðŸŸ¦ STEP 7 â€” ConfirmaciÃ³n y ActivaciÃ³n</h2>

      <div class="form-group">
        <label>Â¿Deseas guardar y activar tu chatbot ahora?</label>
        <select formControlName="estadoActivacion" class="form-control">
          <option value="">Selecciona una opciÃ³n</option>
          <option *ngFor="let estado of estadosActivacion" [value]="estado">
            {{estado}}
          </option>
        </select>
      </div>

      <div class="action-buttons">
        <button type="button" class="btn-test">Probar bot</button>
        <button type="submit" class="btn-submit" [disabled]="!wizardForm.valid">
          Finalizar ConfiguraciÃ³n
        </button>
      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="navigation-buttons">
      <button
        type="button"
        (click)="prevStep()"
        [disabled]="currentStep === 1"
        class="btn-prev"
      >
        Anterior
      </button>

      <button
        *ngIf="currentStep < totalSteps"
        type="button"
        (click)="nextStep()"
        [disabled]="!isStepValid(currentStep)"
        class="btn-next"
      >
        Siguiente
      </button>
    </div>
  </form>
</div>
