import{A as El,B as so,C as wi,D as by,E as Cy,F as W,G as ht,H as Fe,I as Vh,J as Ry,K as oo,L as te,M as _t,N as Tl,O as Oh,P as Ct,Q as Mn,R as Cr,S as Il,T as Al,U as Py,V as Dt,W as Me,a as V,b as yi,c as gl,d as vy,e as wy,f as Nh,g as qe,h as vi,i as ml,j as _l,k as yl,l as io,m as kh,n as Ey,o as Gt,p as xh,q as Dh,r as vl,s as Ty,t as Iy,u as wl,v as Ne,w as Ay,x as Sy,y as bt,z as Fn}from"./chunk-O7F3PPF3.js";import{d as Se}from"./chunk-42GC3H2R.js";import{B as to,D as no,Da as yy,La as Vn,M as hl,Q as dy,S as dl,T as br,U as fy,V as Rh,Wc as ro,X as py,Y as fl,Z as un,Za as We,_ as Ph,b as Nn,d as uy,da as gy,ea as my,fa as _y,h as _i,i as hy,ia as xn,jb as On,ka as Dn,l as eo,la as Be,m as ul,ma as K,n as kn,na as it,o as jt,qa as hn,s as Ie,ud as pl}from"./chunk-DT3HLPPQ.js";import{a as mi,b as Zs}from"./chunk-VB56BUGO.js";var aS="firebase",lS="11.10.0";Dt(aS,lS,"app");var zt=new my("ANGULARFIRE2_VERSION");var Ny=(n,e)=>{let t=e?[e]:Py(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Fh=(function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n})(Fh||{}),wk=ro()&&typeof Zone<"u"?Fh.WARN:Fh.SILENT;var Sl=class{zone;delegate;constructor(e,t=hy){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i?i.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])};return this.delegate.schedule(s,t,r)}},Rr=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=it(We);this.outsideAngular=t.runOutsideAngular(()=>new Sl(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new Sl(typeof Zone>"u"?void 0:Zone.current,_i))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=xn({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var cS="firebase",uS="11.10.0";Me.registerVersion(cS,uS,"app-compat");var hS=["ngOnDestroy"],xy=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(hS.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let c=a?.[s];return typeof c=="function"?c.bind(a):c?.then?c.then(u=>t.run(()=>u)):t.run(()=>c)});return new Proxy(()=>{},{get:(a,c)=>o[c],apply:(a,c,u)=>o.then(d=>{let p=d?.(...u);return r?.spy?.apply&&r.spy.apply(s,u,p),p})})})});var Cl=class{constructor(e){return e}},Ln=new Be("angularfire2.app.options"),Un=new Be("angularfire2.app.name");function Pr(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Me.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Me.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;dS("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Cl(o)}var dS=(n,...e)=>{ro()&&typeof console<"u"&&console[n](...e)},fS={provide:Cl,useFactory:Pr,deps:[Ln,We,[new yy,Un]]},Pk=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Ln,useValue:t},{provide:Un,useValue:r}]}}constructor(t){Me.registerVersion("angularfire",zt.full,"core"),Me.registerVersion("angularfire",zt.full,"app-compat"),Me.registerVersion("angular",_y.full,t.toString())}static \u0275fac=function(r){return new(r||n)(K(Vn))};static \u0275mod=On({type:n});static \u0275inj=Dn({providers:[fS]})}return n})();function Ei(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return pS(i,o)||(ky("error",`${e} was already initialized on the ${t} Firebase App with different settings.${gS?" You may need to reload as Firebase is not HMR aware.":""}`),ky("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function pS(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var gS=typeof module<"u"&&!!module.hot,ky=(n,...e)=>{ro()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var mS=new Map,_S={activated:!1,tokenObservers:[]},yS={initialized:!1,enabled:!1};function Vt(n){return mS.get(n)||Object.assign({},_S)}function Ly(){return yS}var vS="https://content-firebaseappcheck.googleapis.com/v1";var wS="exchangeDebugToken",Dy={OFFSET_DURATION:300*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},Mk=1440*60*1e3;var Bh=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new qe,this.pending.promise.catch(t=>{}),await ES(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new qe,this.pending.promise.catch(t=>{}),await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function ES(n){return new Promise(e=>{setTimeout(e,n)})}var TS={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},Bn=new Iy("appCheck","AppCheck",TS);function Uy(n){if(!Vt(n).activated)throw Bn.create("use-before-activation",{appName:n.name})}async function By({url:n,body:e},t){let r={"Content-Type":"application/json"},i=t.getImmediate({optional:!0});if(i){let p=await i.getHeartbeatsHeader();p&&(r["X-Firebase-Client"]=p)}let s={method:"POST",body:JSON.stringify(e),headers:r},o;try{o=await fetch(n,s)}catch(p){throw Bn.create("fetch-network-error",{originalErrorMessage:p?.message})}if(o.status!==200)throw Bn.create("fetch-status-error",{httpStatus:o.status});let a;try{a=await o.json()}catch(p){throw Bn.create("fetch-parse-error",{originalErrorMessage:p?.message})}let c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw Bn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});let u=Number(c[1])*1e3,d=Date.now();return{token:a.token,expireTimeMillis:d+u,issuedAtTimeMillis:d}}function qy(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${vS}/projects/${t}/apps/${r}:${wS}?key=${i}`,body:{debug_token:e}}}var IS="firebase-app-check-database",AS=1,qh="firebase-app-check-store";var Rl=null;function SS(){return Rl||(Rl=new Promise((n,e)=>{try{let t=indexedDB.open(IS,AS);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(Bn.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(qh,{keyPath:"compositeKey"})}}}catch(t){e(Bn.create("storage-open",{originalErrorMessage:t?.message}))}}),Rl)}function bS(n,e){return CS(RS(n),e)}async function CS(n,e){let r=(await SS()).transaction(qh,"readwrite"),s=r.objectStore(qh).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},r.onerror=c=>{var u;a(Bn.create("storage-set",{originalErrorMessage:(u=c.target.error)===null||u===void 0?void 0:u.message}))}})}function RS(n){return`${n.options.appId}-${n.name}`}var ao=new Mn("@firebase/app-check");function Lh(n,e){return vl()?bS(n,e).catch(t=>{ao.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function jy(){return Ly().enabled}async function Gy(){let n=Ly();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}var PS={error:"UNKNOWN_ERROR"};function NS(n){return gl.encodeString(JSON.stringify(n),!1)}async function jh(n,e=!1,t=!1){let r=n.app;Uy(r);let i=Vt(r),s=i.token,o;if(s&&!lo(s)&&(i.token=void 0,s=void 0),!s){let u=await i.cachedTokenPromise;u&&(lo(u)?s=u:await Lh(r,void 0))}if(!e&&s&&lo(s))return{token:s.token};let a=!1;if(jy())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=By(qy(r,await Gy()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),a=!0);let u=await i.exchangeTokenPromise;return await Lh(r,u),i.token=u,{token:u.token}}catch(u){return u.code==="appCheck/throttled"||u.code==="appCheck/initial-throttle"?ao.warn(u.message):t&&ao.error(u),Uh(u)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),a=!0),s=await Vt(r).exchangeTokenPromise}catch(u){u.code==="appCheck/throttled"||u.code==="appCheck/initial-throttle"?ao.warn(u.message):t&&ao.error(u),o=u}let c;return s?o?lo(s)?c={token:s.token,internalError:o}:c=Uh(o):(c={token:s.token},i.token=s,await Lh(r,s)):c=Uh(o),a&&VS(r,c),c}async function kS(n){let e=n.app;Uy(e);let{provider:t}=Vt(e);if(jy()){let r=await Gy(),{token:i}=await By(qy(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=await t.getToken();return{token:r}}}function xS(n,e,t,r){let{app:i}=n,s=Vt(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&lo(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Vy(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Vy(n))}function zy(n,e){let t=Vt(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Vy(n){let{app:e}=n,t=Vt(e),r=t.tokenRefresher;r||(r=DS(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function DS(n){let{app:e}=n;return new Bh(async()=>{let t=Vt(e),r;if(t.token?r=await jh(n,!0):r=await jh(n),r.error)throw r.error;if(r.internalError)throw r.internalError},()=>!0,()=>{let t=Vt(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-300*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Dy.RETRIAL_MIN_WAIT,Dy.RETRIAL_MAX_WAIT)}function VS(n,e){let t=Vt(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function lo(n){return n.expireTimeMillis-Date.now()>0}function Uh(n){return{token:NS(PS),error:n}}var Gh=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Vt(this.app);for(let t of e)zy(this.app,t.next);return Promise.resolve()}};function OS(n,e){return new Gh(n,e)}function FS(n){return{getToken:e=>jh(n,e),getLimitedUseToken:()=>kS(n),addTokenListener:e=>xS(n,"INTERNAL",e),removeTokenListener:e=>zy(n.app,e)}}var MS="@firebase/app-check",LS="0.10.1";var US="app-check",Oy="app-check-internal";function BS(){Cr(new _t(US,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return OS(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Oy).initialize()})),Cr(new _t(Oy,n=>{let e=n.getProvider("app-check").getImmediate();return FS(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Dt(MS,LS)}BS();var qS="app-check";var qn=class{constructor(){return Ny(qS)}};var jS=["localhost","0.0.0.0","127.0.0.1"],Xk=typeof window<"u"&&jS.includes(window.location.hostname);var co=new Be("angularfire2.auth.use-emulator"),uo=new Be("angularfire2.auth.settings"),ho=new Be("angularfire2.auth.tenant-id"),fo=new Be("angularfire2.auth.langugage-code"),po=new Be("angularfire2.auth.use-device-language"),go=new Be("angularfire.auth.persistence"),mo=(n,e,t,r,i,s,o,a)=>Ei(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let c=e.runOutsideAngular(()=>n.auth());if(t&&c.useEmulator(...t),r&&(c.tenantId=r),c.languageCode=i,s&&c.useDeviceLanguage(),o)for(let[u,d]of Object.entries(o))c.settings[u]=d;return a&&c.setPersistence(a),c},[t,r,i,s,o,a]),_o=(()=>{class n{injector=it(hn);authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,c,u,d,p,g,y){let S=new uy,N=jt(void 0).pipe(eo(o.outsideAngular),un(()=>s.runOutsideAngular(()=>import("./chunk-GIJ25ECK.js"))),Ie(()=>Pr(t,s,r)),Ie(k=>mo(k,s,a,u,d,p,c,g)),Rh({bufferSize:1,refCount:!1}));if(pl(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=jt(null);else{N.pipe(dy()).subscribe();let k=N.pipe(un(O=>O.getRedirectResult().then(z=>z,()=>null)),Se(this.injector),Rh({bufferSize:1,refCount:!1})),q=N.pipe(un(O=>new Nn(z=>({unsubscribe:s.runOutsideAngular(()=>O.onAuthStateChanged(Q=>z.next(Q),Q=>z.error(Q),()=>z.complete()))})))),B=N.pipe(un(O=>new Nn(z=>({unsubscribe:s.runOutsideAngular(()=>O.onIdTokenChanged(Q=>z.next(Q),Q=>z.error(Q),()=>z.complete()))}))));this.authState=k.pipe(Ph(q),ul(o.outsideAngular),eo(o.insideAngular)),this.user=k.pipe(Ph(B),ul(o.outsideAngular),eo(o.insideAngular)),this.idToken=this.user.pipe(un(O=>O?kn(O.getIdToken()):jt(null))),this.idTokenResult=this.user.pipe(un(O=>O?kn(O.getIdTokenResult()):jt(null))),this.credential=to(k,S,this.authState.pipe(no(O=>!O))).pipe(Ie(O=>O?.user?O:null),ul(o.outsideAngular),eo(o.insideAngular))}return xy(this,N,s,{spy:{apply:(k,q,B)=>{(k.startsWith("signIn")||k.startsWith("createUser"))&&B.then(O=>S.next(O))}}})}static \u0275fac=function(r){return new(r||n)(K(Ln),K(Un,8),K(Vn),K(We),K(Rr),K(co,8),K(uo,8),K(ho,8),K(fo,8),K(po,8),K(go,8),K(qn,8))};static \u0275prov=xn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),fx=(()=>{class n{constructor(){Me.registerVersion("angularfire",zt.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=On({type:n});static \u0275inj=Dn({providers:[_o]})}return n})();var Ky=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$y={};var dn,Wh;(function(){var n;function e(E,_){function w(){}w.prototype=_.prototype,E.D=_.prototype,E.prototype=new w,E.prototype.constructor=E,E.C=function(T,I,b){for(var v=Array(arguments.length-2),an=2;an<arguments.length;an++)v[an-2]=arguments[an];return _.prototype[I].apply(T,v)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(E,_,w){w||(w=0);var T=Array(16);if(typeof _=="string")for(var I=0;16>I;++I)T[I]=_.charCodeAt(w++)|_.charCodeAt(w++)<<8|_.charCodeAt(w++)<<16|_.charCodeAt(w++)<<24;else for(I=0;16>I;++I)T[I]=_[w++]|_[w++]<<8|_[w++]<<16|_[w++]<<24;_=E.g[0],w=E.g[1],I=E.g[2];var b=E.g[3],v=_+(b^w&(I^b))+T[0]+3614090360&4294967295;_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+T[1]+3905402710&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+T[2]+606105819&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+T[3]+3250441966&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(b^w&(I^b))+T[4]+4118548399&4294967295,_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+T[5]+1200080426&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+T[6]+2821735955&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+T[7]+4249261313&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(b^w&(I^b))+T[8]+1770035416&4294967295,_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+T[9]+2336552879&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+T[10]+4294925233&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+T[11]+2304563134&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(b^w&(I^b))+T[12]+1804603682&4294967295,_=w+(v<<7&4294967295|v>>>25),v=b+(I^_&(w^I))+T[13]+4254626195&4294967295,b=_+(v<<12&4294967295|v>>>20),v=I+(w^b&(_^w))+T[14]+2792965006&4294967295,I=b+(v<<17&4294967295|v>>>15),v=w+(_^I&(b^_))+T[15]+1236535329&4294967295,w=I+(v<<22&4294967295|v>>>10),v=_+(I^b&(w^I))+T[1]+4129170786&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+T[6]+3225465664&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+T[11]+643717713&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+T[0]+3921069994&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^b&(w^I))+T[5]+3593408605&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+T[10]+38016083&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+T[15]+3634488961&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+T[4]+3889429448&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^b&(w^I))+T[9]+568446438&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+T[14]+3275163606&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+T[3]+4107603335&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+T[8]+1163531501&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(I^b&(w^I))+T[13]+2850285829&4294967295,_=w+(v<<5&4294967295|v>>>27),v=b+(w^I&(_^w))+T[2]+4243563512&4294967295,b=_+(v<<9&4294967295|v>>>23),v=I+(_^w&(b^_))+T[7]+1735328473&4294967295,I=b+(v<<14&4294967295|v>>>18),v=w+(b^_&(I^b))+T[12]+2368359562&4294967295,w=I+(v<<20&4294967295|v>>>12),v=_+(w^I^b)+T[5]+4294588738&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+T[8]+2272392833&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+T[11]+1839030562&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+T[14]+4259657740&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^b)+T[1]+2763975236&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+T[4]+1272893353&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+T[7]+4139469664&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+T[10]+3200236656&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^b)+T[13]+681279174&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+T[0]+3936430074&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+T[3]+3572445317&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+T[6]+76029189&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(w^I^b)+T[9]+3654602809&4294967295,_=w+(v<<4&4294967295|v>>>28),v=b+(_^w^I)+T[12]+3873151461&4294967295,b=_+(v<<11&4294967295|v>>>21),v=I+(b^_^w)+T[15]+530742520&4294967295,I=b+(v<<16&4294967295|v>>>16),v=w+(I^b^_)+T[2]+3299628645&4294967295,w=I+(v<<23&4294967295|v>>>9),v=_+(I^(w|~b))+T[0]+4096336452&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+T[7]+1126891415&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+T[14]+2878612391&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+T[5]+4237533241&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~b))+T[12]+1700485571&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+T[3]+2399980690&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+T[10]+4293915773&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+T[1]+2240044497&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~b))+T[8]+1873313359&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+T[15]+4264355552&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+T[6]+2734768916&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+T[13]+1309151649&4294967295,w=I+(v<<21&4294967295|v>>>11),v=_+(I^(w|~b))+T[4]+4149444226&4294967295,_=w+(v<<6&4294967295|v>>>26),v=b+(w^(_|~I))+T[11]+3174756917&4294967295,b=_+(v<<10&4294967295|v>>>22),v=I+(_^(b|~w))+T[2]+718787259&4294967295,I=b+(v<<15&4294967295|v>>>17),v=w+(b^(I|~_))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+_&4294967295,E.g[1]=E.g[1]+(I+(v<<21&4294967295|v>>>11))&4294967295,E.g[2]=E.g[2]+I&4294967295,E.g[3]=E.g[3]+b&4294967295}r.prototype.u=function(E,_){_===void 0&&(_=E.length);for(var w=_-this.blockSize,T=this.B,I=this.h,b=0;b<_;){if(I==0)for(;b<=w;)i(this,E,b),b+=this.blockSize;if(typeof E=="string"){for(;b<_;)if(T[I++]=E.charCodeAt(b++),I==this.blockSize){i(this,T),I=0;break}}else for(;b<_;)if(T[I++]=E[b++],I==this.blockSize){i(this,T),I=0;break}}this.h=I,this.o+=_},r.prototype.v=function(){var E=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);E[0]=128;for(var _=1;_<E.length-8;++_)E[_]=0;var w=8*this.o;for(_=E.length-8;_<E.length;++_)E[_]=w&255,w/=256;for(this.u(E),E=Array(16),_=w=0;4>_;++_)for(var T=0;32>T;T+=8)E[w++]=this.g[_]>>>T&255;return E};function s(E,_){var w=a;return Object.prototype.hasOwnProperty.call(w,E)?w[E]:w[E]=_(E)}function o(E,_){this.h=_;for(var w=[],T=!0,I=E.length-1;0<=I;I--){var b=E[I]|0;T&&b==_||(w[I]=b,T=!1)}this.g=w}var a={};function c(E){return-128<=E&&128>E?s(E,function(_){return new o([_|0],0>_?-1:0)}):new o([E|0],0>E?-1:0)}function u(E){if(isNaN(E)||!isFinite(E))return p;if(0>E)return k(u(-E));for(var _=[],w=1,T=0;E>=w;T++)_[T]=E/w|0,w*=4294967296;return new o(_,0)}function d(E,_){if(E.length==0)throw Error("number format error: empty string");if(_=_||10,2>_||36<_)throw Error("radix out of range: "+_);if(E.charAt(0)=="-")return k(d(E.substring(1),_));if(0<=E.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=u(Math.pow(_,8)),T=p,I=0;I<E.length;I+=8){var b=Math.min(8,E.length-I),v=parseInt(E.substring(I,I+b),_);8>b?(b=u(Math.pow(_,b)),T=T.j(b).add(u(v))):(T=T.j(w),T=T.add(u(v)))}return T}var p=c(0),g=c(1),y=c(16777216);n=o.prototype,n.m=function(){if(N(this))return-k(this).m();for(var E=0,_=1,w=0;w<this.g.length;w++){var T=this.i(w);E+=(0<=T?T:4294967296+T)*_,_*=4294967296}return E},n.toString=function(E){if(E=E||10,2>E||36<E)throw Error("radix out of range: "+E);if(S(this))return"0";if(N(this))return"-"+k(this).toString(E);for(var _=u(Math.pow(E,6)),w=this,T="";;){var I=z(w,_).g;w=q(w,I.j(_));var b=((0<w.g.length?w.g[0]:w.h)>>>0).toString(E);if(w=I,S(w))return b+T;for(;6>b.length;)b="0"+b;T=b+T}},n.i=function(E){return 0>E?0:E<this.g.length?this.g[E]:this.h};function S(E){if(E.h!=0)return!1;for(var _=0;_<E.g.length;_++)if(E.g[_]!=0)return!1;return!0}function N(E){return E.h==-1}n.l=function(E){return E=q(this,E),N(E)?-1:S(E)?0:1};function k(E){for(var _=E.g.length,w=[],T=0;T<_;T++)w[T]=~E.g[T];return new o(w,~E.h).add(g)}n.abs=function(){return N(this)?k(this):this},n.add=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0,I=0;I<=_;I++){var b=T+(this.i(I)&65535)+(E.i(I)&65535),v=(b>>>16)+(this.i(I)>>>16)+(E.i(I)>>>16);T=v>>>16,b&=65535,v&=65535,w[I]=v<<16|b}return new o(w,w[w.length-1]&-2147483648?-1:0)};function q(E,_){return E.add(k(_))}n.j=function(E){if(S(this)||S(E))return p;if(N(this))return N(E)?k(this).j(k(E)):k(k(this).j(E));if(N(E))return k(this.j(k(E)));if(0>this.l(y)&&0>E.l(y))return u(this.m()*E.m());for(var _=this.g.length+E.g.length,w=[],T=0;T<2*_;T++)w[T]=0;for(T=0;T<this.g.length;T++)for(var I=0;I<E.g.length;I++){var b=this.i(T)>>>16,v=this.i(T)&65535,an=E.i(I)>>>16,Vs=E.i(I)&65535;w[2*T+2*I]+=v*Vs,B(w,2*T+2*I),w[2*T+2*I+1]+=b*Vs,B(w,2*T+2*I+1),w[2*T+2*I+1]+=v*an,B(w,2*T+2*I+1),w[2*T+2*I+2]+=b*an,B(w,2*T+2*I+2)}for(T=0;T<_;T++)w[T]=w[2*T+1]<<16|w[2*T];for(T=_;T<2*_;T++)w[T]=0;return new o(w,0)};function B(E,_){for(;(E[_]&65535)!=E[_];)E[_+1]+=E[_]>>>16,E[_]&=65535,_++}function O(E,_){this.g=E,this.h=_}function z(E,_){if(S(_))throw Error("division by zero");if(S(E))return new O(p,p);if(N(E))return _=z(k(E),_),new O(k(_.g),k(_.h));if(N(_))return _=z(E,k(_)),new O(k(_.g),_.h);if(30<E.g.length){if(N(E)||N(_))throw Error("slowDivide_ only works with positive integers.");for(var w=g,T=_;0>=T.l(E);)w=Q(w),T=Q(T);var I=H(w,1),b=H(T,1);for(T=H(T,2),w=H(w,2);!S(T);){var v=b.add(T);0>=v.l(E)&&(I=I.add(w),b=v),T=H(T,1),w=H(w,1)}return _=q(E,I.j(_)),new O(I,_)}for(I=p;0<=E.l(_);){for(w=Math.max(1,Math.floor(E.m()/_.m())),T=Math.ceil(Math.log(w)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),b=u(w),v=b.j(_);N(v)||0<v.l(E);)w-=T,b=u(w),v=b.j(_);S(b)&&(b=g),I=I.add(b),E=q(E,v)}return new O(I,E)}n.A=function(E){return z(this,E).h},n.and=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0;T<_;T++)w[T]=this.i(T)&E.i(T);return new o(w,this.h&E.h)},n.or=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0;T<_;T++)w[T]=this.i(T)|E.i(T);return new o(w,this.h|E.h)},n.xor=function(E){for(var _=Math.max(this.g.length,E.g.length),w=[],T=0;T<_;T++)w[T]=this.i(T)^E.i(T);return new o(w,this.h^E.h)};function Q(E){for(var _=E.g.length+1,w=[],T=0;T<_;T++)w[T]=E.i(T)<<1|E.i(T-1)>>>31;return new o(w,E.h)}function H(E,_){var w=_>>5;_%=32;for(var T=E.g.length-w,I=[],b=0;b<T;b++)I[b]=0<_?E.i(b+w)>>>_|E.i(b+w+1)<<32-_:E.i(b+w);return new o(I,E.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Wh=$y.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=d,dn=$y.Integer=o}).apply(typeof Ky<"u"?Ky:typeof self<"u"?self:typeof window<"u"?window:{});var Pl=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fn={};var Kh,GS,Ti,$h,yo,Nl,Qh,Hh,Yh;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(l,h,f){return l==Array.prototype||l==Object.prototype||(l[h]=f.value),l};function t(l){l=[typeof globalThis=="object"&&globalThis,l,typeof window=="object"&&window,typeof self=="object"&&self,typeof Pl=="object"&&Pl];for(var h=0;h<l.length;++h){var f=l[h];if(f&&f.Math==Math)return f}throw Error("Cannot find global object")}var r=t(this);function i(l,h){if(h)e:{var f=r;l=l.split(".");for(var m=0;m<l.length-1;m++){var A=l[m];if(!(A in f))break e;f=f[A]}l=l[l.length-1],m=f[l],h=h(m),h!=m&&h!=null&&e(f,l,{configurable:!0,writable:!0,value:h})}}function s(l,h){l instanceof String&&(l+="");var f=0,m=!1,A={next:function(){if(!m&&f<l.length){var P=f++;return{value:h(P,l[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return A[Symbol.iterator]=function(){return A},A}i("Array.prototype.values",function(l){return l||function(){return s(this,function(h,f){return f})}});var o=o||{},a=this||self;function c(l){var h=typeof l;return h=h!="object"?h:l?Array.isArray(l)?"array":h:"null",h=="array"||h=="object"&&typeof l.length=="number"}function u(l){var h=typeof l;return h=="object"&&l!=null||h=="function"}function d(l,h,f){return l.call.apply(l.bind,arguments)}function p(l,h,f){if(!l)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var A=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(A,m),l.apply(h,A)}}return function(){return l.apply(h,arguments)}}function g(l,h,f){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?d:p,g.apply(null,arguments)}function y(l,h){var f=Array.prototype.slice.call(arguments,1);return function(){var m=f.slice();return m.push.apply(m,arguments),l.apply(this,m)}}function S(l,h){function f(){}f.prototype=h.prototype,l.aa=h.prototype,l.prototype=new f,l.prototype.constructor=l,l.Qb=function(m,A,P){for(var F=Array(arguments.length-2),de=2;de<arguments.length;de++)F[de-2]=arguments[de];return h.prototype[A].apply(m,F)}}function N(l){let h=l.length;if(0<h){let f=Array(h);for(let m=0;m<h;m++)f[m]=l[m];return f}return[]}function k(l,h){for(let f=1;f<arguments.length;f++){let m=arguments[f];if(c(m)){let A=l.length||0,P=m.length||0;l.length=A+P;for(let F=0;F<P;F++)l[A+F]=m[F]}else l.push(m)}}class q{constructor(h,f){this.i=h,this.j=f,this.h=0,this.g=null}get(){let h;return 0<this.h?(this.h--,h=this.g,this.g=h.next,h.next=null):h=this.i(),h}}function B(l){return/^[\s\xa0]*$/.test(l)}function O(){var l=a.navigator;return l&&(l=l.userAgent)?l:""}function z(l){return z[" "](l),l}z[" "]=function(){};var Q=O().indexOf("Gecko")!=-1&&!(O().toLowerCase().indexOf("webkit")!=-1&&O().indexOf("Edge")==-1)&&!(O().indexOf("Trident")!=-1||O().indexOf("MSIE")!=-1)&&O().indexOf("Edge")==-1;function H(l,h,f){for(let m in l)h.call(f,l[m],m,l)}function E(l,h){for(let f in l)h.call(void 0,l[f],f,l)}function _(l){let h={};for(let f in l)h[f]=l[f];return h}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(l,h){let f,m;for(let A=1;A<arguments.length;A++){m=arguments[A];for(f in m)l[f]=m[f];for(let P=0;P<w.length;P++)f=w[P],Object.prototype.hasOwnProperty.call(m,f)&&(l[f]=m[f])}}function I(l){var h=1;l=l.split(":");let f=[];for(;0<h&&l.length;)f.push(l.shift()),h--;return l.length&&f.push(l.join(":")),f}function b(l){a.setTimeout(()=>{throw l},0)}function v(){var l=rh;let h=null;return l.g&&(h=l.g,l.g=l.g.next,l.g||(l.h=null),h.next=null),h}class an{constructor(){this.h=this.g=null}add(h,f){let m=Vs.get();m.set(h,f),this.h?this.h.next=m:this.g=m,this.h=m}}var Vs=new q(()=>new C0,l=>l.reset());class C0{constructor(){this.next=this.g=this.h=null}set(h,f){this.h=h,this.g=f,this.next=null}reset(){this.next=this.g=this.h=null}}let Os,Fs=!1,rh=new an,c_=()=>{let l=a.Promise.resolve(void 0);Os=()=>{l.then(R0)}};var R0=()=>{for(var l;l=v();){try{l.h.call(l.g)}catch(f){b(f)}var h=Vs;h.j(l),100>h.h&&(h.h++,l.next=h.g,h.g=l)}Fs=!1};function bn(){this.s=this.s,this.C=this.C}bn.prototype.s=!1,bn.prototype.ma=function(){this.s||(this.s=!0,this.N())},bn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Qe(l,h){this.type=l,this.g=this.target=h,this.defaultPrevented=!1}Qe.prototype.h=function(){this.defaultPrevented=!0};var P0=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var l=!1,h=Object.defineProperty({},"passive",{get:function(){l=!0}});try{let f=()=>{};a.addEventListener("test",f,h),a.removeEventListener("test",f,h)}catch{}return l})();function Ms(l,h){if(Qe.call(this,l?l.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,l){var f=this.type=l.type,m=l.changedTouches&&l.changedTouches.length?l.changedTouches[0]:null;if(this.target=l.target||l.srcElement,this.g=h,h=l.relatedTarget){if(Q){e:{try{z(h.nodeName);var A=!0;break e}catch{}A=!1}A||(h=null)}}else f=="mouseover"?h=l.fromElement:f=="mouseout"&&(h=l.toElement);this.relatedTarget=h,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=l.clientX!==void 0?l.clientX:l.pageX,this.clientY=l.clientY!==void 0?l.clientY:l.pageY,this.screenX=l.screenX||0,this.screenY=l.screenY||0),this.button=l.button,this.key=l.key||"",this.ctrlKey=l.ctrlKey,this.altKey=l.altKey,this.shiftKey=l.shiftKey,this.metaKey=l.metaKey,this.pointerId=l.pointerId||0,this.pointerType=typeof l.pointerType=="string"?l.pointerType:N0[l.pointerType]||"",this.state=l.state,this.i=l,l.defaultPrevented&&Ms.aa.h.call(this)}}S(Ms,Qe);var N0={2:"touch",3:"pen",4:"mouse"};Ms.prototype.h=function(){Ms.aa.h.call(this);var l=this.i;l.preventDefault?l.preventDefault():l.returnValue=!1};var Ls="closure_listenable_"+(1e6*Math.random()|0),k0=0;function x0(l,h,f,m,A){this.listener=l,this.proxy=null,this.src=h,this.type=f,this.capture=!!m,this.ha=A,this.key=++k0,this.da=this.fa=!1}function $a(l){l.da=!0,l.listener=null,l.proxy=null,l.src=null,l.ha=null}function Qa(l){this.src=l,this.g={},this.h=0}Qa.prototype.add=function(l,h,f,m,A){var P=l.toString();l=this.g[P],l||(l=this.g[P]=[],this.h++);var F=sh(l,h,m,A);return-1<F?(h=l[F],f||(h.fa=!1)):(h=new x0(h,this.src,P,!!m,A),h.fa=f,l.push(h)),h};function ih(l,h){var f=h.type;if(f in l.g){var m=l.g[f],A=Array.prototype.indexOf.call(m,h,void 0),P;(P=0<=A)&&Array.prototype.splice.call(m,A,1),P&&($a(h),l.g[f].length==0&&(delete l.g[f],l.h--))}}function sh(l,h,f,m){for(var A=0;A<l.length;++A){var P=l[A];if(!P.da&&P.listener==h&&P.capture==!!f&&P.ha==m)return A}return-1}var oh="closure_lm_"+(1e6*Math.random()|0),ah={};function u_(l,h,f,m,A){if(m&&m.once)return d_(l,h,f,m,A);if(Array.isArray(h)){for(var P=0;P<h.length;P++)u_(l,h[P],f,m,A);return null}return f=hh(f),l&&l[Ls]?l.K(h,f,u(m)?!!m.capture:!!m,A):h_(l,h,f,!1,m,A)}function h_(l,h,f,m,A,P){if(!h)throw Error("Invalid event type");var F=u(A)?!!A.capture:!!A,de=ch(l);if(de||(l[oh]=de=new Qa(l)),f=de.add(h,f,m,F,P),f.proxy)return f;if(m=D0(),f.proxy=m,m.src=l,m.listener=f,l.addEventListener)P0||(A=F),A===void 0&&(A=!1),l.addEventListener(h.toString(),m,A);else if(l.attachEvent)l.attachEvent(p_(h.toString()),m);else if(l.addListener&&l.removeListener)l.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return f}function D0(){function l(f){return h.call(l.src,l.listener,f)}let h=V0;return l}function d_(l,h,f,m,A){if(Array.isArray(h)){for(var P=0;P<h.length;P++)d_(l,h[P],f,m,A);return null}return f=hh(f),l&&l[Ls]?l.L(h,f,u(m)?!!m.capture:!!m,A):h_(l,h,f,!0,m,A)}function f_(l,h,f,m,A){if(Array.isArray(h))for(var P=0;P<h.length;P++)f_(l,h[P],f,m,A);else m=u(m)?!!m.capture:!!m,f=hh(f),l&&l[Ls]?(l=l.i,h=String(h).toString(),h in l.g&&(P=l.g[h],f=sh(P,f,m,A),-1<f&&($a(P[f]),Array.prototype.splice.call(P,f,1),P.length==0&&(delete l.g[h],l.h--)))):l&&(l=ch(l))&&(h=l.g[h.toString()],l=-1,h&&(l=sh(h,f,m,A)),(f=-1<l?h[l]:null)&&lh(f))}function lh(l){if(typeof l!="number"&&l&&!l.da){var h=l.src;if(h&&h[Ls])ih(h.i,l);else{var f=l.type,m=l.proxy;h.removeEventListener?h.removeEventListener(f,m,l.capture):h.detachEvent?h.detachEvent(p_(f),m):h.addListener&&h.removeListener&&h.removeListener(m),(f=ch(h))?(ih(f,l),f.h==0&&(f.src=null,h[oh]=null)):$a(l)}}}function p_(l){return l in ah?ah[l]:ah[l]="on"+l}function V0(l,h){if(l.da)l=!0;else{h=new Ms(h,this);var f=l.listener,m=l.ha||l.src;l.fa&&lh(l),l=f.call(m,h)}return l}function ch(l){return l=l[oh],l instanceof Qa?l:null}var uh="__closure_events_fn_"+(1e9*Math.random()>>>0);function hh(l){return typeof l=="function"?l:(l[uh]||(l[uh]=function(h){return l.handleEvent(h)}),l[uh])}function He(){bn.call(this),this.i=new Qa(this),this.M=this,this.F=null}S(He,bn),He.prototype[Ls]=!0,He.prototype.removeEventListener=function(l,h,f,m){f_(this,l,h,f,m)};function nt(l,h){var f,m=l.F;if(m)for(f=[];m;m=m.F)f.push(m);if(l=l.M,m=h.type||h,typeof h=="string")h=new Qe(h,l);else if(h instanceof Qe)h.target=h.target||l;else{var A=h;h=new Qe(m,l),T(h,A)}if(A=!0,f)for(var P=f.length-1;0<=P;P--){var F=h.g=f[P];A=Ha(F,m,!0,h)&&A}if(F=h.g=l,A=Ha(F,m,!0,h)&&A,A=Ha(F,m,!1,h)&&A,f)for(P=0;P<f.length;P++)F=h.g=f[P],A=Ha(F,m,!1,h)&&A}He.prototype.N=function(){if(He.aa.N.call(this),this.i){var l=this.i,h;for(h in l.g){for(var f=l.g[h],m=0;m<f.length;m++)$a(f[m]);delete l.g[h],l.h--}}this.F=null},He.prototype.K=function(l,h,f,m){return this.i.add(String(l),h,!1,f,m)},He.prototype.L=function(l,h,f,m){return this.i.add(String(l),h,!0,f,m)};function Ha(l,h,f,m){if(h=l.i.g[String(h)],!h)return!0;h=h.concat();for(var A=!0,P=0;P<h.length;++P){var F=h[P];if(F&&!F.da&&F.capture==f){var de=F.listener,ze=F.ha||F.src;F.fa&&ih(l.i,F),A=de.call(ze,m)!==!1&&A}}return A&&!m.defaultPrevented}function g_(l,h,f){if(typeof l=="function")f&&(l=g(l,f));else if(l&&typeof l.handleEvent=="function")l=g(l.handleEvent,l);else throw Error("Invalid listener argument");return 2147483647<Number(h)?-1:a.setTimeout(l,h||0)}function m_(l){l.g=g_(()=>{l.g=null,l.i&&(l.i=!1,m_(l))},l.l);let h=l.h;l.h=null,l.m.apply(null,h)}class O0 extends bn{constructor(h,f){super(),this.m=h,this.l=f,this.h=null,this.i=!1,this.g=null}j(h){this.h=arguments,this.g?this.i=!0:m_(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Us(l){bn.call(this),this.h=l,this.g={}}S(Us,bn);var __=[];function y_(l){H(l.g,function(h,f){this.g.hasOwnProperty(f)&&lh(h)},l),l.g={}}Us.prototype.N=function(){Us.aa.N.call(this),y_(this)},Us.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var dh=a.JSON.stringify,F0=a.JSON.parse,M0=class{stringify(l){return a.JSON.stringify(l,void 0)}parse(l){return a.JSON.parse(l,void 0)}};function fh(){}fh.prototype.h=null;function v_(l){return l.h||(l.h=l.i())}function w_(){}var Bs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function ph(){Qe.call(this,"d")}S(ph,Qe);function gh(){Qe.call(this,"c")}S(gh,Qe);var Tr={},E_=null;function Ya(){return E_=E_||new He}Tr.La="serverreachability";function T_(l){Qe.call(this,Tr.La,l)}S(T_,Qe);function qs(l){let h=Ya();nt(h,new T_(h))}Tr.STAT_EVENT="statevent";function I_(l,h){Qe.call(this,Tr.STAT_EVENT,l),this.stat=h}S(I_,Qe);function rt(l){let h=Ya();nt(h,new I_(h,l))}Tr.Ma="timingevent";function A_(l,h){Qe.call(this,Tr.Ma,l),this.size=h}S(A_,Qe);function js(l,h){if(typeof l!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){l()},h)}function Gs(){this.g=!0}Gs.prototype.xa=function(){this.g=!1};function L0(l,h,f,m,A,P){l.info(function(){if(l.g)if(P)for(var F="",de=P.split("&"),ze=0;ze<de.length;ze++){var oe=de[ze].split("=");if(1<oe.length){var Ye=oe[0];oe=oe[1];var Xe=Ye.split("_");F=2<=Xe.length&&Xe[1]=="type"?F+(Ye+"="+oe+"&"):F+(Ye+"=redacted&")}}else F=null;else F=P;return"XMLHTTP REQ ("+m+") [attempt "+A+"]: "+h+`
`+f+`
`+F})}function U0(l,h,f,m,A,P,F){l.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+A+"]: "+h+`
`+f+`
`+P+" "+F})}function di(l,h,f,m){l.info(function(){return"XMLHTTP TEXT ("+h+"): "+q0(l,f)+(m?" "+m:"")})}function B0(l,h){l.info(function(){return"TIMEOUT: "+h})}Gs.prototype.info=function(){};function q0(l,h){if(!l.g)return h;if(!h)return null;try{var f=JSON.parse(h);if(f){for(l=0;l<f.length;l++)if(Array.isArray(f[l])){var m=f[l];if(!(2>m.length)){var A=m[1];if(Array.isArray(A)&&!(1>A.length)){var P=A[0];if(P!="noop"&&P!="stop"&&P!="close")for(var F=1;F<A.length;F++)A[F]=""}}}}return dh(f)}catch{return h}}var Xa={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},S_={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},mh;function Ja(){}S(Ja,fh),Ja.prototype.g=function(){return new XMLHttpRequest},Ja.prototype.i=function(){return{}},mh=new Ja;function Cn(l,h,f,m){this.j=l,this.i=h,this.l=f,this.R=m||1,this.U=new Us(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new b_}function b_(){this.i=null,this.g="",this.h=!1}var C_={},_h={};function yh(l,h,f){l.L=1,l.v=nl(ln(h)),l.m=f,l.P=!0,R_(l,null)}function R_(l,h){l.F=Date.now(),Za(l),l.A=ln(l.v);var f=l.A,m=l.R;Array.isArray(m)||(m=[String(m)]),j_(f.i,"t",m),l.C=0,f=l.j.J,l.h=new b_,l.g=oy(l.j,f?h:null,!l.m),0<l.O&&(l.M=new O0(g(l.Y,l,l.g),l.O)),h=l.U,f=l.g,m=l.ca;var A="readystatechange";Array.isArray(A)||(A&&(__[0]=A.toString()),A=__);for(var P=0;P<A.length;P++){var F=u_(f,A[P],m||h.handleEvent,!1,h.h||h);if(!F)break;h.g[F.key]=F}h=l.H?_(l.H):{},l.m?(l.u||(l.u="POST"),h["Content-Type"]="application/x-www-form-urlencoded",l.g.ea(l.A,l.u,l.m,h)):(l.u="GET",l.g.ea(l.A,l.u,null,h)),qs(),L0(l.i,l.u,l.A,l.l,l.R,l.m)}Cn.prototype.ca=function(l){l=l.target;let h=this.M;h&&cn(l)==3?h.j():this.Y(l)},Cn.prototype.Y=function(l){try{if(l==this.g)e:{let Xe=cn(this.g);var h=this.g.Ba();let gi=this.g.Z();if(!(3>Xe)&&(Xe!=3||this.g&&(this.h.h||this.g.oa()||H_(this.g)))){this.J||Xe!=4||h==7||(h==8||0>=gi?qs(3):qs(2)),vh(this);var f=this.g.Z();this.X=f;t:if(P_(this)){var m=H_(this.g);l="";var A=m.length,P=cn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ir(this),zs(this);var F="";break t}this.h.i=new a.TextDecoder}for(h=0;h<A;h++)this.h.h=!0,l+=this.h.i.decode(m[h],{stream:!(P&&h==A-1)});m.length=0,this.h.g+=l,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=f==200,U0(this.i,this.u,this.A,this.l,this.R,Xe,f),this.o){if(this.T&&!this.K){t:{if(this.g){var de,ze=this.g;if((de=ze.g?ze.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(de)){var oe=de;break t}}oe=null}if(f=oe)di(this.i,this.l,f,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wh(this,f);else{this.o=!1,this.s=3,rt(12),Ir(this),zs(this);break e}}if(this.P){f=!0;let xt;for(;!this.J&&this.C<F.length;)if(xt=j0(this,F),xt==_h){Xe==4&&(this.s=4,rt(14),f=!1),di(this.i,this.l,null,"[Incomplete Response]");break}else if(xt==C_){this.s=4,rt(15),di(this.i,this.l,F,"[Invalid Chunk]"),f=!1;break}else di(this.i,this.l,xt,null),wh(this,xt);if(P_(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Xe!=4||F.length!=0||this.h.h||(this.s=1,rt(16),f=!1),this.o=this.o&&f,!f)di(this.i,this.l,F,"[Invalid Chunked Response]"),Ir(this),zs(this);else if(0<F.length&&!this.W){this.W=!0;var Ye=this.j;Ye.g==this&&Ye.ba&&!Ye.M&&(Ye.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),bh(Ye),Ye.M=!0,rt(11))}}else di(this.i,this.l,F,null),wh(this,F);Xe==4&&Ir(this),this.o&&!this.J&&(Xe==4?ny(this.j,this):(this.o=!1,Za(this)))}else sS(this.g),f==400&&0<F.indexOf("Unknown SID")?(this.s=3,rt(12)):(this.s=0,rt(13)),Ir(this),zs(this)}}}catch{}finally{}};function P_(l){return l.g?l.u=="GET"&&l.L!=2&&l.j.Ca:!1}function j0(l,h){var f=l.C,m=h.indexOf(`
`,f);return m==-1?_h:(f=Number(h.substring(f,m)),isNaN(f)?C_:(m+=1,m+f>h.length?_h:(h=h.slice(m,m+f),l.C=m+f,h)))}Cn.prototype.cancel=function(){this.J=!0,Ir(this)};function Za(l){l.S=Date.now()+l.I,N_(l,l.I)}function N_(l,h){if(l.B!=null)throw Error("WatchDog timer not null");l.B=js(g(l.ba,l),h)}function vh(l){l.B&&(a.clearTimeout(l.B),l.B=null)}Cn.prototype.ba=function(){this.B=null;let l=Date.now();0<=l-this.S?(B0(this.i,this.A),this.L!=2&&(qs(),rt(17)),Ir(this),this.s=2,zs(this)):N_(this,this.S-l)};function zs(l){l.j.G==0||l.J||ny(l.j,l)}function Ir(l){vh(l);var h=l.M;h&&typeof h.ma=="function"&&h.ma(),l.M=null,y_(l.U),l.g&&(h=l.g,l.g=null,h.abort(),h.ma())}function wh(l,h){try{var f=l.j;if(f.G!=0&&(f.g==l||Eh(f.h,l))){if(!l.K&&Eh(f.h,l)&&f.G==3){try{var m=f.Da.g.parse(h)}catch{m=null}if(Array.isArray(m)&&m.length==3){var A=m;if(A[0]==0){e:if(!f.u){if(f.g)if(f.g.F+3e3<l.F)al(f),sl(f);else break e;Sh(f),rt(18)}}else f.za=A[1],0<f.za-f.T&&37500>A[2]&&f.F&&f.v==0&&!f.C&&(f.C=js(g(f.Za,f),6e3));if(1>=D_(f.h)&&f.ca){try{f.ca()}catch{}f.ca=void 0}}else Sr(f,11)}else if((l.K||f.g==l)&&al(f),!B(h))for(A=f.Da.g.parse(h),h=0;h<A.length;h++){let oe=A[h];if(f.T=oe[0],oe=oe[1],f.G==2)if(oe[0]=="c"){f.K=oe[1],f.ia=oe[2];let Ye=oe[3];Ye!=null&&(f.la=Ye,f.j.info("VER="+f.la));let Xe=oe[4];Xe!=null&&(f.Aa=Xe,f.j.info("SVER="+f.Aa));let gi=oe[5];gi!=null&&typeof gi=="number"&&0<gi&&(m=1.5*gi,f.L=m,f.j.info("backChannelRequestTimeoutMs_="+m)),m=f;let xt=l.g;if(xt){let cl=xt.g?xt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(cl){var P=m.h;P.g||cl.indexOf("spdy")==-1&&cl.indexOf("quic")==-1&&cl.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(Th(P,P.h),P.h=null))}if(m.D){let Ch=xt.g?xt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ch&&(m.ya=Ch,me(m.I,m.D,Ch))}}f.G=3,f.l&&f.l.ua(),f.ba&&(f.R=Date.now()-l.F,f.j.info("Handshake RTT: "+f.R+"ms")),m=f;var F=l;if(m.qa=sy(m,m.J?m.ia:null,m.W),F.K){V_(m.h,F);var de=F,ze=m.L;ze&&(de.I=ze),de.B&&(vh(de),Za(de)),m.g=F}else ey(m);0<f.i.length&&ol(f)}else oe[0]!="stop"&&oe[0]!="close"||Sr(f,7);else f.G==3&&(oe[0]=="stop"||oe[0]=="close"?oe[0]=="stop"?Sr(f,7):Ah(f):oe[0]!="noop"&&f.l&&f.l.ta(oe),f.v=0)}}qs(4)}catch{}}var G0=class{constructor(l,h){this.g=l,this.map=h}};function k_(l){this.l=l||10,a.PerformanceNavigationTiming?(l=a.performance.getEntriesByType("navigation"),l=0<l.length&&(l[0].nextHopProtocol=="hq"||l[0].nextHopProtocol=="h2")):l=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=l?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function x_(l){return l.h?!0:l.g?l.g.size>=l.j:!1}function D_(l){return l.h?1:l.g?l.g.size:0}function Eh(l,h){return l.h?l.h==h:l.g?l.g.has(h):!1}function Th(l,h){l.g?l.g.add(h):l.h=h}function V_(l,h){l.h&&l.h==h?l.h=null:l.g&&l.g.has(h)&&l.g.delete(h)}k_.prototype.cancel=function(){if(this.i=O_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let l of this.g.values())l.cancel();this.g.clear()}};function O_(l){if(l.h!=null)return l.i.concat(l.h.D);if(l.g!=null&&l.g.size!==0){let h=l.i;for(let f of l.g.values())h=h.concat(f.D);return h}return N(l.i)}function z0(l){if(l.V&&typeof l.V=="function")return l.V();if(typeof Map<"u"&&l instanceof Map||typeof Set<"u"&&l instanceof Set)return Array.from(l.values());if(typeof l=="string")return l.split("");if(c(l)){for(var h=[],f=l.length,m=0;m<f;m++)h.push(l[m]);return h}h=[],f=0;for(m in l)h[f++]=l[m];return h}function W0(l){if(l.na&&typeof l.na=="function")return l.na();if(!l.V||typeof l.V!="function"){if(typeof Map<"u"&&l instanceof Map)return Array.from(l.keys());if(!(typeof Set<"u"&&l instanceof Set)){if(c(l)||typeof l=="string"){var h=[];l=l.length;for(var f=0;f<l;f++)h.push(f);return h}h=[],f=0;for(let m in l)h[f++]=m;return h}}}function F_(l,h){if(l.forEach&&typeof l.forEach=="function")l.forEach(h,void 0);else if(c(l)||typeof l=="string")Array.prototype.forEach.call(l,h,void 0);else for(var f=W0(l),m=z0(l),A=m.length,P=0;P<A;P++)h.call(void 0,m[P],f&&f[P],l)}var M_=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function K0(l,h){if(l){l=l.split("&");for(var f=0;f<l.length;f++){var m=l[f].indexOf("="),A=null;if(0<=m){var P=l[f].substring(0,m);A=l[f].substring(m+1)}else P=l[f];h(P,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Ar(l){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,l instanceof Ar){this.h=l.h,el(this,l.j),this.o=l.o,this.g=l.g,tl(this,l.s),this.l=l.l;var h=l.i,f=new $s;f.i=h.i,h.g&&(f.g=new Map(h.g),f.h=h.h),L_(this,f),this.m=l.m}else l&&(h=String(l).match(M_))?(this.h=!1,el(this,h[1]||"",!0),this.o=Ws(h[2]||""),this.g=Ws(h[3]||"",!0),tl(this,h[4]),this.l=Ws(h[5]||"",!0),L_(this,h[6]||"",!0),this.m=Ws(h[7]||"")):(this.h=!1,this.i=new $s(null,this.h))}Ar.prototype.toString=function(){var l=[],h=this.j;h&&l.push(Ks(h,U_,!0),":");var f=this.g;return(f||h=="file")&&(l.push("//"),(h=this.o)&&l.push(Ks(h,U_,!0),"@"),l.push(encodeURIComponent(String(f)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),f=this.s,f!=null&&l.push(":",String(f))),(f=this.l)&&(this.g&&f.charAt(0)!="/"&&l.push("/"),l.push(Ks(f,f.charAt(0)=="/"?H0:Q0,!0))),(f=this.i.toString())&&l.push("?",f),(f=this.m)&&l.push("#",Ks(f,X0)),l.join("")};function ln(l){return new Ar(l)}function el(l,h,f){l.j=f?Ws(h,!0):h,l.j&&(l.j=l.j.replace(/:$/,""))}function tl(l,h){if(h){if(h=Number(h),isNaN(h)||0>h)throw Error("Bad port number "+h);l.s=h}else l.s=null}function L_(l,h,f){h instanceof $s?(l.i=h,J0(l.i,l.h)):(f||(h=Ks(h,Y0)),l.i=new $s(h,l.h))}function me(l,h,f){l.i.set(h,f)}function nl(l){return me(l,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),l}function Ws(l,h){return l?h?decodeURI(l.replace(/%25/g,"%2525")):decodeURIComponent(l):""}function Ks(l,h,f){return typeof l=="string"?(l=encodeURI(l).replace(h,$0),f&&(l=l.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l):null}function $0(l){return l=l.charCodeAt(0),"%"+(l>>4&15).toString(16)+(l&15).toString(16)}var U_=/[#\/\?@]/g,Q0=/[#\?:]/g,H0=/[#\?]/g,Y0=/[#\?@]/g,X0=/#/g;function $s(l,h){this.h=this.g=null,this.i=l||null,this.j=!!h}function Rn(l){l.g||(l.g=new Map,l.h=0,l.i&&K0(l.i,function(h,f){l.add(decodeURIComponent(h.replace(/\+/g," ")),f)}))}n=$s.prototype,n.add=function(l,h){Rn(this),this.i=null,l=fi(this,l);var f=this.g.get(l);return f||this.g.set(l,f=[]),f.push(h),this.h+=1,this};function B_(l,h){Rn(l),h=fi(l,h),l.g.has(h)&&(l.i=null,l.h-=l.g.get(h).length,l.g.delete(h))}function q_(l,h){return Rn(l),h=fi(l,h),l.g.has(h)}n.forEach=function(l,h){Rn(this),this.g.forEach(function(f,m){f.forEach(function(A){l.call(h,A,m,this)},this)},this)},n.na=function(){Rn(this);let l=Array.from(this.g.values()),h=Array.from(this.g.keys()),f=[];for(let m=0;m<h.length;m++){let A=l[m];for(let P=0;P<A.length;P++)f.push(h[m])}return f},n.V=function(l){Rn(this);let h=[];if(typeof l=="string")q_(this,l)&&(h=h.concat(this.g.get(fi(this,l))));else{l=Array.from(this.g.values());for(let f=0;f<l.length;f++)h=h.concat(l[f])}return h},n.set=function(l,h){return Rn(this),this.i=null,l=fi(this,l),q_(this,l)&&(this.h-=this.g.get(l).length),this.g.set(l,[h]),this.h+=1,this},n.get=function(l,h){return l?(l=this.V(l),0<l.length?String(l[0]):h):h};function j_(l,h,f){B_(l,h),0<f.length&&(l.i=null,l.g.set(fi(l,h),N(f)),l.h+=f.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let l=[],h=Array.from(this.g.keys());for(var f=0;f<h.length;f++){var m=h[f];let P=encodeURIComponent(String(m)),F=this.V(m);for(m=0;m<F.length;m++){var A=P;F[m]!==""&&(A+="="+encodeURIComponent(String(F[m]))),l.push(A)}}return this.i=l.join("&")};function fi(l,h){return h=String(h),l.j&&(h=h.toLowerCase()),h}function J0(l,h){h&&!l.j&&(Rn(l),l.i=null,l.g.forEach(function(f,m){var A=m.toLowerCase();m!=A&&(B_(this,m),j_(this,A,f))},l)),l.j=h}function Z0(l,h){let f=new Gs;if(a.Image){let m=new Image;m.onload=y(Pn,f,"TestLoadImage: loaded",!0,h,m),m.onerror=y(Pn,f,"TestLoadImage: error",!1,h,m),m.onabort=y(Pn,f,"TestLoadImage: abort",!1,h,m),m.ontimeout=y(Pn,f,"TestLoadImage: timeout",!1,h,m),a.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=l}else h(!1)}function eS(l,h){let f=new Gs,m=new AbortController,A=setTimeout(()=>{m.abort(),Pn(f,"TestPingServer: timeout",!1,h)},1e4);fetch(l,{signal:m.signal}).then(P=>{clearTimeout(A),P.ok?Pn(f,"TestPingServer: ok",!0,h):Pn(f,"TestPingServer: server error",!1,h)}).catch(()=>{clearTimeout(A),Pn(f,"TestPingServer: error",!1,h)})}function Pn(l,h,f,m,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),m(f)}catch{}}function tS(){this.g=new M0}function nS(l,h,f){let m=f||"";try{F_(l,function(A,P){let F=A;u(A)&&(F=dh(A)),h.push(m+P+"="+encodeURIComponent(F))})}catch(A){throw h.push(m+"type="+encodeURIComponent("_badmap")),A}}function Qs(l){this.l=l.Ub||null,this.j=l.eb||!1}S(Qs,fh),Qs.prototype.g=function(){return new rl(this.l,this.j)},Qs.prototype.i=(function(l){return function(){return l}})({});function rl(l,h){He.call(this),this.D=l,this.o=h,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}S(rl,He),n=rl.prototype,n.open=function(l,h){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=l,this.A=h,this.readyState=1,Ys(this)},n.send=function(l){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let h={headers:this.u,method:this.B,credentials:this.m,cache:void 0};l&&(h.body=l),(this.D||a).fetch(new Request(this.A,h)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Hs(this)),this.readyState=0},n.Sa=function(l){if(this.g&&(this.l=l,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=l.headers,this.readyState=2,Ys(this)),this.g&&(this.readyState=3,Ys(this),this.g)))if(this.responseType==="arraybuffer")l.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in l){if(this.j=l.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;G_(this)}else l.text().then(this.Ra.bind(this),this.ga.bind(this))};function G_(l){l.j.read().then(l.Pa.bind(l)).catch(l.ga.bind(l))}n.Pa=function(l){if(this.g){if(this.o&&l.value)this.response.push(l.value);else if(!this.o){var h=l.value?l.value:new Uint8Array(0);(h=this.v.decode(h,{stream:!l.done}))&&(this.response=this.responseText+=h)}l.done?Hs(this):Ys(this),this.readyState==3&&G_(this)}},n.Ra=function(l){this.g&&(this.response=this.responseText=l,Hs(this))},n.Qa=function(l){this.g&&(this.response=l,Hs(this))},n.ga=function(){this.g&&Hs(this)};function Hs(l){l.readyState=4,l.l=null,l.j=null,l.v=null,Ys(l)}n.setRequestHeader=function(l,h){this.u.append(l,h)},n.getResponseHeader=function(l){return this.h&&this.h.get(l.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let l=[],h=this.h.entries();for(var f=h.next();!f.done;)f=f.value,l.push(f[0]+": "+f[1]),f=h.next();return l.join(`\r
`)};function Ys(l){l.onreadystatechange&&l.onreadystatechange.call(l)}Object.defineProperty(rl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(l){this.m=l?"include":"same-origin"}});function z_(l){let h="";return H(l,function(f,m){h+=m,h+=":",h+=f,h+=`\r
`}),h}function Ih(l,h,f){e:{for(m in f){var m=!1;break e}m=!0}m||(f=z_(f),typeof l=="string"?f!=null&&encodeURIComponent(String(f)):me(l,h,f))}function Te(l){He.call(this),this.headers=new Map,this.o=l||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}S(Te,He);var rS=/^https?$/i,iS=["POST","PUT"];n=Te.prototype,n.Ha=function(l){this.J=l},n.ea=function(l,h,f,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+l);h=h?h.toUpperCase():"GET",this.D=l,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():mh.g(),this.v=this.o?v_(this.o):v_(mh),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(h,String(l),!0),this.B=!1}catch(P){W_(this,P);return}if(l=f||"",f=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var A in m)f.set(A,m[A]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())f.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(f.keys()).find(P=>P.toLowerCase()=="content-type"),A=a.FormData&&l instanceof a.FormData,!(0<=Array.prototype.indexOf.call(iS,h,void 0))||m||A||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,F]of f)this.g.setRequestHeader(P,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Q_(this),this.u=!0,this.g.send(l),this.u=!1}catch(P){W_(this,P)}};function W_(l,h){l.h=!1,l.g&&(l.j=!0,l.g.abort(),l.j=!1),l.l=h,l.m=5,K_(l),il(l)}function K_(l){l.A||(l.A=!0,nt(l,"complete"),nt(l,"error"))}n.abort=function(l){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=l||7,nt(this,"complete"),nt(this,"abort"),il(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),il(this,!0)),Te.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?$_(this):this.bb())},n.bb=function(){$_(this)};function $_(l){if(l.h&&typeof o<"u"&&(!l.v[1]||cn(l)!=4||l.Z()!=2)){if(l.u&&cn(l)==4)g_(l.Ea,0,l);else if(nt(l,"readystatechange"),cn(l)==4){l.h=!1;try{let F=l.Z();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var h=!0;break e;default:h=!1}var f;if(!(f=h)){var m;if(m=F===0){var A=String(l.D).match(M_)[1]||null;!A&&a.self&&a.self.location&&(A=a.self.location.protocol.slice(0,-1)),m=!rS.test(A?A.toLowerCase():"")}f=m}if(f)nt(l,"complete"),nt(l,"success");else{l.m=6;try{var P=2<cn(l)?l.g.statusText:""}catch{P=""}l.l=P+" ["+l.Z()+"]",K_(l)}}finally{il(l)}}}}function il(l,h){if(l.g){Q_(l);let f=l.g,m=l.v[0]?()=>{}:null;l.g=null,l.v=null,h||nt(l,"ready");try{f.onreadystatechange=m}catch{}}}function Q_(l){l.I&&(a.clearTimeout(l.I),l.I=null)}n.isActive=function(){return!!this.g};function cn(l){return l.g?l.g.readyState:0}n.Z=function(){try{return 2<cn(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(l){if(this.g){var h=this.g.responseText;return l&&h.indexOf(l)==0&&(h=h.substring(l.length)),F0(h)}};function H_(l){try{if(!l.g)return null;if("response"in l.g)return l.g.response;switch(l.H){case"":case"text":return l.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in l.g)return l.g.mozResponseArrayBuffer}return null}catch{return null}}function sS(l){let h={};l=(l.g&&2<=cn(l)&&l.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<l.length;m++){if(B(l[m]))continue;var f=I(l[m]);let A=f[0];if(f=f[1],typeof f!="string")continue;f=f.trim();let P=h[A]||[];h[A]=P,P.push(f)}E(h,function(m){return m.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Xs(l,h,f){return f&&f.internalChannelParams&&f.internalChannelParams[l]||h}function Y_(l){this.Aa=0,this.i=[],this.j=new Gs,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Xs("failFast",!1,l),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Xs("baseRetryDelayMs",5e3,l),this.cb=Xs("retryDelaySeedMs",1e4,l),this.Wa=Xs("forwardChannelMaxRetries",2,l),this.wa=Xs("forwardChannelRequestTimeoutMs",2e4,l),this.pa=l&&l.xmlHttpFactory||void 0,this.Xa=l&&l.Tb||void 0,this.Ca=l&&l.useFetchStreams||!1,this.L=void 0,this.J=l&&l.supportsCrossDomainXhr||!1,this.K="",this.h=new k_(l&&l.concurrentRequestLimit),this.Da=new tS,this.P=l&&l.fastHandshake||!1,this.O=l&&l.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=l&&l.Rb||!1,l&&l.xa&&this.j.xa(),l&&l.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&l&&l.detectBufferingProxy||!1,this.ja=void 0,l&&l.longPollingTimeout&&0<l.longPollingTimeout&&(this.ja=l.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Y_.prototype,n.la=8,n.G=1,n.connect=function(l,h,f,m){rt(0),this.W=l,this.H=h||{},f&&m!==void 0&&(this.H.OSID=f,this.H.OAID=m),this.F=this.X,this.I=sy(this,null,this.W),ol(this)};function Ah(l){if(X_(l),l.G==3){var h=l.U++,f=ln(l.I);if(me(f,"SID",l.K),me(f,"RID",h),me(f,"TYPE","terminate"),Js(l,f),h=new Cn(l,l.j,h),h.L=2,h.v=nl(ln(f)),f=!1,a.navigator&&a.navigator.sendBeacon)try{f=a.navigator.sendBeacon(h.v.toString(),"")}catch{}!f&&a.Image&&(new Image().src=h.v,f=!0),f||(h.g=oy(h.j,null),h.g.ea(h.v)),h.F=Date.now(),Za(h)}iy(l)}function sl(l){l.g&&(bh(l),l.g.cancel(),l.g=null)}function X_(l){sl(l),l.u&&(a.clearTimeout(l.u),l.u=null),al(l),l.h.cancel(),l.s&&(typeof l.s=="number"&&a.clearTimeout(l.s),l.s=null)}function ol(l){if(!x_(l.h)&&!l.s){l.s=!0;var h=l.Ga;Os||c_(),Fs||(Os(),Fs=!0),rh.add(h,l),l.B=0}}function oS(l,h){return D_(l.h)>=l.h.j-(l.s?1:0)?!1:l.s?(l.i=h.D.concat(l.i),!0):l.G==1||l.G==2||l.B>=(l.Va?0:l.Wa)?!1:(l.s=js(g(l.Ga,l,h),ry(l,l.B)),l.B++,!0)}n.Ga=function(l){if(this.s)if(this.s=null,this.G==1){if(!l){this.U=Math.floor(1e5*Math.random()),l=this.U++;let A=new Cn(this,this.j,l),P=this.o;if(this.S&&(P?(P=_(P),T(P,this.S)):P=this.S),this.m!==null||this.O||(A.H=P,P=null),this.P)e:{for(var h=0,f=0;f<this.i.length;f++){t:{var m=this.i[f];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(h+=m,4096<h){h=f;break e}if(h===4096||f===this.i.length-1){h=f+1;break e}}h=1e3}else h=1e3;h=Z_(this,A,h),f=ln(this.I),me(f,"RID",l),me(f,"CVER",22),this.D&&me(f,"X-HTTP-Session-Id",this.D),Js(this,f),P&&(this.O?h="headers="+encodeURIComponent(String(z_(P)))+"&"+h:this.m&&Ih(f,this.m,P)),Th(this.h,A),this.Ua&&me(f,"TYPE","init"),this.P?(me(f,"$req",h),me(f,"SID","null"),A.T=!0,yh(A,f,null)):yh(A,f,h),this.G=2}}else this.G==3&&(l?J_(this,l):this.i.length==0||x_(this.h)||J_(this))};function J_(l,h){var f;h?f=h.l:f=l.U++;let m=ln(l.I);me(m,"SID",l.K),me(m,"RID",f),me(m,"AID",l.T),Js(l,m),l.m&&l.o&&Ih(m,l.m,l.o),f=new Cn(l,l.j,f,l.B+1),l.m===null&&(f.H=l.o),h&&(l.i=h.D.concat(l.i)),h=Z_(l,f,1e3),f.I=Math.round(.5*l.wa)+Math.round(.5*l.wa*Math.random()),Th(l.h,f),yh(f,m,h)}function Js(l,h){l.H&&H(l.H,function(f,m){me(h,m,f)}),l.l&&F_({},function(f,m){me(h,m,f)})}function Z_(l,h,f){f=Math.min(l.i.length,f);var m=l.l?g(l.l.Na,l.l,l):null;e:{var A=l.i;let P=-1;for(;;){let F=["count="+f];P==-1?0<f?(P=A[0].g,F.push("ofs="+P)):P=0:F.push("ofs="+P);let de=!0;for(let ze=0;ze<f;ze++){let oe=A[ze].g,Ye=A[ze].map;if(oe-=P,0>oe)P=Math.max(0,A[ze].g-100),de=!1;else try{nS(Ye,F,"req"+oe+"_")}catch{m&&m(Ye)}}if(de){m=F.join("&");break e}}}return l=l.i.splice(0,f),h.D=l,m}function ey(l){if(!l.g&&!l.u){l.Y=1;var h=l.Fa;Os||c_(),Fs||(Os(),Fs=!0),rh.add(h,l),l.v=0}}function Sh(l){return l.g||l.u||3<=l.v?!1:(l.Y++,l.u=js(g(l.Fa,l),ry(l,l.v)),l.v++,!0)}n.Fa=function(){if(this.u=null,ty(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var l=2*this.R;this.j.info("BP detection timer enabled: "+l),this.A=js(g(this.ab,this),l)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,rt(10),sl(this),ty(this))};function bh(l){l.A!=null&&(a.clearTimeout(l.A),l.A=null)}function ty(l){l.g=new Cn(l,l.j,"rpc",l.Y),l.m===null&&(l.g.H=l.o),l.g.O=0;var h=ln(l.qa);me(h,"RID","rpc"),me(h,"SID",l.K),me(h,"AID",l.T),me(h,"CI",l.F?"0":"1"),!l.F&&l.ja&&me(h,"TO",l.ja),me(h,"TYPE","xmlhttp"),Js(l,h),l.m&&l.o&&Ih(h,l.m,l.o),l.L&&(l.g.I=l.L);var f=l.g;l=l.ia,f.L=1,f.v=nl(ln(h)),f.m=null,f.P=!0,R_(f,l)}n.Za=function(){this.C!=null&&(this.C=null,sl(this),Sh(this),rt(19))};function al(l){l.C!=null&&(a.clearTimeout(l.C),l.C=null)}function ny(l,h){var f=null;if(l.g==h){al(l),bh(l),l.g=null;var m=2}else if(Eh(l.h,h))f=h.D,V_(l.h,h),m=1;else return;if(l.G!=0){if(h.o)if(m==1){f=h.m?h.m.length:0,h=Date.now()-h.F;var A=l.B;m=Ya(),nt(m,new A_(m,f)),ol(l)}else ey(l);else if(A=h.s,A==3||A==0&&0<h.X||!(m==1&&oS(l,h)||m==2&&Sh(l)))switch(f&&0<f.length&&(h=l.h,h.i=h.i.concat(f)),A){case 1:Sr(l,5);break;case 4:Sr(l,10);break;case 3:Sr(l,6);break;default:Sr(l,2)}}}function ry(l,h){let f=l.Ta+Math.floor(Math.random()*l.cb);return l.isActive()||(f*=2),f*h}function Sr(l,h){if(l.j.info("Error code "+h),h==2){var f=g(l.fb,l),m=l.Xa;let A=!m;m=new Ar(m||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||el(m,"https"),nl(m),A?Z0(m.toString(),f):eS(m.toString(),f)}else rt(2);l.G=0,l.l&&l.l.sa(h),iy(l),X_(l)}n.fb=function(l){l?(this.j.info("Successfully pinged google.com"),rt(2)):(this.j.info("Failed to ping google.com"),rt(1))};function iy(l){if(l.G=0,l.ka=[],l.l){let h=O_(l.h);(h.length!=0||l.i.length!=0)&&(k(l.ka,h),k(l.ka,l.i),l.h.i.length=0,N(l.i),l.i.length=0),l.l.ra()}}function sy(l,h,f){var m=f instanceof Ar?ln(f):new Ar(f);if(m.g!="")h&&(m.g=h+"."+m.g),tl(m,m.s);else{var A=a.location;m=A.protocol,h=h?h+"."+A.hostname:A.hostname,A=+A.port;var P=new Ar(null);m&&el(P,m),h&&(P.g=h),A&&tl(P,A),f&&(P.l=f),m=P}return f=l.D,h=l.ya,f&&h&&me(m,f,h),me(m,"VER",l.la),Js(l,m),m}function oy(l,h,f){if(h&&!l.J)throw Error("Can't create secondary domain capable XhrIo object.");return h=l.Ca&&!l.pa?new Te(new Qs({eb:f})):new Te(l.pa),h.Ha(l.J),h}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ay(){}n=ay.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function ll(){}ll.prototype.g=function(l,h){return new mt(l,h)};function mt(l,h){He.call(this),this.g=new Y_(h),this.l=l,this.h=h&&h.messageUrlParams||null,l=h&&h.messageHeaders||null,h&&h.clientProtocolHeaderRequired&&(l?l["X-Client-Protocol"]="webchannel":l={"X-Client-Protocol":"webchannel"}),this.g.o=l,l=h&&h.initMessageHeaders||null,h&&h.messageContentType&&(l?l["X-WebChannel-Content-Type"]=h.messageContentType:l={"X-WebChannel-Content-Type":h.messageContentType}),h&&h.va&&(l?l["X-WebChannel-Client-Profile"]=h.va:l={"X-WebChannel-Client-Profile":h.va}),this.g.S=l,(l=h&&h.Sb)&&!B(l)&&(this.g.m=l),this.v=h&&h.supportsCrossDomainXhr||!1,this.u=h&&h.sendRawJson||!1,(h=h&&h.httpSessionIdParam)&&!B(h)&&(this.g.D=h,l=this.h,l!==null&&h in l&&(l=this.h,h in l&&delete l[h])),this.j=new pi(this)}S(mt,He),mt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},mt.prototype.close=function(){Ah(this.g)},mt.prototype.o=function(l){var h=this.g;if(typeof l=="string"){var f={};f.__data__=l,l=f}else this.u&&(f={},f.__data__=dh(l),l=f);h.i.push(new G0(h.Ya++,l)),h.G==3&&ol(h)},mt.prototype.N=function(){this.g.l=null,delete this.j,Ah(this.g),delete this.g,mt.aa.N.call(this)};function ly(l){ph.call(this),l.__headers__&&(this.headers=l.__headers__,this.statusCode=l.__status__,delete l.__headers__,delete l.__status__);var h=l.__sm__;if(h){e:{for(let f in h){l=f;break e}l=void 0}(this.i=l)&&(l=this.i,h=h!==null&&l in h?h[l]:void 0),this.data=h}else this.data=l}S(ly,ph);function cy(){gh.call(this),this.status=1}S(cy,gh);function pi(l){this.g=l}S(pi,ay),pi.prototype.ua=function(){nt(this.g,"a")},pi.prototype.ta=function(l){nt(this.g,new ly(l))},pi.prototype.sa=function(l){nt(this.g,new cy)},pi.prototype.ra=function(){nt(this.g,"b")},ll.prototype.createWebChannel=ll.prototype.g,mt.prototype.send=mt.prototype.o,mt.prototype.open=mt.prototype.m,mt.prototype.close=mt.prototype.close,Yh=fn.createWebChannelTransport=function(){return new ll},Hh=fn.getStatEventTarget=function(){return Ya()},Qh=fn.Event=Tr,Nl=fn.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Xa.NO_ERROR=0,Xa.TIMEOUT=8,Xa.HTTP_ERROR=6,yo=fn.ErrorCode=Xa,S_.COMPLETE="complete",$h=fn.EventType=S_,w_.EventType=Bs,Bs.OPEN="a",Bs.CLOSE="b",Bs.ERROR="c",Bs.MESSAGE="d",He.prototype.listen=He.prototype.K,Ti=fn.WebChannel=w_,GS=fn.FetchXmlHttpFactory=Qs,Te.prototype.listenOnce=Te.prototype.L,Te.prototype.getLastError=Te.prototype.Ka,Te.prototype.getLastErrorCode=Te.prototype.Ba,Te.prototype.getStatus=Te.prototype.Z,Te.prototype.getResponseJson=Te.prototype.Oa,Te.prototype.getResponseText=Te.prototype.oa,Te.prototype.send=Te.prototype.ea,Te.prototype.setWithCredentials=Te.prototype.Ha,Kh=fn.XhrIo=Te}).apply(typeof Pl<"u"?Pl:typeof self<"u"?self:typeof window<"u"?window:{});var Qy="@firebase/firestore",Hy="4.8.0";var De=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};De.UNAUTHENTICATED=new De(null),De.GOOGLE_CREDENTIALS=new De("google-credentials-uid"),De.FIRST_PARTY=new De("first-party-uid"),De.MOCK_USER=new De("mock-user");var as="11.10.0";var Xn=new Mn("@firebase/firestore");function Pi(){return Xn.logLevel}function uw(n){Xn.setLogLevel(n)}function D(n,...e){if(Xn.logLevel<=Ct.DEBUG){let t=e.map(hp);Xn.debug(`Firestore (${as}): ${n}`,...t)}}function be(n,...e){if(Xn.logLevel<=Ct.ERROR){let t=e.map(hp);Xn.error(`Firestore (${as}): ${n}`,...t)}}function gt(n,...e){if(Xn.logLevel<=Ct.WARN){let t=e.map(hp);Xn.warn(`Firestore (${as}): ${n}`,...t)}}function hp(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function U(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,hw(n,r,t)}function hw(n,e,t){let r=`FIRESTORE (${as}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw be(r),new Error(r)}function j(n,e,t,r){let i="Unexpected state";typeof t=="string"?i=t:r=t,n||hw(e,i,r)}function dw(n,e){n||U(57014,e)}function L(n,e){return n}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},x=class extends Ty{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Le=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var zl=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},id=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(De.UNAUTHENTICATED))}shutdown(){}},sd=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},od=class{constructor(e){this.t=e,this.currentUser=De.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){j(this.o===void 0,42304);let r=this.i,i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve(),s=new Le;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Le,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;e.enqueueRetryable(async()=>{await c.promise,await i(this.currentUser)})},a=c=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?a(c):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Le)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(j(typeof r.accessToken=="string",31837,{l:r}),new zl(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return j(e===null||typeof e=="string",2055,{h:e}),new De(e)}},ad=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=De.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},ld=class{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new ad(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(De.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Wl=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},cd=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Il(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){j(this.o===void 0,3512);let r=s=>{s.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,D("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Wl(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(j(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Wl(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function WS(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}function dp(){return new TextEncoder}var Do=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=WS(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%62))}return r}};function $(n,e){return n<e?-1:n>e?1:0}function ud(n,e){let t=0;for(;t<n.length&&t<e.length;){let r=n.codePointAt(t),i=e.codePointAt(t);if(r!==i){if(r<128&&i<128)return $(r,i);{let s=dp(),o=KS(s.encode(Yy(n,t)),s.encode(Yy(e,t)));return o!==0?o:$(r,i)}}t+=r>65535?2:1}return $(n.length,e.length)}function Yy(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function KS(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return $(n[t],e[t]);return $(n.length,e.length)}function Li(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function fw(n){return n+"\0"}var Xy="__name__",Kl=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&U(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&U(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=n.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return $(e.length,t.length)}static compareSegments(e,t){let r=n.isNumericId(e),i=n.isNumericId(t);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(e).compare(n.extractNumericId(t)):ud(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return dn.fromString(e.substring(4,e.length-2))}},re=class n extends Kl{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new x(R.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},$S=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ce=class n extends Kl{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return $S.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Xy}static keyField(){return new n([Xy])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new x(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new x(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new x(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new x(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var M=class n{constructor(e){this.path=e}static fromPath(e){return new n(re.fromString(e))}static fromName(e){return new n(re.fromString(e).popFirst(5))}static empty(){return new n(re.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&re.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return re.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new re(e.slice()))}};function fp(n,e,t){if(!t)throw new x(R.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function pp(n,e,t,r){if(e===!0&&r===!0)throw new x(R.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Jy(n){if(!M.isDocumentKey(n))throw new x(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Zy(n){if(M.isDocumentKey(n))throw new x(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function pw(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Wc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":U(12329,{type:typeof n})}function se(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new x(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Wc(n);throw new x(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function gw(n,e){if(e<=0)throw new x(R.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Ve(n,e){let t={typeString:n};return e&&(t.value=e),t}function ia(n,e){if(!pw(n))throw new x(R.INVALID_ARGUMENT,"JSON must be an object");let t;for(let r in e)if(e[r]){let i=e[r].typeString,s="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}let o=n[r];if(i&&typeof o!==i){t=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){t=`Expected '${r}' field to equal '${s.value}'`;break}}if(t)throw new x(R.INVALID_ARGUMENT,t);return!0}var ev=-62135596800,tv=1e6,pe=class n{static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*tv);return new n(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new x(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new x(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ev)throw new x(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new x(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/tv}_compareTo(e){return this.seconds===e.seconds?$(this.nanoseconds,e.nanoseconds):$(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ia(e,n._jsonSchema))return new n(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-ev;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};pe._jsonSchemaVersion="firestore/timestamp/1.0",pe._jsonSchema={type:Ve("string",pe._jsonSchemaVersion),seconds:Ve("number"),nanoseconds:Ve("number")};var G=class n{static fromTimestamp(e){return new n(e)}static min(){return new n(new pe(0,0))}static max(){return new n(new pe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ui=-1,Bi=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function hd(n){return n.fields.find(e=>e.kind===2)}function kr(n){return n.fields.filter(e=>e.kind!==2)}Bi.UNKNOWN_ID=-1;var Oi=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Vo=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,Rt.min())}};function mw(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=G.fromTimestamp(r===1e9?new pe(t+1,0):new pe(t,r));return new Rt(i,M.empty(),e)}function _w(n){return new Rt(n.readTime,n.key,Ui)}var Rt=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(G.min(),M.empty(),Ui)}static max(){return new n(G.max(),M.empty(),Ui)}};function gp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=M.comparator(n.documentKey,e.documentKey),t!==0?t:$(n.largestBatchId,e.largestBatchId))}var yw="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",$l=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};async function lr(n){if(n.code!==R.FAILED_PRECONDITION||n.message!==yw)throw n;D("LocalStore","Unexpectedly lost primary lease")}var C=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},c=>r(c))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let c=0;c<s;c++){let u=c;t(e[u]).next(d=>{o[u]=d,++a,a===s&&r(o)},d=>i(d))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var yt="SimpleDb",Ql=class n{static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new Ur(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Le,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new Ur(e,t.error)):this.S.resolve()},this.transaction.onerror=r=>{let i=mp(r.target.error);this.S.reject(new Ur(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(D(yt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new fd(t)}},Jn=class n{static delete(e){return D(yt,"Removing database:",e),Dr(Nh().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!vl())return!1;if(n.F())return!0;let e=io(),t=n.M(e),r=0<t&&t<10,i=vw(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,t,r){this.name=e,this.version=t,this.B=r,this.L=null,n.M(io())===12.2&&be("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(D(yt,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new Ur(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new x(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new x(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new Ur(e,o))},i.onupgradeneeded=s=>{D(yt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${o.version}`);this.B.q(o,i.transaction,s.oldVersion,this.version).next(()=>{D(yt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",t=>{let r=t.target;this.L=r.version},{passive:!0})),this.db.addEventListener("versionchange",t=>{var r;t.newVersion===null&&(gt('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(r=this.databaseDeletedListener)===null||r===void 0||r.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}async runTransaction(e,t,r,i){let s=t==="readonly",o=0;for(;;){++o;try{this.db=await this.k(e);let a=Ql.open(this.db,e,s?"readonly":"readwrite",r),c=i(a).next(u=>(a.v(),u)).catch(u=>(a.abort(u),C.reject(u))).toPromise();return c.catch(()=>{}),await a.D,c}catch(a){let c=a,u=c.name!=="FirebaseError"&&o<3;if(D(yt,"Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}};function vw(n){let e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var dd=class{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return Dr(this.$.delete())}},Ur=class extends x{constructor(e,t){super(R.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function cr(n){return n.name==="IndexedDbTransactionError"}var fd=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(D(yt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(D(yt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Dr(r)}add(e){return D(yt,"ADD",this.store.name,e,e),Dr(this.store.add(e))}get(e){return Dr(this.store.get(e)).next(t=>(t===void 0&&(t=null),D(yt,"GET",this.store.name,e,t),t))}delete(e){return D(yt,"DELETE",this.store.name,e),Dr(this.store.delete(e))}count(){return D(yt,"COUNT",this.store.name),Dr(this.store.count())}j(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new C((o,a)=>{s.onerror=c=>{a(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.J(s,(a,c)=>{o.push(c)}).next(()=>o)}}H(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new C((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}Y(e,t){D(yt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.Z=!1;let i=this.cursor(r);return this.J(i,(s,o,a)=>a.delete())}X(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.J(i,t)}ee(e){let t=this.cursor({});return new C((r,i)=>{t.onerror=s=>{let o=mp(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}J(e,t){let r=[];return new C((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let c=new dd(a),u=t(a.primaryKey,a.value,c);if(u instanceof C){let d=u.catch(p=>(c.done(),C.reject(p)));r.push(d)}c.isDone?i():c.W===null?a.continue():a.continue(c.W)}}).next(()=>C.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.Z?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Dr(n){return new C((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=mp(r.target.error);t(i)}})}var nv=!1;function mp(n){let e=Jn.M(io());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new x("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nv||(nv=!0,setTimeout(()=>{throw r},0)),r}}return n}var So="IndexBackfiller",pd=class{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(e){D(So,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let t=await this.te.re();D(So,`Documents written: ${t}`)}catch(t){cr(t)?D(So,"Ignoring IndexedDB error during index backfill: ",t):await lr(t)}await this.ne(6e4)})}},gd=class{constructor(e,t){this.localStore=e,this.persistence=t}async re(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ie(t,e))}ie(e,t){let r=new Set,i=t,s=!0;return C.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return D(So,`Processing collection: ${o}`),this.se(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}se(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.oe(i,s)).next(a=>(D(So,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}oe(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=_w(s);gp(o,r)>0&&(r=o)}),new Rt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var vt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}n.ue=-1;return n})(),Qn=-1;function sa(n){return n==null}function Oo(n){return n===0&&1/n==-1/0}function ww(n){return typeof n=="number"&&Number.isInteger(n)&&!Oo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var Hl="";function et(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=rv(e)),e=QS(n.get(t),e);return rv(e)}function QS(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case Hl:t+="";break;default:t+=s}}return t}function rv(n){return n+Hl+""}function Kt(n){let e=n.length;if(j(e>=2,64408,{path:n}),e===2)return j(n.charAt(0)===Hl&&n.charAt(1)==="",56145,{path:n}),re.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Hl,s);switch((o<0||o>t)&&U(50515,{path:n}),n.charAt(o+1)){case"":let a=n.substring(s,o),c;i.length===0?c=a:(i+=a,c=i,i=""),r.push(c);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:U(61167,{path:n})}s=o+2}return new re(r)}var xr="remoteDocuments",oa="owner",Ii="owner",Fo="mutationQueues",HS="userId",Ot="mutations",iv="batchId",Mr="userMutationsIndex",sv=["userId","batchId"];function Fl(n,e){return[n,et(e)]}function Ew(n,e,t){return[n,et(e),t]}var YS={},qi="documentMutations",Yl="remoteDocumentsV14",XS=["prefixPath","collectionGroup","readTime","documentId"],Ml="documentKeyIndex",JS=["prefixPath","collectionGroup","documentId"],Tw="collectionGroupIndex",ZS=["collectionGroup","readTime","prefixPath","documentId"],Mo="remoteDocumentGlobal",md="remoteDocumentGlobalKey",ji="targets",Iw="queryTargetsIndex",eb=["canonicalId","targetId"],Gi="targetDocuments",tb=["targetId","path"],_p="documentTargetsIndex",nb=["path","targetId"],Xl="targetGlobalKey",Br="targetGlobal",Lo="collectionParents",rb=["collectionId","parent"],zi="clientMetadata",ib="clientId",Kc="bundles",sb="bundleId",$c="namedQueries",ob="name",yp="indexConfiguration",ab="indexId",_d="collectionGroupIndex",lb="collectionGroup",bo="indexState",cb=["indexId","uid"],Aw="sequenceNumberIndex",ub=["uid","sequenceNumber"],Co="indexEntries",hb=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Sw="documentKeyIndex",db=["indexId","uid","orderedDocumentKey"],Qc="documentOverlays",fb=["userId","collectionPath","documentId"],yd="collectionPathOverlayIndex",pb=["userId","collectionPath","largestBatchId"],bw="collectionGroupOverlayIndex",gb=["userId","collectionGroup","largestBatchId"],vp="globals",mb="name",Cw=[Fo,Ot,qi,xr,ji,oa,Br,Gi,zi,Mo,Lo,Kc,$c],_b=[...Cw,Qc],Rw=[Fo,Ot,qi,Yl,ji,oa,Br,Gi,zi,Mo,Lo,Kc,$c,Qc],Pw=Rw,wp=[...Pw,yp,bo,Co],yb=wp,Nw=[...wp,vp],vb=Nw;var Uo=class extends $l{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}};function Ue(n,e){let t=L(n);return Jn.N(t.ce,e)}function ov(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ur(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function kw(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var _e=class n{constructor(e,t){this.comparator=e,this.root=t||Qt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Qt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Vi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Vi(this.root,e,this.comparator,!1)}getReverseIterator(){return new Vi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Vi(this.root,e,this.comparator,!0)}},Vi=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Qt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw U(43730,{key:this.key,value:this.value});if(this.right.isRed())throw U(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw U(27949);return e+(this.isRed()?0:1)}};Qt.EMPTY=null,Qt.RED=!0,Qt.BLACK=!1;Qt.EMPTY=new class{constructor(){this.size=0}get key(){throw U(57766)}get value(){throw U(16141)}get color(){throw U(16727)}get left(){throw U(29726)}get right(){throw U(36894)}copy(e,t,r,i,s){return this}insert(e,t,r){return new Qt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var he=class n{constructor(e){this.comparator=e,this.data=new _e(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Jl(this.data.getIterator())}getIteratorFrom(e){return new Jl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Jl=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Ai(n){return n.hasNext()?n.getNext():void 0}var wt=class n{constructor(e){this.fields=e,e.sort(Ce.comparator)}static empty(){return new n([])}unionWith(e){let t=new he(Ce.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Li(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var Zl=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function xw(){return typeof atob<"u"}var Pe=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Zl("Invalid base64 string: "+s):s}})(e);return new n(t)}static fromUint8Array(e){let t=(function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s})(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return $(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Pe.EMPTY_BYTE_STRING=new Pe("");var wb=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mn(n){if(j(!!n,39018),typeof n=="string"){let e=0,t=wb.exec(n);if(j(!!t,46558,{timestamp:n}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ye(n.seconds),nanos:ye(n.nanos)}}function ye(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _n(n){return typeof n=="string"?Pe.fromBase64String(n):Pe.fromUint8Array(n)}var Dw="server_timestamp",Vw="__type__",Ow="__previous_value__",Fw="__local_write_time__";function Hc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Vw])===null||t===void 0?void 0:t.stringValue)===Dw}function Yc(n){let e=n.mapValue.fields[Ow];return Hc(e)?Yc(e):e}function Bo(n){let e=mn(n.mapValue.fields[Fw].timestampValue);return new pe(e.seconds,e.nanos)}var vd=class{constructor(e,t,r,i,s,o,a,c,u,d){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u,this.isUsingEmulator=d}},wd="(default)",Zn=class n{constructor(e,t){this.projectId=e,this.database=t||wd}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===wd}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Ep="__type__",Mw="__max__",Kn={mapValue:{fields:{__type__:{stringValue:Mw}}}},Tp="__vector__",Wi="value",Ll={nullValue:"NULL_VALUE"};function er(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Hc(n)?4:Lw(n)?9007199254740991:Xc(n)?10:11:U(28295,{value:n})}function Jt(n,e){if(n===e)return!0;let t=er(n);if(t!==er(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Bo(n).isEqual(Bo(e));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=mn(i.timestampValue),a=mn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(i,s){return _n(i.bytesValue).isEqual(_n(s.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(i,s){return ye(i.geoPointValue.latitude)===ye(s.geoPointValue.latitude)&&ye(i.geoPointValue.longitude)===ye(s.geoPointValue.longitude)})(n,e);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return ye(i.integerValue)===ye(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=ye(i.doubleValue),a=ye(s.doubleValue);return o===a?Oo(o)===Oo(a):isNaN(o)&&isNaN(a)}return!1})(n,e);case 9:return Li(n.arrayValue.values||[],e.arrayValue.values||[],Jt);case 10:case 11:return(function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(ov(o)!==ov(a))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!Jt(o[c],a[c])))return!1;return!0})(n,e);default:return U(52216,{left:n})}}function qo(n,e){return(n.values||[]).find(t=>Jt(t,e))!==void 0}function tr(n,e){if(n===e)return 0;let t=er(n),r=er(e);if(t!==r)return $(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return $(n.booleanValue,e.booleanValue);case 2:return(function(s,o){let a=ye(s.integerValue||s.doubleValue),c=ye(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1})(n,e);case 3:return av(n.timestampValue,e.timestampValue);case 4:return av(Bo(n),Bo(e));case 5:return ud(n.stringValue,e.stringValue);case 6:return(function(s,o){let a=_n(s),c=_n(o);return a.compareTo(c)})(n.bytesValue,e.bytesValue);case 7:return(function(s,o){let a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){let d=$(a[u],c[u]);if(d!==0)return d}return $(a.length,c.length)})(n.referenceValue,e.referenceValue);case 8:return(function(s,o){let a=$(ye(s.latitude),ye(o.latitude));return a!==0?a:$(ye(s.longitude),ye(o.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return lv(n.arrayValue,e.arrayValue);case 10:return(function(s,o){var a,c,u,d;let p=s.fields||{},g=o.fields||{},y=(a=p[Wi])===null||a===void 0?void 0:a.arrayValue,S=(c=g[Wi])===null||c===void 0?void 0:c.arrayValue,N=$(((u=y?.values)===null||u===void 0?void 0:u.length)||0,((d=S?.values)===null||d===void 0?void 0:d.length)||0);return N!==0?N:lv(y,S)})(n.mapValue,e.mapValue);case 11:return(function(s,o){if(s===Kn.mapValue&&o===Kn.mapValue)return 0;if(s===Kn.mapValue)return 1;if(o===Kn.mapValue)return-1;let a=s.fields||{},c=Object.keys(a),u=o.fields||{},d=Object.keys(u);c.sort(),d.sort();for(let p=0;p<c.length&&p<d.length;++p){let g=ud(c[p],d[p]);if(g!==0)return g;let y=tr(a[c[p]],u[d[p]]);if(y!==0)return y}return $(c.length,d.length)})(n.mapValue,e.mapValue);default:throw U(23264,{le:t})}}function av(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return $(n,e);let t=mn(n),r=mn(e),i=$(t.seconds,r.seconds);return i!==0?i:$(t.nanos,r.nanos)}function lv(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=tr(t[i],r[i]);if(s)return s}return $(t.length,r.length)}function Ki(n){return Ed(n)}function Ed(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){let r=mn(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return _n(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return M.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=Ed(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Ed(t.fields[o])}`;return i+"}"})(n.mapValue):U(61005,{value:n})}function Ul(n){switch(er(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Yc(n);return e?16+Ul(e):16;case 5:return 2*n.stringValue.length;case 6:return _n(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,s)=>i+Ul(s),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return ur(r.fields,(s,o)=>{i+=s.length+Ul(o)}),i})(n.mapValue);default:throw U(13486,{value:n})}}function qr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Td(n){return!!n&&"integerValue"in n}function jo(n){return!!n&&"arrayValue"in n}function cv(n){return!!n&&"nullValue"in n}function uv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Bl(n){return!!n&&"mapValue"in n}function Xc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Ep])===null||t===void 0?void 0:t.stringValue)===Tp}function Ro(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return ur(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ro(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ro(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Lw(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Mw}var Uw={mapValue:{fields:{[Ep]:{stringValue:Tp},[Wi]:{arrayValue:{}}}}};function Eb(n){return"nullValue"in n?Ll:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?qr(Zn.empty(),M.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?Xc(n)?Uw:{mapValue:{}}:U(35942,{value:n})}function Tb(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?qr(Zn.empty(),M.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?Uw:"mapValue"in n?Xc(n)?{mapValue:{}}:Kn:U(61959,{value:n})}function hv(n,e){let t=tr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function dv(n,e){let t=tr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Ze=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Bl(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ro(t)}setAll(e){let t=Ce.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Ro(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Bl(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Jt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Bl(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){ur(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Ro(this.value))}};function Bw(n){let e=[];return ur(n.fields,(t,r)=>{let i=new Ce([t]);if(Bl(r)){let s=Bw(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new wt(e)}var Oe=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,G.min(),G.min(),G.min(),Ze.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,G.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,G.min(),G.min(),Ze.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,G.min(),G.min(),Ze.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ze.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ze.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Zt=class{constructor(e,t){this.position=e,this.inclusive=t}};function fv(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=M.comparator(M.fromName(o.referenceValue),t.key):r=tr(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function pv(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Jt(n.position[t],e.position[t]))return!1;return!0}var jr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Ib(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ec=class{},ne=class n extends ec{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Sd(e,t,r):t==="array-contains"?new Rd(e,r):t==="in"?new tc(e,r):t==="not-in"?new Pd(e,r):t==="array-contains-any"?new Nd(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new bd(e,r):new Cd(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(tr(t,this.value)):t!==null&&er(this.value)===er(t)&&this.matchesComparison(tr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return U(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ce=class n extends ec{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new n(e,t)}matches(e){return $i(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function $i(n){return n.op==="and"}function Id(n){return n.op==="or"}function Ip(n){return qw(n)&&$i(n)}function qw(n){for(let e of n.filters)if(e instanceof ce)return!1;return!0}function Ad(n){if(n instanceof ne)return n.field.canonicalString()+n.op.toString()+Ki(n.value);if(Ip(n))return n.filters.map(e=>Ad(e)).join(",");{let e=n.filters.map(t=>Ad(t)).join(",");return`${n.op}(${e})`}}function jw(n,e){return n instanceof ne?(function(r,i){return i instanceof ne&&r.op===i.op&&r.field.isEqual(i.field)&&Jt(r.value,i.value)})(n,e):n instanceof ce?(function(r,i){return i instanceof ce&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&jw(o,i.filters[a]),!0):!1})(n,e):void U(19439)}function Gw(n,e){let t=n.filters.concat(e);return ce.create(t,n.op)}function zw(n){return n instanceof ne?(function(t){return`${t.field.canonicalString()} ${t.op} ${Ki(t.value)}`})(n):n instanceof ce?(function(t){return t.op.toString()+" {"+t.getFilters().map(zw).join(" ,")+"}"})(n):"Filter"}var Sd=class extends ne{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){let t=M.comparator(e.key,this.key);return this.matchesComparison(t)}},bd=class extends ne{constructor(e,t){super(e,"in",t),this.keys=Ww("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Cd=class extends ne{constructor(e,t){super(e,"not-in",t),this.keys=Ww("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Ww(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>M.fromName(r.referenceValue))}var Rd=class extends ne{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return jo(t)&&qo(t.arrayValue,this.value)}},tc=class extends ne{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&qo(this.value.arrayValue,t)}},Pd=class extends ne{constructor(e,t){super(e,"not-in",t)}matches(e){if(qo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!qo(this.value.arrayValue,t)}},Nd=class extends ne{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!jo(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>qo(this.value.arrayValue,r))}};var kd=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.Pe=null}};function xd(n,e=null,t=[],r=[],i=null,s=null,o=null){return new kd(n,e,t,r,i,s,o)}function Gr(n){let e=L(n);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Ad(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>(function(s){return s.field.canonicalString()+s.dir})(r)).join(","),sa(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Ki(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Ki(r)).join(",")),e.Pe=t}return e.Pe}function aa(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Ib(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!jw(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!pv(n.startAt,e.startAt)&&pv(n.endAt,e.endAt)}function nc(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function rc(n,e){return n.filters.filter(t=>t instanceof ne&&t.field.isEqual(e))}function gv(n,e,t){let r=Ll,i=!0;for(let s of rc(n,e)){let o=Ll,a=!0;switch(s.op){case"<":case"<=":o=Eb(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Ll}hv({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];hv({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function mv(n,e,t){let r=Kn,i=!0;for(let s of rc(n,e)){let o=Kn,a=!0;switch(s.op){case">=":case">":o=Tb(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Kn}dv({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];dv({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var Ft=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function Kw(n,e,t,r,i,s,o,a){return new Ft(n,e,t,r,i,s,o,a)}function ls(n){return new Ft(n)}function _v(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ap(n){return n.collectionGroup!==null}function Fi(n){let e=L(n);if(e.Te===null){e.Te=[];let t=new Set;for(let s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new he(Ce.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new jr(s,r))}),t.has(Ce.keyField().canonicalString())||e.Te.push(new jr(Ce.keyField(),r))}return e.Te}function st(n){let e=L(n);return e.Ie||(e.Ie=Ab(e,Fi(n))),e.Ie}function Ab(n,e){if(n.limitType==="F")return xd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new jr(i.field,s)});let t=n.endAt?new Zt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Zt(n.startAt.position,n.startAt.inclusive):null;return xd(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Dd(n,e){let t=n.filters.concat([e]);return new Ft(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function ic(n,e,t){return new Ft(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function la(n,e){return aa(st(n),st(e))&&n.limitType===e.limitType}function $w(n){return`${Gr(st(n))}|lt:${n.limitType}`}function Ni(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>zw(i)).join(", ")}]`),sa(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Ki(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Ki(i)).join(",")),`Target(${r})`})(st(n))}; limitType=${n.limitType})`}function ca(n,e){return e.isFoundDocument()&&(function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):M.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,e)&&(function(r,i){for(let s of Fi(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,e)&&(function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0})(n,e)&&(function(r,i){return!(r.startAt&&!(function(o,a,c){let u=fv(o,a,c);return o.inclusive?u<=0:u<0})(r.startAt,Fi(r),i)||r.endAt&&!(function(o,a,c){let u=fv(o,a,c);return o.inclusive?u>=0:u>0})(r.endAt,Fi(r),i))})(n,e)}function Qw(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Hw(n){return(e,t)=>{let r=!1;for(let i of Fi(n)){let s=Sb(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function Sb(n,e,t){let r=n.field.isKeyField()?M.comparator(e.key,t.key):(function(s,o,a){let c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?tr(c,u):U(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return U(19790,{direction:n.dir})}}var Mt=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ur(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return kw(this.inner)}size(){return this.innerSize}};var bb=new _e(M.comparator);function ft(){return bb}var Yw=new _e(M.comparator);function Io(...n){let e=Yw;for(let t of n)e=e.insert(t.key,t);return e}function Xw(n){let e=Yw;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function $t(){return Po()}function Jw(){return Po()}function Po(){return new Mt(n=>n.toString(),(n,e)=>n.isEqual(e))}var Cb=new _e(M.comparator),Rb=new he(M.comparator);function X(...n){let e=Rb;for(let t of n)e=e.add(t);return e}var Pb=new he($);function Sp(){return Pb}function bp(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Oo(e)?"-0":e}}function Zw(n){return{integerValue:""+n}}function eE(n,e){return ww(e)?Zw(e):bp(n,e)}var Qi=class{constructor(){this._=void 0}};function Nb(n,e,t){return n instanceof nr?(function(i,s){let o={fields:{[Vw]:{stringValue:Dw},[Fw]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Hc(s)&&(s=Yc(s)),s&&(o.fields[Ow]=s),{mapValue:o}})(t,e):n instanceof yn?nE(n,e):n instanceof vn?rE(n,e):(function(i,s){let o=tE(i,s),a=yv(o)+yv(i.Ee);return Td(o)&&Td(i.Ee)?Zw(a):bp(i.serializer,a)})(n,e)}function kb(n,e,t){return n instanceof yn?nE(n,e):n instanceof vn?rE(n,e):t}function tE(n,e){return n instanceof rr?(function(r){return Td(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(e)?e:{integerValue:0}:null}var nr=class extends Qi{},yn=class extends Qi{constructor(e){super(),this.elements=e}};function nE(n,e){let t=iE(e);for(let r of n.elements)t.some(i=>Jt(i,r))||t.push(r);return{arrayValue:{values:t}}}var vn=class extends Qi{constructor(e){super(),this.elements=e}};function rE(n,e){let t=iE(e);for(let r of n.elements)t=t.filter(i=>!Jt(i,r));return{arrayValue:{values:t}}}var rr=class extends Qi{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function yv(n){return ye(n.integerValue||n.doubleValue)}function iE(n){return jo(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var zr=class{constructor(e,t){this.field=e,this.transform=t}};function xb(n,e){return n.field.isEqual(e.field)&&(function(r,i){return r instanceof yn&&i instanceof yn||r instanceof vn&&i instanceof vn?Li(r.elements,i.elements,Jt):r instanceof rr&&i instanceof rr?Jt(r.Ee,i.Ee):r instanceof nr&&i instanceof nr})(n.transform,e.transform)}var Vd=class{constructor(e,t){this.version=e,this.transformResults=t}},Ae=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function ql(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Hi=class{};function sE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new sr(n.key,Ae.none()):new ir(n.key,n.data,Ae.none());{let t=n.data,r=Ze.empty(),i=new he(Ce.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Lt(n.key,r,new wt(i.toArray()),Ae.none())}}function Db(n,e,t){n instanceof ir?(function(i,s,o){let a=i.value.clone(),c=wv(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()})(n,e,t):n instanceof Lt?(function(i,s,o){if(!ql(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=wv(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(oE(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(n,e,t):(function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()})(0,e,t)}function No(n,e,t,r){return n instanceof ir?(function(s,o,a,c){if(!ql(s.precondition,o))return a;let u=s.value.clone(),d=Ev(s.fieldTransforms,c,o);return u.setAll(d),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null})(n,e,t,r):n instanceof Lt?(function(s,o,a,c){if(!ql(s.precondition,o))return a;let u=Ev(s.fieldTransforms,c,o),d=o.data;return d.setAll(oE(s)),d.setAll(u),o.convertToFoundDocument(o.version,d).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))})(n,e,t,r):(function(s,o,a){return ql(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a})(n,e,t)}function Vb(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=tE(r.transform,i||null);s!=null&&(t===null&&(t=Ze.empty()),t.set(r.field,s))}return t||null}function vv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Li(r,i,(s,o)=>xb(s,o))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var ir=class extends Hi{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Lt=class extends Hi{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function oE(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function wv(n,e,t){let r=new Map;j(n.length===t.length,32656,{Ae:t.length,Re:n.length});for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,kb(o,a,t[i]))}return r}function Ev(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,Nb(s,o,e))}return r}var sr=class extends Hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Go=class extends Hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var zo=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&Db(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=No(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=No(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=Jw();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let c=sE(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(G.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),X())}isEqual(e){return this.batchId===e.batchId&&Li(this.mutations,e.mutations,(t,r)=>vv(t,r))&&Li(this.baseMutations,e.baseMutations,(t,r)=>vv(t,r))}},Od=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){j(e.mutations.length===r.length,58842,{Ve:e.mutations.length,me:r.length});let i=(function(){return Cb})(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Wo=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Fd=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ke,ie;function aE(n){switch(n){case R.OK:return U(64938);case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return U(15467,{code:n})}}function lE(n){if(n===void 0)return be("GRPC error has no .code"),R.UNKNOWN;switch(n){case ke.OK:return R.OK;case ke.CANCELLED:return R.CANCELLED;case ke.UNKNOWN:return R.UNKNOWN;case ke.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case ke.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case ke.INTERNAL:return R.INTERNAL;case ke.UNAVAILABLE:return R.UNAVAILABLE;case ke.UNAUTHENTICATED:return R.UNAUTHENTICATED;case ke.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case ke.NOT_FOUND:return R.NOT_FOUND;case ke.ALREADY_EXISTS:return R.ALREADY_EXISTS;case ke.PERMISSION_DENIED:return R.PERMISSION_DENIED;case ke.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case ke.ABORTED:return R.ABORTED;case ke.OUT_OF_RANGE:return R.OUT_OF_RANGE;case ke.UNIMPLEMENTED:return R.UNIMPLEMENTED;case ke.DATA_LOSS:return R.DATA_LOSS;default:return U(39323,{code:n})}}(ie=ke||(ke={}))[ie.OK=0]="OK",ie[ie.CANCELLED=1]="CANCELLED",ie[ie.UNKNOWN=2]="UNKNOWN",ie[ie.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ie[ie.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ie[ie.NOT_FOUND=5]="NOT_FOUND",ie[ie.ALREADY_EXISTS=6]="ALREADY_EXISTS",ie[ie.PERMISSION_DENIED=7]="PERMISSION_DENIED",ie[ie.UNAUTHENTICATED=16]="UNAUTHENTICATED",ie[ie.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ie[ie.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ie[ie.ABORTED=10]="ABORTED",ie[ie.OUT_OF_RANGE=11]="OUT_OF_RANGE",ie[ie.UNIMPLEMENTED=12]="UNIMPLEMENTED",ie[ie.INTERNAL=13]="INTERNAL",ie[ie.UNAVAILABLE=14]="UNAVAILABLE",ie[ie.DATA_LOSS=15]="DATA_LOSS";var Tv=null;var Ob=new dn([4294967295,4294967295],0);function Iv(n){let e=dp().encode(n),t=new Wh;return t.update(e),new Uint8Array(t.digest())}function Av(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new dn([t,r],0),new dn([i,s],0)]}var Md=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Lr(`Invalid padding: ${t}`);if(r<0)throw new Lr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Lr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new Lr(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=dn.fromNumber(this.fe)}pe(e,t,r){let i=e.add(t.multiply(dn.fromNumber(r)));return i.compare(Ob)===1&&(i=new dn([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=Iv(e),[r,i]=Av(t);for(let s=0;s<this.hashCount;s++){let o=this.pe(r,i,s);if(!this.ye(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.fe===0)return;let t=Iv(e),[r,i]=Av(t);for(let s=0;s<this.hashCount;s++){let o=this.pe(r,i,s);this.we(o)}}we(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},Lr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Ko=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,$o.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(G.min(),i,new _e($),ft(),X())}},$o=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,X(),X(),X())}};var Mi=class{constructor(e,t,r,i){this.Se=e,this.removedTargetIds=t,this.key=r,this.be=i}},sc=class{constructor(e,t){this.targetId=e,this.De=t}},oc=class{constructor(e,t,r=Pe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},ac=class{constructor(){this.ve=0,this.Ce=Sv(),this.Fe=Pe.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=X(),t=X(),r=X();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:U(38017,{changeType:s})}}),new $o(this.Fe,this.Me,e,t,r)}ke(){this.xe=!1,this.Ce=Sv()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,j(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},Ld=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=ft(),this.je=kl(),this.Je=kl(),this.He=new _e($)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let r=this.tt(t);switch(e.state){case 0:this.nt(t)&&r.Be(e.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(e.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(r.Ke(),r.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),r.Be(e.resumeToken));break;default:U(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((r,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,r=e.De.count,i=this.st(t);if(i){let s=i.target;if(nc(s))if(r===0){let o=new M(s.path);this.Xe(t,o,Oe.newNoDocument(o,G.min()))}else j(r===1,20013,{expectedCount:r});else{let o=this.ot(t);if(o!==r){let a=this._t(e),c=a?this.ut(a,e,o):1;if(c!==0){this.rt(t);let u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,u)}Tv?.ct((function(d,p,g,y,S){var N,k,q,B,O,z;let Q={localCacheCount:d,existenceFilterCount:p.count,databaseId:g.database,projectId:g.projectId},H=p.unchangedNames;return H&&(Q.bloomFilter={applied:S===0,hashCount:(N=H?.hashCount)!==null&&N!==void 0?N:0,bitmapLength:(B=(q=(k=H?.bits)===null||k===void 0?void 0:k.bitmap)===null||q===void 0?void 0:q.length)!==null&&B!==void 0?B:0,padding:(z=(O=H?.bits)===null||O===void 0?void 0:O.padding)!==null&&z!==void 0?z:0,mightContain:E=>{var _;return(_=y?.mightContain(E))!==null&&_!==void 0&&_}}),Q})(o,e.De,this.We.lt(),a,c))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=_n(r).toUint8Array()}catch(c){if(c instanceof Zl)return gt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new Md(o,i,s)}catch(c){return gt(c instanceof Lr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.fe===0?null:a}ut(e,t,r){return t.De.count===r-this.ht(e,t.targetId)?0:2}ht(e,t){let r=this.We.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.We.lt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.Xe(t,s,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((s,o)=>{let a=this.st(o);if(a){if(s.current&&nc(a.target)){let c=new M(a.target.path);this.Tt(c).has(o)||this.It(o,c)||this.Xe(o,c,Oe.newNoDocument(c,e))}s.Ne&&(t.set(o,s.Le()),s.ke())}});let r=X();this.Je.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{let u=this.st(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.ze.forEach((s,o)=>o.setReadTime(e));let i=new Ko(e,t,this.He,this.ze,r);return this.ze=ft(),this.je=kl(),this.Je=kl(),this.He=new _e($),i}Ze(e,t){if(!this.nt(e))return;let r=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,r),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,r){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),r&&(this.ze=this.ze.insert(t,r))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new ac,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new he($),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new he($),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||D("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new ac),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function kl(){return new _e(M.comparator)}function Sv(){return new _e(M.comparator)}var Fb={asc:"ASCENDING",desc:"DESCENDING"},Mb={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Lb={and:"AND",or:"OR"},Ud=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Bd(n,e){return n.useProto3Json||sa(e)?e:{value:e}}function Yi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Ub(n,e){return Yi(n,e.toTimestamp())}function Re(n){return j(!!n,49232),G.fromTimestamp((function(t){let r=mn(t);return new pe(r.seconds,r.nanos)})(n))}function Cp(n,e){return qd(n,e).canonicalString()}function qd(n,e){let t=(function(i){return new re(["projects",i.projectId,"databases",i.database])})(n).child("documents");return e===void 0?t:t.child(e)}function uE(n){let e=re.fromString(n);return j(wE(e),10190,{key:e.toString()}),e}function Qo(n,e){return Cp(n.databaseId,e.path)}function Ht(n,e){let t=uE(e);if(t.get(1)!==n.databaseId.projectId)throw new x(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new x(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(fE(t))}function hE(n,e){return Cp(n.databaseId,e)}function dE(n){let e=uE(n);return e.length===4?re.emptyPath():fE(e)}function jd(n){return new re(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function fE(n){return j(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function bv(n,e,t){return{name:Qo(n,e),fields:t.value.mapValue.fields}}function pE(n,e,t){let r=Ht(n,e.name),i=Re(e.updateTime),s=e.createTime?Re(e.createTime):G.min(),o=new Ze({mapValue:{fields:e.fields}}),a=Oe.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function Bb(n,e){return"found"in e?(function(r,i){j(!!i.found,43571),i.found.name,i.found.updateTime;let s=Ht(r,i.found.name),o=Re(i.found.updateTime),a=i.found.createTime?Re(i.found.createTime):G.min(),c=new Ze({mapValue:{fields:i.found.fields}});return Oe.newFoundDocument(s,o,a,c)})(n,e):"missing"in e?(function(r,i){j(!!i.missing,3894),j(!!i.readTime,22933);let s=Ht(r,i.missing),o=Re(i.readTime);return Oe.newNoDocument(s,o)})(n,e):U(7234,{result:e})}function qb(n,e){let t;if("targetChange"in e){e.targetChange;let r=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:U(39313,{state:u})})(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=(function(u,d){return u.useProto3Json?(j(d===void 0||typeof d=="string",58123),Pe.fromBase64String(d||"")):(j(d===void 0||d instanceof Buffer||d instanceof Uint8Array,16193),Pe.fromUint8Array(d||new Uint8Array))})(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&(function(u){let d=u.code===void 0?R.UNKNOWN:lE(u.code);return new x(d,u.message||"")})(o);t=new oc(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Ht(n,r.document.name),s=Re(r.document.updateTime),o=r.document.createTime?Re(r.document.createTime):G.min(),a=new Ze({mapValue:{fields:r.document.fields}}),c=Oe.newFoundDocument(i,s,o,a),u=r.targetIds||[],d=r.removedTargetIds||[];t=new Mi(u,d,c.key,c)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Ht(n,r.document),s=r.readTime?Re(r.readTime):G.min(),o=Oe.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Mi([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Ht(n,r.document),s=r.removedTargetIds||[];t=new Mi([],s,i,null)}else{if(!("filter"in e))return U(11601,{At:e});{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new Fd(i,s),a=r.targetId;t=new sc(a,o)}}return t}function Ho(n,e){let t;if(e instanceof ir)t={update:bv(n,e.key,e.value)};else if(e instanceof sr)t={delete:Qo(n,e.key)};else if(e instanceof Lt)t={update:bv(n,e.key,e.data),updateMask:$b(e.fieldMask)};else{if(!(e instanceof Go))return U(16599,{Rt:e.type});t={verify:Qo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>(function(s,o){let a=o.transform;if(a instanceof nr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof yn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof vn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof rr)return{fieldPath:o.field.canonicalString(),increment:a.Ee};throw U(20930,{transform:o.transform})})(0,r))),e.precondition.isNone||(t.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:Ub(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:U(27497)})(n,e.precondition)),t}function Gd(n,e){let t=e.currentDocument?(function(s){return s.updateTime!==void 0?Ae.updateTime(Re(s.updateTime)):s.exists!==void 0?Ae.exists(s.exists):Ae.none()})(e.currentDocument):Ae.none(),r=e.updateTransforms?e.updateTransforms.map(i=>(function(o,a){let c=null;if("setToServerValue"in a)j(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),c=new nr;else if("appendMissingElements"in a){let d=a.appendMissingElements.values||[];c=new yn(d)}else if("removeAllFromArray"in a){let d=a.removeAllFromArray.values||[];c=new vn(d)}else"increment"in a?c=new rr(o,a.increment):U(16584,{proto:a});let u=Ce.fromServerFormat(a.fieldPath);return new zr(u,c)})(n,i)):[];if(e.update){e.update.name;let i=Ht(n,e.update.name),s=new Ze({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=(function(c){let u=c.fieldPaths||[];return new wt(u.map(d=>Ce.fromServerFormat(d)))})(e.updateMask);return new Lt(i,s,o,t,r)}return new ir(i,s,t,r)}if(e.delete){let i=Ht(n,e.delete);return new sr(i,t)}if(e.verify){let i=Ht(n,e.verify);return new Go(i,t)}return U(1463,{proto:e})}function jb(n,e){return n&&n.length>0?(j(e!==void 0,14353),n.map(t=>(function(i,s){let o=i.updateTime?Re(i.updateTime):Re(s);return o.isEqual(G.min())&&(o=Re(s)),new Vd(o,i.transformResults||[])})(t,e))):[]}function gE(n,e){return{documents:[hE(n,e.path)]}}function mE(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=hE(n,i);let s=(function(u){if(u.length!==0)return vE(ce.create(u,"and"))})(e.filters);s&&(t.structuredQuery.where=s);let o=(function(u){if(u.length!==0)return u.map(d=>(function(g){return{field:ki(g.field),direction:zb(g.dir)}})(d))})(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=Bd(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(e.endAt)),{Vt:t,parent:i}}function _E(n){let e=dE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){j(r===1,65062);let d=t.from[0];d.allDescendants?i=d.collectionId:e=e.child(d.collectionId)}let s=[];t.where&&(s=(function(p){let g=yE(p);return g instanceof ce&&Ip(g)?g.getFilters():[g]})(t.where));let o=[];t.orderBy&&(o=(function(p){return p.map(g=>(function(S){return new jr(xi(S.field),(function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(S.direction))})(g))})(t.orderBy));let a=null;t.limit&&(a=(function(p){let g;return g=typeof p=="object"?p.value:p,sa(g)?null:g})(t.limit));let c=null;t.startAt&&(c=(function(p){let g=!!p.before,y=p.values||[];return new Zt(y,g)})(t.startAt));let u=null;return t.endAt&&(u=(function(p){let g=!p.before,y=p.values||[];return new Zt(y,g)})(t.endAt)),Kw(e,i,o,s,a,"F",c,u)}function Gb(n,e){let t=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return U(28987,{purpose:i})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function yE(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=xi(t.unaryFilter.field);return ne.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=xi(t.unaryFilter.field);return ne.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=xi(t.unaryFilter.field);return ne.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=xi(t.unaryFilter.field);return ne.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return U(61313);default:return U(60726)}})(n):n.fieldFilter!==void 0?(function(t){return ne.create(xi(t.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return U(58110);default:return U(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return ce.create(t.compositeFilter.filters.map(r=>yE(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return U(1026)}})(t.compositeFilter.op))})(n):U(30097,{filter:n})}function zb(n){return Fb[n]}function Wb(n){return Mb[n]}function Kb(n){return Lb[n]}function ki(n){return{fieldPath:n.canonicalString()}}function xi(n){return Ce.fromServerFormat(n.fieldPath)}function vE(n){return n instanceof ne?(function(t){if(t.op==="=="){if(uv(t.value))return{unaryFilter:{field:ki(t.field),op:"IS_NAN"}};if(cv(t.value))return{unaryFilter:{field:ki(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(uv(t.value))return{unaryFilter:{field:ki(t.field),op:"IS_NOT_NAN"}};if(cv(t.value))return{unaryFilter:{field:ki(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ki(t.field),op:Wb(t.op),value:t.value}}})(n):n instanceof ce?(function(t){let r=t.getFilters().map(i=>vE(i));return r.length===1?r[0]:{compositeFilter:{op:Kb(t.op),filters:r}}})(n):U(54877,{filter:n})}function $b(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function wE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Xi=class n{constructor(e,t,r,i,s=G.min(),o=G.min(),a=Pe.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var lc=class{constructor(e){this.gt=e}};function Qb(n,e){let t;if(e.document)t=pE(n.gt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=M.fromSegments(e.noDocument.path),i=Kr(e.noDocument.readTime);t=Oe.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U(56709);{let r=M.fromSegments(e.unknownDocument.path),i=Kr(e.unknownDocument.version);t=Oe.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime((function(i){let s=new pe(i[0],i[1]);return G.fromTimestamp(s)})(e.readTime)),t}function Cv(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:cc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=(function(s,o){return{name:Qo(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Yi(s,o.version.toTimestamp()),createTime:Yi(s,o.createTime.toTimestamp())}})(n.gt,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Wr(e.version)};else{if(!e.isUnknownDocument())return U(57904,{document:e});r.unknownDocument={path:t.path.toArray(),version:Wr(e.version)}}return r}function cc(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Wr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Kr(n){let e=new pe(n.seconds,n.nanoseconds);return G.fromTimestamp(e)}function Vr(n,e){let t=(e.baseMutations||[]).map(s=>Gd(n.gt,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Gd(n.gt,s)),i=pe.fromMillis(e.localWriteTimeMs);return new zo(e.batchId,i,t,r)}function Ao(n){let e=Kr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Kr(n.lastLimboFreeSnapshotVersion):G.min(),r;return r=(function(s){return s.documents!==void 0})(n.query)?(function(s){let o=s.documents.length;return j(o===1,1966,{count:o}),st(ls(dE(s.documents[0])))})(n.query):(function(s){return st(_E(s))})(n.query),new Xi(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Pe.fromBase64String(n.resumeToken))}function EE(n,e){let t=Wr(e.snapshotVersion),r=Wr(e.lastLimboFreeSnapshotVersion),i;i=nc(e.target)?gE(n.gt,e.target):mE(n.gt,e.target).Vt;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Gr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Rp(n){let e=_E({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ic(e,e.limit,"L"):e}function Xh(n,e){return new Wo(e.largestBatchId,Gd(n.gt,e.overlayMutation))}function Rv(n,e){let t=e.path.lastSegment();return[n,et(e.path.popLast()),t]}function Pv(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:Wr(r.readTime),documentKey:et(r.documentKey.path),largestBatchId:r.largestBatchId}}var zd=class{getBundleMetadata(e,t){return Nv(e).get(t).next(r=>{if(r)return(function(s){return{id:s.bundleId,createTime:Kr(s.createTime),version:s.version}})(r)})}saveBundleMetadata(e,t){return Nv(e).put((function(i){return{bundleId:i.id,createTime:Wr(Re(i.createTime)),version:i.version}})(t))}getNamedQuery(e,t){return kv(e).get(t).next(r=>{if(r)return(function(s){return{name:s.name,query:Rp(s.bundledQuery),readTime:Kr(s.readTime)}})(r)})}saveNamedQuery(e,t){return kv(e).put((function(i){return{name:i.name,readTime:Wr(Re(i.readTime)),bundledQuery:i.bundledQuery}})(t))}};function Nv(n){return Ue(n,Kc)}function kv(n){return Ue(n,$c)}var uc=class n{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return vo(e).get(Rv(this.userId,t)).next(r=>r?Xh(this.serializer,r):null)}getOverlays(e,t){let r=$t();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Wo(t,o);i.push(this.wt(e,a))}),C.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(et(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(vo(e).Y(yd,a))}),C.waitFor(s)}getOverlaysForCollection(e,t,r){let i=$t(),s=et(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return vo(e).j(yd,o).next(a=>{for(let c of a){let u=Xh(this.serializer,c);i.set(u.getKey(),u)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=$t(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return vo(e).X({index:bw,range:a},(c,u,d)=>{let p=Xh(this.serializer,u);s.size()<i||p.largestBatchId===o?(s.set(p.getKey(),p),o=p.largestBatchId):d.done()}).next(()=>s)}wt(e,t){return vo(e).put((function(i,s,o){let[a,c,u]=Rv(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Ho(i.gt,o.mutation)}})(this.serializer,this.userId,t))}};function vo(n){return Ue(n,Qc)}var Wd=class{St(e){return Ue(e,vp)}getSessionToken(e){return this.St(e).get("sessionToken").next(t=>{let r=t?.value;return r?Pe.fromUint8Array(r):Pe.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}};var pn=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(ye(e.integerValue));else if("doubleValue"in e){let r=ye(e.doubleValue);isNaN(r)?this.Ct(t,13):(this.Ct(t,15),Oo(r)?t.Ft(0):t.Ft(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ct(t,20),typeof r=="string"&&(r=mn(r)),t.Mt(`${r.seconds||""}`),t.Ft(r.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(_n(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Ct(t,45),t.Ft(r.latitude||0),t.Ft(r.longitude||0)}else"mapValue"in e?Lw(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Xc(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):U(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let r=e.fields||{};this.Ct(t,55);for(let i of Object.keys(r))this.xt(i,t),this.Dt(r[i],t)}Lt(e,t){var r,i;let s=e.fields||{};this.Ct(t,53);let o=Wi,a=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(ye(a)),this.xt(o,t),this.Dt(s[o],t)}qt(e,t){let r=e.values||[];this.Ct(t,50);for(let i of r)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),M.fromName(e).path.forEach(r=>{this.Ct(t,60),this.$t(r,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};pn.Ut=new pn;var Si=255;function Hb(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n<<=4),n>>6||(e+=2,n<<=2),n>>7||(e+=1),e}function xv(n){let e=64-(function(r){let i=0;for(let s=0;s<8;++s){let o=Hb(255&r[s]);if(i+=o,o!==8)break}return i})(n);return Math.ceil(e/8)}var Kd=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Wt(r.value),r=t.next();this.Gt()}zt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.jt(r.value),r=t.next();this.Jt()}Ht(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Wt(r);else if(r<2048)this.Wt(960|r>>>6),this.Wt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Wt(480|r>>>12),this.Wt(128|63&r>>>6),this.Wt(128|63&r);else{let i=t.codePointAt(0);this.Wt(240|i>>>18),this.Wt(128|63&i>>>12),this.Wt(128|63&i>>>6),this.Wt(128|63&i)}}this.Gt()}Yt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.jt(r);else if(r<2048)this.jt(960|r>>>6),this.jt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.jt(480|r>>>12),this.jt(128|63&r>>>6),this.jt(128|63&r);else{let i=t.codePointAt(0);this.jt(240|i>>>18),this.jt(128|63&i>>>12),this.jt(128|63&i>>>6),this.jt(128|63&i)}}this.Jt()}Zt(e){let t=this.Xt(e),r=xv(t);this.en(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}tn(e){let t=this.Xt(e),r=xv(t);this.en(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}nn(){this.rn(Si),this.rn(255)}sn(){this._n(Si),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){let t=(function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)})(e),r=!!(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Wt(e){let t=255&e;t===0?(this.rn(0),this.rn(255)):t===Si?(this.rn(Si),this.rn(0)):this.rn(t)}jt(e){let t=255&e;t===0?(this._n(0),this._n(255)):t===Si?(this._n(Si),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},$d=class{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}},Qd=class{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}},Or=class{constructor(){this.un=new Kd,this.cn=new $d(this.un),this.ln=new Qd(this.un)}seed(e){this.un.seed(e)}hn(e){return e===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}};var Fr=class n{constructor(e,t,r,i){this.Pn=e,this.Tn=t,this.In=r,this.dn=i}En(){let e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.dn,0),t!==e?r.set([0],this.dn.length):++r[r.length-1],new n(this.Pn,this.Tn,this.In,r)}An(e,t,r){return{indexId:this.Pn,uid:e,arrayValue:jl(this.In),directionalValue:jl(this.dn),orderedDocumentKey:jl(t),documentKey:r.path.toArray()}}Rn(e,t,r){let i=this.An(e,t,r);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}};function jn(n,e){let t=n.Pn-e.Pn;return t!==0?t:(t=Dv(n.In,e.In),t!==0?t:(t=Dv(n.dn,e.dn),t!==0?t:M.comparator(n.Tn,e.Tn)))}function Dv(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}function jl(n){return Dh()?(function(t){let r="";for(let i=0;i<t.length;i++)r+=String.fromCharCode(t[i]);return r})(n):n}function Vv(n){return typeof n!="string"?n:(function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r})(n)}var hc=class{constructor(e){this.Vn=new he((t,r)=>Ce.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[];for(let t of e.filters){let r=t;r.isInequality()?this.Vn=this.Vn.add(r):this.fn.push(r)}}get gn(){return this.Vn.size>1}pn(e){if(j(e.collectionGroup===this.collectionId,49279),this.gn)return!1;let t=hd(e);if(t!==void 0&&!this.yn(t))return!1;let r=kr(e),i=new Set,s=0,o=0;for(;s<r.length&&this.yn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Vn.size>0){let a=this.Vn.getIterator().getNext();if(!i.has(a.field.canonicalString())){let c=r[s];if(!this.wn(a,c)||!this.Sn(this.mn[o++],c))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.mn.length||!this.Sn(this.mn[o++],a))return!1}return!0}bn(){if(this.gn)return null;let e=new he(Ce.comparator),t=[];for(let r of this.fn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Oi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Oi(r.field,0))}for(let r of this.mn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Oi(r.field,r.dir==="asc"?0:1)));return new Bi(Bi.UNKNOWN_ID,this.collectionId,t,Vo.empty())}yn(e){for(let t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function TE(n){var e,t;if(j(n instanceof ne||n instanceof ce,20012),n instanceof ne){if(n instanceof tc){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>ne.create(n.field,"==",s)))||[];return ce.create(i,"or")}return n}let r=n.filters.map(i=>TE(i));return ce.create(r,n.op)}function Yb(n){if(n.getFilters().length===0)return[];let e=Xd(TE(n));return j(IE(e),7391),Hd(e)||Yd(e)?[e]:e.getFilters()}function Hd(n){return n instanceof ne}function Yd(n){return n instanceof ce&&Ip(n)}function IE(n){return Hd(n)||Yd(n)||(function(t){if(t instanceof ce&&Id(t)){for(let r of t.getFilters())if(!Hd(r)&&!Yd(r))return!1;return!0}return!1})(n)}function Xd(n){if(j(n instanceof ne||n instanceof ce,34018),n instanceof ne)return n;if(n.filters.length===1)return Xd(n.filters[0]);let e=n.filters.map(r=>Xd(r)),t=ce.create(e,n.op);return t=dc(t),IE(t)?t:(j(t instanceof ce,64498),j($i(t),40251),j(t.filters.length>1,57927),t.filters.reduce((r,i)=>Pp(r,i)))}function Pp(n,e){let t;return j(n instanceof ne||n instanceof ce,38388),j(e instanceof ne||e instanceof ce,25473),t=n instanceof ne?e instanceof ne?(function(i,s){return ce.create([i,s],"and")})(n,e):Ov(n,e):e instanceof ne?Ov(e,n):(function(i,s){if(j(i.filters.length>0&&s.filters.length>0,48005),$i(i)&&$i(s))return Gw(i,s.getFilters());let o=Id(i)?i:s,a=Id(i)?s:i,c=o.filters.map(u=>Pp(u,a));return ce.create(c,"or")})(n,e),dc(t)}function Ov(n,e){if($i(e))return Gw(e,n.getFilters());{let t=e.filters.map(r=>Pp(n,r));return ce.create(t,"or")}}function dc(n){if(j(n instanceof ne||n instanceof ce,11850),n instanceof ne)return n;let e=n.getFilters();if(e.length===1)return dc(e[0]);if(qw(n))return n;let t=e.map(i=>dc(i)),r=[];return t.forEach(i=>{i instanceof ne?r.push(i):i instanceof ce&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ce.create(r,n.op)}var Jd=class{constructor(){this.Dn=new Yo}addToCollectionParentIndex(e,t){return this.Dn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(Rt.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(Rt.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}},Yo=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new he(re.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new he(re.comparator)).toArray()}};var Fv="IndexedDbIndexManager",xl=new Uint8Array(0),Zd=class{constructor(e,t){this.databaseId=t,this.vn=new Yo,this.Cn=new Mt(r=>Gr(r),(r,i)=>aa(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let s={collectionId:r,parent:et(i)};return Mv(e).put(s)}return C.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[fw(t),""],!1,!0);return Mv(e).j(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Kt(o.parent))}return r})}addFieldIndex(e,t){let r=wo(e),i=(function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}})(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Ci(e);return s.next(a=>{o.put(Pv(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=wo(e),i=Ci(e),s=bi(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=wo(e),r=bi(e),i=Ci(e);return t.Y().next(()=>r.Y()).next(()=>i.Y())}createTargetIndexes(e,t){return C.forEach(this.Fn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new hc(r).bn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=bi(e),i=!0,s=new Map;return C.forEach(this.Fn(t),o=>this.Mn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=X(),a=[];return C.forEach(s,(c,u)=>{D(Fv,`Using index ${(function(O){return`id=${O.indexId}|cg=${O.collectionGroup}|f=${O.fields.map(z=>`${z.fieldPath}:${z.kind}`).join(",")}`})(c)} to execute ${Gr(t)}`);let d=(function(O,z){let Q=hd(z);if(Q===void 0)return null;for(let H of rc(O,Q.fieldPath))switch(H.op){case"array-contains-any":return H.value.arrayValue.values||[];case"array-contains":return[H.value]}return null})(u,c),p=(function(O,z){let Q=new Map;for(let H of kr(z))for(let E of rc(O,H.fieldPath))switch(E.op){case"==":case"in":Q.set(H.fieldPath.canonicalString(),E.value);break;case"not-in":case"!=":return Q.set(H.fieldPath.canonicalString(),E.value),Array.from(Q.values())}return null})(u,c),g=(function(O,z){let Q=[],H=!0;for(let E of kr(z)){let _=E.kind===0?gv(O,E.fieldPath,O.startAt):mv(O,E.fieldPath,O.startAt);Q.push(_.value),H&&(H=_.inclusive)}return new Zt(Q,H)})(u,c),y=(function(O,z){let Q=[],H=!0;for(let E of kr(z)){let _=E.kind===0?mv(O,E.fieldPath,O.endAt):gv(O,E.fieldPath,O.endAt);Q.push(_.value),H&&(H=_.inclusive)}return new Zt(Q,H)})(u,c),S=this.xn(c,u,g),N=this.xn(c,u,y),k=this.On(c,u,p),q=this.Nn(c.indexId,d,S,g.inclusive,N,y.inclusive,k);return C.forEach(q,B=>r.H(B,t.limit).next(O=>{O.forEach(z=>{let Q=M.fromSegments(z.documentKey);o.has(Q)||(o=o.add(Q),a.push(Q))})}))}).next(()=>a)}return C.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(e.filters.length===0?t=[e]:t=Yb(ce.create(e.filters,"and")).map(r=>xd(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t),t)}Nn(e,t,r,i,s,o,a){let c=(t!=null?t.length:1)*Math.max(r.length,s.length),u=c/(t!=null?t.length:1),d=[];for(let p=0;p<c;++p){let g=t?this.Bn(t[p/u]):xl,y=this.Ln(e,g,r[p%u],i),S=this.kn(e,g,s[p%u],o),N=a.map(k=>this.Ln(e,g,k,!0));d.push(...this.createRange(y,S,N))}return d}Ln(e,t,r,i){let s=new Fr(e,M.empty(),t,r);return i?s:s.En()}kn(e,t,r,i){let s=new Fr(e,M.empty(),t,r);return i?s.En():s}Mn(e,t){let r=new hc(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.pn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.Fn(t);return C.forEach(i,s=>this.Mn(e,s).next(o=>{o?r!==0&&o.fields.length<(function(c){let u=new he(Ce.comparator),d=!1;for(let p of c.filters)for(let g of p.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?d=!0:u=u.add(g.field));for(let p of c.orderBy)p.field.isKeyField()||(u=u.add(p.field));return u.size+(d?1:0)})(s)&&(r=1):r=0})).next(()=>(function(o){return o.limit!==null})(t)&&i.length>1&&r===2?1:r)}qn(e,t){let r=new Or;for(let i of kr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.hn(i.kind);pn.Ut.bt(s,o)}return r.an()}Bn(e){let t=new Or;return pn.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){let r=new Or;return pn.Ut.bt(qr(this.databaseId,t),r.hn((function(s){let o=kr(s);return o.length===0?0:o[o.length-1].kind})(e))),r.an()}On(e,t,r){if(r===null)return[];let i=[];i.push(new Or);let s=0;for(let o of kr(e)){let a=r[s++];for(let c of i)if(this.$n(t,o.fieldPath)&&jo(a))i=this.Un(i,o,a);else{let u=c.hn(o.kind);pn.Ut.bt(a,u)}}return this.Kn(i)}xn(e,t,r){return this.On(e,t,r.position)}Kn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].an();return t}Un(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let c=new Or;c.seed(a.an()),pn.Ut.bt(o,c.hn(t.kind)),s.push(c)}return s}$n(e,t){return!!e.filters.find(r=>r instanceof ne&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=wo(e),i=Ci(e);return(t?r.j(_d,IDBKeyRange.bound(t,t)):r.j()).next(s=>{let o=[];return C.forEach(s,a=>i.get([a.indexId,this.uid]).next(c=>{o.push((function(d,p){let g=p?new Vo(p.sequenceNumber,new Rt(Kr(p.readTime),new M(Kt(p.documentKey)),p.largestBatchId)):Vo.empty(),y=d.fields.map(([S,N])=>new Oi(Ce.fromServerFormat(S),N));return new Bi(d.indexId,d.collectionGroup,y,g)})(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:$(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=wo(e),s=Ci(e);return this.Wn(e).next(o=>i.j(_d,IDBKeyRange.bound(t,t)).next(a=>C.forEach(a,c=>s.put(Pv(c.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return C.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?C.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),C.forEach(a,c=>this.Gn(e,i,c).next(u=>{let d=this.zn(s,c);return u.isEqual(d)?C.resolve():this.jn(e,s,c,u,d)}))))})}Jn(e,t,r,i){return bi(e).put(i.An(this.uid,this.Qn(r,t.key),t.key))}Hn(e,t,r,i){return bi(e).delete(i.Rn(this.uid,this.Qn(r,t.key),t.key))}Gn(e,t,r){let i=bi(e),s=new he(jn);return i.X({index:Sw,range:IDBKeyRange.only([r.indexId,this.uid,jl(this.Qn(r,t))])},(o,a)=>{s=s.add(new Fr(r.indexId,t,Vv(a.arrayValue),Vv(a.directionalValue)))}).next(()=>s)}zn(e,t){let r=new he(jn),i=this.qn(t,e);if(i==null)return r;let s=hd(t);if(s!=null){let o=e.data.field(s.fieldPath);if(jo(o))for(let a of o.arrayValue.values||[])r=r.add(new Fr(t.indexId,e.key,this.Bn(a),i))}else r=r.add(new Fr(t.indexId,e.key,xl,i));return r}jn(e,t,r,i,s){D(Fv,"Updating index entries for document '%s'",t.key);let o=[];return(function(c,u,d,p,g){let y=c.getIterator(),S=u.getIterator(),N=Ai(y),k=Ai(S);for(;N||k;){let q=!1,B=!1;if(N&&k){let O=d(N,k);O<0?B=!0:O>0&&(q=!0)}else N!=null?B=!0:q=!0;q?(p(k),k=Ai(S)):B?(g(N),N=Ai(y)):(N=Ai(y),k=Ai(S))}})(i,s,jn,a=>{o.push(this.Jn(e,t,r,a))},a=>{o.push(this.Hn(e,t,r,a))}),C.waitFor(o)}Wn(e){let t=1;return Ci(e).X({index:Aw,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>jn(o,a)).filter((o,a,c)=>!a||jn(o,c[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=jn(o,e),c=jn(o,t);if(a===0)i[0]=e.En();else if(a>0&&c<0)i.push(o),i.push(o.En());else if(c>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Yn(i[o],i[o+1]))return[];let a=i[o].Rn(this.uid,xl,M.empty()),c=i[o+1].Rn(this.uid,xl,M.empty());s.push(IDBKeyRange.bound(a,c))}return s}Yn(e,t){return jn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Lv)}getMinOffset(e,t){return C.mapArray(this.Fn(t),r=>this.Mn(e,r).next(i=>i||U(44426))).next(Lv)}};function Mv(n){return Ue(n,Lo)}function bi(n){return Ue(n,Co)}function wo(n){return Ue(n,yp)}function Ci(n){return Ue(n,bo)}function Lv(n){j(n.length!==0,28825);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;gp(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Rt(e.readTime,e.documentKey,t)}var Uv={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},AE=41943040,dt=class n{static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}};function SE(n,e,t){let r=n.store(Ot),i=n.store(qi),s=[],o=IDBKeyRange.only(t.batchId),a=0,c=r.X({range:o},(d,p,g)=>(a++,g.delete()));s.push(c.next(()=>{j(a===1,47070,{batchId:t.batchId})}));let u=[];for(let d of t.mutations){let p=Ew(e,d.key.path,t.batchId);s.push(i.delete(p)),u.push(d.key)}return C.waitFor(s).next(()=>u)}function fc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw U(14731);e=n.noDocument}return JSON.stringify(e).length}dt.DEFAULT_COLLECTION_PERCENTILE=10,dt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,dt.DEFAULT=new dt(AE,dt.DEFAULT_COLLECTION_PERCENTILE,dt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),dt.DISABLED=new dt(-1,0,0);var pc=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Zn={}}static yt(e,t,r,i){j(e.uid!=="",64387);let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Gn(e).X({index:Mr,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Di(e),o=Gn(e);return o.add({}).next(a=>{j(typeof a=="number",49019);let c=new zo(a,t,r,i),u=(function(y,S,N){let k=N.baseMutations.map(B=>Ho(y.gt,B)),q=N.mutations.map(B=>Ho(y.gt,B));return{userId:S,batchId:N.batchId,localWriteTimeMs:N.localWriteTime.toMillis(),baseMutations:k,mutations:q}})(this.serializer,this.userId,c),d=[],p=new he((g,y)=>$(g.canonicalString(),y.canonicalString()));for(let g of i){let y=Ew(this.userId,g.key.path,a);p=p.add(g.key.path.popLast()),d.push(o.put(u)),d.push(s.put(y,YS))}return p.forEach(g=>{d.push(this.indexManager.addToCollectionParentIndex(e,g))}),e.addOnCommittedListener(()=>{this.Zn[a]=c.keys()}),C.waitFor(d).next(()=>c)})}lookupMutationBatch(e,t){return Gn(e).get(t).next(r=>r?(j(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:t}),Vr(this.serializer,r)):null)}Xn(e,t){return this.Zn[t]?C.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Zn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Gn(e).X({index:Mr,range:i},(o,a,c)=>{a.userId===this.userId&&(j(a.batchId>=r,47524,{er:r}),s=Vr(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Qn;return Gn(e).X({index:Mr,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Qn],[this.userId,Number.POSITIVE_INFINITY]);return Gn(e).j(Mr,t).next(r=>r.map(i=>Vr(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Fl(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Di(e).X({range:i},(o,a,c)=>{let[u,d,p]=o,g=Kt(d);if(u===this.userId&&t.path.isEqual(g))return Gn(e).get(p).next(y=>{if(!y)throw U(61480,{tr:o,batchId:p});j(y.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:y.userId,batchId:p}),s.push(Vr(this.serializer,y))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new he($),i=[];return t.forEach(s=>{let o=Fl(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=Di(e).X({range:a},(u,d,p)=>{let[g,y,S]=u,N=Kt(y);g===this.userId&&s.path.isEqual(N)?r=r.add(S):p.done()});i.push(c)}),C.waitFor(i).next(()=>this.nr(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Fl(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new he($);return Di(e).X({range:o},(c,u,d)=>{let[p,g,y]=c,S=Kt(g);p===this.userId&&r.isPrefixOf(S)?S.length===i&&(a=a.add(y)):d.done()}).next(()=>this.nr(e,a))}nr(e,t){let r=[],i=[];return t.forEach(s=>{i.push(Gn(e).get(s).next(o=>{if(o===null)throw U(35274,{batchId:s});j(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),r.push(Vr(this.serializer,o))}))}),C.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return SE(e.ce,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.rr(t.batchId)}),C.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return C.resolve();let r=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),i=[];return Di(e).X({range:r},(s,o,a)=>{if(s[0]===this.userId){let c=Kt(s[1]);i.push(c)}else a.done()}).next(()=>{j(i.length===0,56720,{ir:i.map(s=>s.canonicalString())})})})}containsKey(e,t){return bE(e,this.userId,t)}sr(e){return CE(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Qn,lastStreamToken:""})}};function bE(n,e,t){let r=Fl(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Di(n).X({range:s,Z:!0},(a,c,u)=>{let[d,p,g]=a;d===e&&p===i&&(o=!0),u.done()}).next(()=>o)}function Gn(n){return Ue(n,Ot)}function Di(n){return Ue(n,qi)}function CE(n){return Ue(n,Fo)}var Ji=class n{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var ef=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=>{let r=new Ji(t.highestTargetId);return t.highestTargetId=r.next(),this.lr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(t=>G.fromTimestamp(new pe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.cr(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.lr(e,i)))}addTargetData(e,t){return this.hr(e,t).next(()=>this.cr(e).next(r=>(r.targetCount+=1,this.Pr(t,r),this.lr(e,r))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ri(e).delete(t.targetId)).next(()=>this.cr(e)).next(r=>(j(r.targetCount>0,8065),r.targetCount-=1,this.lr(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Ri(e).X((o,a)=>{let c=Ao(a);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>C.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Ri(e).X((r,i)=>{let s=Ao(i);t(s)})}cr(e){return Bv(e).get(Xl).next(t=>(j(t!==null,2888),t))}lr(e,t){return Bv(e).put(Xl,t)}hr(e,t){return Ri(e).put(EE(this.serializer,t))}Pr(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.cr(e).next(t=>t.targetCount)}getTargetData(e,t){let r=Gr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Ri(e).X({range:i,index:Iw},(o,a,c)=>{let u=Ao(a);aa(t,u.target)&&(s=u,c.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Wn(e);return t.forEach(o=>{let a=et(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),C.waitFor(i)}removeMatchingKeys(e,t,r){let i=Wn(e);return C.forEach(t,s=>{let o=et(s.path);return C.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Wn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Wn(e),s=X();return i.X({range:r,Z:!0},(o,a,c)=>{let u=Kt(o[1]),d=new M(u);s=s.add(d)}).next(()=>s)}containsKey(e,t){let r=et(t.path),i=IDBKeyRange.bound([r],[fw(r)],!1,!0),s=0;return Wn(e).X({index:_p,Z:!0,range:i},([o,a],c,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}Et(e,t){return Ri(e).get(t).next(r=>r?Ao(r):null)}};function Ri(n){return Ue(n,ji)}function Bv(n){return Ue(n,Br)}function Wn(n){return Ue(n,Gi)}var qv="LruGarbageCollector",Xb=1048576;function jv([n,e],[t,r]){let i=$(n,t);return i===0?$(e,r):i}var tf=class{constructor(e){this.Tr=e,this.buffer=new he(jv),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();jv(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},gc=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){D(qv,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){cr(t)?D(qv,"Ignoring IndexedDB error during garbage collection: ",t):await lr(t)}await this.Rr(3e5)})}},nf=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return C.resolve(vt.ue);let r=new tf(t);return this.Vr.forEachTarget(e,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.Vr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(Uv)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Uv):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let r,i,s,o,a,c,u,d=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,o=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(r=p,a=Date.now(),this.removeTargets(e,r,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(p=>(u=Date.now(),Pi()<=Ct.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-d}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${p} documents in `+(u-c)+`ms
Total Duration: ${u-d}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}};function RE(n,e){return new nf(n,e)}var rf=class{constructor(e,t){this.db=e,this.garbageCollector=RE(this,t)}mr(e){let t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(r,i)=>t(i))}addReference(e,t,r){return Dl(e,r)}removeReference(e,t,r){return Dl(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Dl(e,t)}Sr(e,t){return(function(i,s){let o=!1;return CE(i).ee(a=>bE(i,a,s).next(c=>(c&&(o=!0),C.resolve(!c)))).next(()=>o)})(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.wr(e,(o,a)=>{if(a<=t){let c=this.Sr(e,o).next(u=>{if(!u)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,G.min()),Wn(e).delete((function(p){return[0,et(p.path)]})(o))))});i.push(c)}}).next(()=>C.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Dl(e,t)}wr(e,t){let r=Wn(e),i,s=vt.ue;return r.X({index:_p},([o,a],{path:c,sequenceNumber:u})=>{o===0?(s!==vt.ue&&t(new M(Kt(i)),s),s=u,i=c):s=vt.ue}).next(()=>{s!==vt.ue&&t(new M(Kt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Dl(n,e){return Wn(n).put((function(r,i){return{targetId:0,path:et(r.path),sequenceNumber:i}})(e,n.currentSequenceNumber))}var mc=class{constructor(){this.changes=new Mt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Oe.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var sf=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Nr(e).put(r)}removeEntry(e,t,r){return Nr(e).delete((function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],cc(o),a[a.length-1]]})(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.br(e,r)))}getEntry(e,t){let r=Oe.newInvalidDocument(t);return Nr(e).X({index:Ml,range:IDBKeyRange.only(Eo(t))},(i,s)=>{r=this.Dr(t,s)}).next(()=>r)}vr(e,t){let r={size:0,document:Oe.newInvalidDocument(t)};return Nr(e).X({index:Ml,range:IDBKeyRange.only(Eo(t))},(i,s)=>{r={document:this.Dr(t,s),size:fc(s)}}).next(()=>r)}getEntries(e,t){let r=ft();return this.Cr(e,t,(i,s)=>{let o=this.Dr(i,s);r=r.insert(i,o)}).next(()=>r)}Fr(e,t){let r=ft(),i=new _e(M.comparator);return this.Cr(e,t,(s,o)=>{let a=this.Dr(s,o);r=r.insert(s,a),i=i.insert(s,fc(o))}).next(()=>({documents:r,Mr:i}))}Cr(e,t,r){if(t.isEmpty())return C.resolve();let i=new he(Wv);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(Eo(i.first()),Eo(i.last())),o=i.getIterator(),a=o.getNext();return Nr(e).X({index:Ml,range:s},(c,u,d)=>{let p=M.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&Wv(a,p)<0;)r(a,null),a=o.getNext();a&&a.isEqual(p)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?d.G(Eo(a)):d.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),cc(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Nr(e).j(IDBKeyRange.bound(a,c,!0)).next(u=>{s?.incrementDocumentReadCount(u.length);let d=ft();for(let p of u){let g=this.Dr(M.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);g.isFoundDocument()&&(ca(t,g)||i.has(g.key))&&(d=d.insert(g.key,g))}return d})}getAllFromCollectionGroup(e,t,r,i){let s=ft(),o=zv(t,r),a=zv(t,Rt.max());return Nr(e).X({index:Tw,range:IDBKeyRange.bound(o,a,!0)},(c,u,d)=>{let p=this.Dr(M.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(p.key,p),s.size===i&&d.done()}).next(()=>s)}newChangeBuffer(e){return new of(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Gv(e).get(md).next(t=>(j(!!t,20021),t))}br(e,t){return Gv(e).put(md,t)}Dr(e,t){if(t){let r=Qb(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(G.min())))return r}return Oe.newInvalidDocument(e)}};function PE(n){return new sf(n)}var of=class extends mc{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new Mt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new he((s,o)=>$(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.Nr.get(s);if(t.push(this.Or.removeEntry(e,s,a.readTime)),o.isValidDocument()){let c=Cv(this.Or.serializer,o);i=i.add(s.path.popLast());let u=fc(c);r+=u-a.size,t.push(this.Or.addEntry(e,s,c))}else if(r-=a.size,this.trackRemovals){let c=Cv(this.Or.serializer,o.convertToNoDocument(G.min()));t.push(this.Or.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Or.updateMetadata(e,r)),C.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(r=>(this.Nr.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:r,Mr:i})=>(i.forEach((s,o)=>{this.Nr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function Gv(n){return Ue(n,Mo)}function Nr(n){return Ue(n,Yl)}function Eo(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function zv(n,e){let t=e.documentKey.path.toArray();return[n,cc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Wv(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=$(t[s],r[s]),i)return i;return i=$(t.length,r.length),i||(i=$(t[t.length-2],r[r.length-2]),i||$(t[t.length-1],r[r.length-1]))}var af=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var _c=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&No(r.mutation,i,wt.empty(),pe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,X()).next(()=>r))}getLocalViewOfDocuments(e,t,r=X()){let i=$t();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Io();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=$t();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,X()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=ft(),o=Po(),a=(function(){return Po()})();return t.forEach((c,u)=>{let d=r.get(u.key);i.has(u.key)&&(d===void 0||d.mutation instanceof Lt)?s=s.insert(u.key,u):d!==void 0?(o.set(u.key,d.mutation.getFieldMask()),No(d.mutation,u,d.mutation.getFieldMask(),pe.now())):o.set(u.key,wt.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,d)=>o.set(u,d)),t.forEach((u,d)=>{var p;return a.set(u,new af(d,(p=o.get(u))!==null&&p!==void 0?p:null))}),a))}recalculateAndSaveOverlays(e,t){let r=Po(),i=new _e((o,a)=>o-a),s=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(c=>{let u=t.get(c);if(u===null)return;let d=r.get(c)||wt.empty();d=a.applyToLocalView(u,d),r.set(c,d);let p=(i.get(a.batchId)||X()).add(c);i=i.insert(a.batchId,p)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let c=a.getNext(),u=c.key,d=c.value,p=Jw();d.forEach(g=>{if(!s.has(g)){let y=sE(t.get(g),r.get(g));y!==null&&p.set(g,y),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,p))}return C.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return(function(o){return M.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ap(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):C.resolve($t()),a=Ui,c=s;return o.next(u=>C.forEach(u,(d,p)=>(a<p.largestBatchId&&(a=p.largestBatchId),s.get(d)?C.resolve():this.remoteDocumentCache.getEntry(e,d).next(g=>{c=c.insert(d,g)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,X())).next(d=>({batchId:a,changes:Xw(d)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next(r=>{let i=Io();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Io();return this.indexManager.getCollectionParents(e,s).next(a=>C.forEach(a,c=>{let u=(function(p,g){return new Ft(g,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt)})(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(d=>{d.forEach((p,g)=>{o=o.insert(p,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((c,u)=>{let d=u.getKey();o.get(d)===null&&(o=o.insert(d,Oe.newInvalidDocument(d)))});let a=Io();return o.forEach((c,u)=>{let d=s.get(c);d!==void 0&&No(d.mutation,u,wt.empty(),pe.now()),ca(t,u)&&(a=a.insert(c,u))}),a})}};var lf=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return C.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,(function(i){return{id:i.id,version:i.version,createTime:Re(i.createTime)}})(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,(function(i){return{name:i.name,query:Rp(i.bundledQuery),readTime:Re(i.readTime)}})(t)),C.resolve()}};var cf=class{constructor(){this.overlays=new _e(M.comparator),this.kr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){let r=$t();return C.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.wt(e,t,s)}),C.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){let i=$t(),s=t.length+1,o=new M(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return C.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new _e((u,d)=>u-d),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let d=s.get(u.largestBatchId);d===null&&(d=$t(),s=s.insert(u.largestBatchId,d)),d.set(u.getKey(),u)}}let a=$t(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,d)=>a.set(u,d)),!(a.size()>=i)););return C.resolve(a)}wt(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Wo(t,r));let s=this.kr.get(t);s===void 0&&(s=X(),this.kr.set(t,s)),this.kr.set(t,s.add(r.key))}};var uf=class{constructor(){this.sessionToken=Pe.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}};var Xo=class{constructor(){this.qr=new he(xe.Qr),this.$r=new he(xe.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let r=new xe(e,t);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Wr(new xe(e,t))}Gr(e,t){e.forEach(r=>this.removeReference(r,t))}zr(e){let t=new M(new re([])),r=new xe(t,e),i=new xe(t,e+1),s=[];return this.$r.forEachInRange([r,i],o=>{this.Wr(o),s.push(o.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new M(new re([])),r=new xe(t,e),i=new xe(t,e+1),s=X();return this.$r.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new xe(e,0),r=this.qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},xe=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return M.comparator(e.key,t.key)||$(e.Hr,t.Hr)}static Ur(e,t){return $(e.Hr,t.Hr)||M.comparator(e.key,t.key)}};var hf=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new he(xe.Qr)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new zo(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.Yr=this.Yr.add(new xe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return C.resolve(o)}lookupMutationBatch(e,t){return C.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.Xr(r),s=i<0?0:i;return C.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?Qn:this.er-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new xe(t,0),i=new xe(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],o=>{let a=this.Zr(o.Hr);s.push(a)}),C.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new he($);return t.forEach(i=>{let s=new xe(i,0),o=new xe(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,o],a=>{r=r.add(a.Hr)})}),C.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;M.isDocumentKey(s)||(s=s.child(""));let o=new xe(new M(s),0),a=new he($);return this.Yr.forEachWhile(c=>{let u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(c.Hr)),!0)},o),C.resolve(this.ei(a))}ei(e){let t=[];return e.forEach(r=>{let i=this.Zr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){j(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return C.forEach(t.mutations,i=>{let s=new xe(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=r})}rr(e){}containsKey(e,t){let r=new xe(t,0),i=this.Yr.firstAfterOrEqual(r);return C.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var df=class{constructor(e){this.ni=e,this.docs=(function(){return new _e(M.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.ni(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():Oe.newInvalidDocument(t))}getEntries(e,t){let r=ft();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Oe.newInvalidDocument(i))}),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=ft(),o=t.path,a=new M(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){let{key:u,value:{document:d}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||gp(_w(d),r)<=0||(i.has(d.key)||ca(t,d))&&(s=s.insert(d.key,d.mutableCopy()))}return C.resolve(s)}getAllFromCollectionGroup(e,t,r,i){U(9500)}ri(e,t){return C.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ff(this)}getSize(e){return C.resolve(this.size)}},ff=class extends mc{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(r)}),C.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var pf=class{constructor(e){this.persistence=e,this.ii=new Mt(t=>Gr(t),aa),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.si=0,this.oi=new Xo,this.targetCount=0,this._i=Ji.ar()}forEachTarget(e,t){return this.ii.forEach((r,i)=>t(i)),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.si&&(this.si=t),C.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new Ji(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.hr(t),C.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.ii.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.ii.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),C.waitFor(s).next(()=>i)}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){let r=this.ii.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this.oi.Kr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this.oi.Gr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),C.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),C.resolve()}getMatchingKeysForTargetId(e,t){let r=this.oi.Jr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this.oi.containsKey(t))}};var Jo=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new vt(0),this.ci=!1,this.ci=!0,this.li=new uf,this.referenceDelegate=e(this),this.hi=new pf(this),this.indexManager=new Jd,this.remoteDocumentCache=(function(i){return new df(i)})(r=>this.referenceDelegate.Pi(r)),this.serializer=new lc(t),this.Ti=new lf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new cf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ai[e.toKey()];return r||(r=new hf(t,this.referenceDelegate),this.ai[e.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,r){D("MemoryPersistence","Starting transaction:",e);let i=new gf(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return C.or(Object.values(this.ai).map(r=>()=>r.containsKey(e,t)))}},gf=class extends $l{constructor(e){super(),this.currentSequenceNumber=e}},yc=class n{constructor(e){this.persistence=e,this.Ai=new Xo,this.Ri=null}static Vi(e){return new n(e)}get mi(){if(this.Ri)return this.Ri;throw U(60996)}addReference(e,t,r){return this.Ai.addReference(r,t),this.mi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ai.removeReference(r,t),this.mi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.mi,r=>{let i=M.fromPath(r);return this.fi(e,i).next(s=>{s||t.removeEntry(i,G.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(r=>{r?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return C.or([()=>C.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},vc=class n{constructor(e,t){this.persistence=e,this.gi=new Mt(r=>et(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=RE(this,t)}static Vi(e,t){return new n(e,t)}Ii(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}yr(e){let t=0;return this.gr(e,r=>{t++}).next(()=>t)}gr(e,t){return C.forEach(this.gi,(r,i)=>this.Sr(e,r,i).next(s=>s?C.resolve():t(i)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,o=>this.Sr(e,o,t).next(a=>{a||(r++,s.removeEntry(o,G.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.gi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),C.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ul(e.data.value)),t}Sr(e,t,r){return C.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return C.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var mf=class{constructor(e){this.serializer=e}q(e,t,r,i){let s=new Ql("createOrUpgrade",t);r<1&&i>=1&&((function(c){c.createObjectStore(oa)})(e),(function(c){c.createObjectStore(Fo,{keyPath:HS}),c.createObjectStore(Ot,{keyPath:iv,autoIncrement:!0}).createIndex(Mr,sv,{unique:!0}),c.createObjectStore(qi)})(e),Kv(e),(function(c){c.createObjectStore(xr)})(e));let o=C.resolve();return r<3&&i>=3&&(r!==0&&((function(c){c.deleteObjectStore(Gi),c.deleteObjectStore(ji),c.deleteObjectStore(Br)})(e),Kv(e)),o=o.next(()=>(function(c){let u=c.store(Br),d={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:G.min().toTimestamp(),targetCount:0};return u.put(Xl,d)})(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>(function(c,u){return u.store(Ot).j().next(p=>{c.deleteObjectStore(Ot),c.createObjectStore(Ot,{keyPath:iv,autoIncrement:!0}).createIndex(Mr,sv,{unique:!0});let g=u.store(Ot),y=p.map(S=>g.put(S));return C.waitFor(y)})})(e,s))),o=o.next(()=>{(function(c){c.createObjectStore(zi,{keyPath:ib})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.pi(s))),r<6&&i>=6&&(o=o.next(()=>((function(c){c.createObjectStore(Mo)})(e),this.yi(s)))),r<7&&i>=7&&(o=o.next(()=>this.wi(s))),r<8&&i>=8&&(o=o.next(()=>this.Si(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.bi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(Kc,{keyPath:sb})})(e),(function(c){c.createObjectStore($c,{keyPath:ob})})(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(c){let u=c.createObjectStore(Qc,{keyPath:fb});u.createIndex(yd,pb,{unique:!1}),u.createIndex(bw,gb,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>(function(c){let u=c.createObjectStore(Yl,{keyPath:XS});u.createIndex(Ml,JS),u.createIndex(Tw,ZS)})(e)).next(()=>this.Di(e,s)).next(()=>e.deleteObjectStore(xr))),r<14&&i>=14&&(o=o.next(()=>this.Ci(e,s))),r<15&&i>=15&&(o=o.next(()=>(function(c){c.createObjectStore(yp,{keyPath:ab,autoIncrement:!0}).createIndex(_d,lb,{unique:!1}),c.createObjectStore(bo,{keyPath:cb}).createIndex(Aw,ub,{unique:!1}),c.createObjectStore(Co,{keyPath:hb}).createIndex(Sw,db,{unique:!1})})(e))),r<16&&i>=16&&(o=o.next(()=>{t.objectStore(bo).clear()}).next(()=>{t.objectStore(Co).clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(c){c.createObjectStore(vp,{keyPath:mb})})(e)})),r<18&&i>=18&&Dh()&&(o=o.next(()=>{t.objectStore(bo).clear()}).next(()=>{t.objectStore(Co).clear()})),o}yi(e){let t=0;return e.store(xr).X((r,i)=>{t+=fc(i)}).next(()=>{let r={byteSize:t};return e.store(Mo).put(md,r)})}pi(e){let t=e.store(Fo),r=e.store(Ot);return t.j().next(i=>C.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,Qn],[s.userId,s.lastAcknowledgedBatchId]);return r.j(Mr,o).next(a=>C.forEach(a,c=>{j(c.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});let u=Vr(this.serializer,c);return SE(e,s.userId,u).next(()=>{})}))}))}wi(e){let t=e.store(Gi),r=e.store(xr);return e.store(Br).get(Xl).next(i=>{let s=[];return r.X((o,a)=>{let c=new re(o),u=(function(p){return[0,et(p)]})(c);s.push(t.get(u).next(d=>d?C.resolve():(p=>t.put({targetId:0,path:et(p),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>C.waitFor(s))})}Si(e,t){e.createObjectStore(Lo,{keyPath:rb});let r=t.store(Lo),i=new Yo,s=o=>{if(i.add(o)){let a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:et(c)})}};return t.store(xr).X({Z:!0},(o,a)=>{let c=new re(o);return s(c.popLast())}).next(()=>t.store(qi).X({Z:!0},([o,a,c],u)=>{let d=Kt(a);return s(d.popLast())}))}bi(e){let t=e.store(ji);return t.X((r,i)=>{let s=Ao(i),o=EE(this.serializer,s);return t.put(o)})}Di(e,t){let r=t.store(xr),i=[];return r.X((s,o)=>{let a=t.store(Yl),c=(function(p){return p.document?new M(re.fromString(p.document.name).popFirst(5)):p.noDocument?M.fromSegments(p.noDocument.path):p.unknownDocument?M.fromSegments(p.unknownDocument.path):U(36783)})(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(u))}).next(()=>C.waitFor(i))}Ci(e,t){let r=t.store(Ot),i=PE(this.serializer),s=new Jo(yc.Vi,this.serializer.gt);return r.j().next(o=>{let a=new Map;return o.forEach(c=>{var u;let d=(u=a.get(c.userId))!==null&&u!==void 0?u:X();Vr(this.serializer,c).keys().forEach(p=>d=d.add(p)),a.set(c.userId,d)}),C.forEach(a,(c,u)=>{let d=new De(u),p=uc.yt(this.serializer,d),g=s.getIndexManager(d),y=pc.yt(d,this.serializer,g,s.referenceDelegate);return new _c(i,y,p,g).recalculateAndSaveOverlaysForDocumentKeys(new Uo(t,vt.ue),c).next()})})}};function Kv(n){n.createObjectStore(Gi,{keyPath:tb}).createIndex(_p,nb,{unique:!0}),n.createObjectStore(ji,{keyPath:"targetId"}).createIndex(Iw,eb,{unique:!0}),n.createObjectStore(Br)}var zn="IndexedDbPersistence",Jh=18e5,Zh=5e3,ed="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",NE="main",_f=class n{constructor(e,t,r,i,s,o,a,c,u,d,p=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Fi=s,this.window=o,this.document=a,this.Mi=u,this.xi=d,this.Oi=p,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=g=>Promise.resolve(),!n.C())throw new x(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new rf(this,i),this.Qi=t+NE,this.serializer=new lc(c),this.$i=new Jn(this.Qi,this.Oi,new mf(this.serializer)),this.li=new Wd,this.hi=new ef(this.referenceDelegate,this.serializer),this.remoteDocumentCache=PE(this.serializer),this.Ti=new zd,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,d===!1&&be(zn,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new x(R.FAILED_PRECONDITION,ed);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.hi.getHighestSequenceNumber(e))}).then(e=>{this.ui=new vt(e,this.Mi)}).then(()=>{this.ci=!0}).catch(e=>(this.$i&&this.$i.close(),Promise.reject(e)))}ji(e){return this.qi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget(async()=>{this.started&&await this.Ki()}))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Vl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(e).next(t=>{t||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Yi(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(cr(e))return D(zn,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return D(zn,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable(()=>this.qi(e)),this.isPrimary=e})}Ji(e){return To(e).get(Ii).next(t=>C.resolve(this.Xi(t)))}es(e){return Vl(e).delete(this.clientId)}async ts(){if(this.isPrimary&&!this.ns(this.ki,Jh)){this.ki=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=Ue(t,zi);return r.j().next(i=>{let s=this.rs(i,Jh),o=i.filter(a=>s.indexOf(a)===-1);return C.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.ss(t.clientId))}}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?C.resolve(!0):To(e).get(Ii).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,Zh)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new x(R.FAILED_PRECONDITION,ed);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vl(e).j().next(r=>this.rs(r,Zh).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&D(zn,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),await this.$i.runTransaction("shutdown","readwrite",[oa,zi],e=>{let t=new Uo(e,vt.ue);return this.Yi(t).next(()=>this.es(t))}),this.$i.close(),this.hs()}rs(e,t){return e.filter(r=>this.ns(r.updateTimeMs,t)&&!this._s(r.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=>Vl(e).j().next(t=>this.rs(t,Jh).map(r=>r.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return pc.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Zd(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return uc.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,r){D(zn,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=(function(c){return c===18?vb:c===17?Nw:c===16?yb:c===15?wp:c===14?Pw:c===13?Rw:c===12?_b:c===11?Cw:void U(60245)})(this.Oi),o;return this.$i.runTransaction(e,i,s,a=>(o=new Uo(a,this.ui?this.ui.next():vt.ue),t==="readwrite-primary"?this.Ji(o).next(c=>!!c||this.Hi(o)).next(c=>{if(!c)throw be(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new x(R.FAILED_PRECONDITION,yw);return r(o)}).next(c=>this.Zi(o).next(()=>c)):this.Ts(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Ts(e){return To(e).get(Ii).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,Zh)&&!this._s(t.ownerId)&&!this.Xi(t)&&!(this.xi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new x(R.FAILED_PRECONDITION,ed)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return To(e).put(Ii,t)}static C(){return Jn.C()}Yi(e){let t=To(e);return t.get(Ii).next(r=>this.Xi(r)?(D(zn,"Releasing primary lease."),t.delete(Ii)):C.resolve())}ns(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(be(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Ni=()=>{this.us();let t=/(?:Version|Mobile)\/1[456]/;xh()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{let r=((t=this.Ui)===null||t===void 0?void 0:t.getItem(this.ss(e)))!==null;return D(zn,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return be(zn,"Failed to get zombied client id.",r),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){be("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function To(n){return Ue(n,oa)}function Vl(n){return Ue(n,zi)}function Np(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var yf=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Is=r,this.ds=i}static Es(e,t){let r=X(),i=X();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var vf=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var wc=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return xh()?8:vw(io())>0?6:4})()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ps(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new vf;return this.ws(e,t,o).next(a=>{if(s.result=a,this.Rs)return this.Ss(e,t,o,a.size)})}).next(()=>s.result)}Ss(e,t,r,i){return r.documentReadCount<this.Vs?(Pi()<=Ct.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",Ni(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),C.resolve()):(Pi()<=Ct.DEBUG&&D("QueryEngine","Query:",Ni(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(Pi()<=Ct.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",Ni(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,st(t))):C.resolve())}ps(e,t){if(_v(t))return C.resolve(null);let r=st(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=ic(t,null,"F"),r=st(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=X(...s);return this.gs.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{let u=this.bs(t,a);return this.Ds(t,u,o,c.readTime)?this.ps(e,ic(t,null,"F")):this.vs(e,u,t,c)}))})))}ys(e,t,r,i){return _v(t)||i.isEqual(G.min())?C.resolve(null):this.gs.getDocuments(e,r).next(s=>{let o=this.bs(t,s);return this.Ds(t,o,r,i)?C.resolve(null):(Pi()<=Ct.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ni(t)),this.vs(e,o,t,mw(i,Ui)).next(a=>a))})}bs(e,t){let r=new he(Hw(e));return t.forEach((i,s)=>{ca(e,s)&&(r=r.add(s))}),r}Ds(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,r){return Pi()<=Ct.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",Ni(t)),this.gs.getDocumentsMatchingQuery(e,t,Rt.min(),r)}vs(e,t,r,i){return this.gs.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var kp="LocalStore",Jb=3e8,wf=class{constructor(e,t,r,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new _e($),this.Ms=new Mt(s=>Gr(s),aa),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(r)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new _c(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function kE(n,e,t,r){return new wf(n,e,t,r)}async function xE(n,e){let t=L(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],c=X();for(let u of i){o.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(r,c).next(u=>({Bs:u,removedBatchIds:o,addedBatchIds:a}))})})}function Zb(n,e){let t=L(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return(function(a,c,u,d){let p=u.batch,g=p.keys(),y=C.resolve();return g.forEach(S=>{y=y.next(()=>d.getEntry(c,S)).next(N=>{let k=u.docVersions.get(S);j(k!==null,48541),N.version.compareTo(k)<0&&(p.applyToRemoteDocument(N,u),N.isValidDocument()&&(N.setReadTime(u.commitVersion),d.addEntry(N)))})}),y.next(()=>a.mutationQueue.removeMutationBatch(c,p))})(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(a){let c=X();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c})(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function DE(n){let e=L(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function eC(n,e){let t=L(n),r=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let a=[];e.targetChanges.forEach((d,p)=>{let g=i.get(p);if(!g)return;a.push(t.hi.removeMatchingKeys(s,d.removedDocuments,p).next(()=>t.hi.addMatchingKeys(s,d.addedDocuments,p)));let y=g.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(p)!==null?y=y.withResumeToken(Pe.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):d.resumeToken.approximateByteSize()>0&&(y=y.withResumeToken(d.resumeToken,r)),i=i.insert(p,y),(function(N,k,q){return N.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-N.snapshotVersion.toMicroseconds()>=Jb?!0:q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0})(g,y,d)&&a.push(t.hi.updateTargetData(s,y))});let c=ft(),u=X();if(e.documentUpdates.forEach(d=>{e.resolvedLimboDocuments.has(d)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,d))}),a.push(VE(s,o,e.documentUpdates).next(d=>{c=d.Ls,u=d.ks})),!r.isEqual(G.min())){let d=t.hi.getLastRemoteSnapshotVersion(s).next(p=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(d)}return C.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(t.Fs=i,s))}function VE(n,e,t){let r=X(),i=X();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=ft();return t.forEach((a,c)=>{let u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(G.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):D(kp,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{Ls:o,ks:i}})}function tC(n,e){let t=L(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Qn),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Zi(n,e){let t=L(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.hi.getTargetData(r,e).next(s=>s?(i=s,C.resolve(i)):t.hi.allocateTargetId(r).next(o=>(i=new Xi(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(r.targetId,r),t.Ms.set(e,r.targetId)),r})}async function es(n,e,t){let r=L(n),i=r.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!cr(o))throw o;D(kp,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Fs=r.Fs.remove(e),r.Ms.delete(i.target)}function Ec(n,e,t){let r=L(n),i=G.min(),s=X();return r.persistence.runTransaction("Execute query","readwrite",o=>(function(c,u,d){let p=L(c),g=p.Ms.get(d);return g!==void 0?C.resolve(p.Fs.get(g)):p.hi.getTargetData(u,d)})(r,o,st(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.Cs.getDocumentsMatchingQuery(o,e,t?i:G.min(),t?s:X())).next(a=>(ME(r,Qw(e),a),{documents:a,qs:s})))}function OE(n,e){let t=L(n),r=L(t.hi),i=t.Fs.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.Et(s,e).next(o=>o?o.target:null))}function FE(n,e){let t=L(n),r=t.xs.get(e)||G.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Os.getAllFromCollectionGroup(i,e,mw(r,Ui),Number.MAX_SAFE_INTEGER)).then(i=>(ME(t,e,i),i))}function ME(n,e,t){let r=n.xs.get(e)||G.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(e,r)}async function nC(n,e,t,r){let i=L(n),s=X(),o=ft();for(let u of t){let d=e.Qs(u.metadata.name);u.document&&(s=s.add(d));let p=e.$s(u);p.setReadTime(e.Us(u.metadata.readTime)),o=o.insert(d,p)}let a=i.Os.newChangeBuffer({trackRemovals:!0}),c=await Zi(i,(function(d){return st(ls(re.fromString(`__bundle__/docs/${d}`)))})(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",u=>VE(u,a,o).next(d=>(a.apply(u),d)).next(d=>i.hi.removeMatchingKeysForTargetId(u,c.targetId).next(()=>i.hi.addMatchingKeys(u,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,d.Ls,d.ks)).next(()=>d.Ls)))}async function rC(n,e,t=X()){let r=await Zi(n,st(Rp(e.bundledQuery))),i=L(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{let o=Re(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ti.saveNamedQuery(s,e);let a=r.withResumeToken(Pe.EMPTY_BYTE_STRING,o);return i.Fs=i.Fs.insert(a.targetId,a),i.hi.updateTargetData(s,a).next(()=>i.hi.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.hi.addMatchingKeys(s,t,r.targetId)).next(()=>i.Ti.saveNamedQuery(s,e))})}var LE="firestore_clients";function $v(n,e){return`${LE}_${n}_${e}`}var UE="firestore_mutations";function Qv(n,e,t){let r=`${UE}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var BE="firestore_targets";function td(n,e){return`${BE}_${n}_${e}`}var Wt="SharedClientState",Tc=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ks(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new x(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(be(Wt,`Failed to parse mutation state for ID '${t}': ${r}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},ko=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ks(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new x(r.error.code,r.error.message))),s?new n(e,r.state,i):(be(Wt,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Ic=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ks(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Sp();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=ww(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(be(Wt,`Failed to parse client data for instance '${e}': ${t}`),null)}},Ef=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Ks(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(be(Wt,`Failed to parse online state: ${e}`),null)}},Zo=class{constructor(){this.activeTargetIds=Sp()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},xo=class{constructor(e,t,r,i,s){this.window=e,this.Fi=t,this.persistenceKey=r,this.js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new _e($),this.started=!1,this.Zs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=$v(this.persistenceKey,this.js),this.eo=(function(c){return`firestore_sequence_number_${c}`})(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new Zo),this.no=new RegExp(`^${LE}_${o}_([^_]*)$`),this.ro=new RegExp(`^${UE}_${o}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${BE}_${o}_(\\d+)$`),this.so=(function(c){return`firestore_online_state_${c}`})(this.persistenceKey),this.oo=(function(c){return`firestore_bundle_loaded_v2_${c}`})(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(e){return!(!e||!e.localStorage)}async start(){let e=await this.syncEngine.Ps();for(let r of e){if(r===this.js)continue;let i=this.getItem($v(this.persistenceKey,r));if(i){let s=Ic.Ks(r,i);s&&(this.Ys=this.Ys.insert(s.clientId,s))}}this._o();let t=this.storage.getItem(this.so);if(t){let r=this.ao(t);r&&this.uo(r)}for(let r of this.Zs)this.Hs(r);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.eo,JSON.stringify(e))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(e){let t=!1;return this.Ys.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.lo(e,"pending")}updateMutationState(e,t,r){this.lo(e,t,r),this.ho(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(td(this.persistenceKey,e));if(i){let s=ko.Ks(e,i);s&&(r=s.state)}}return t&&this.Po.Gs(e),this._o(),r}removeLocalQueryTarget(e){this.Po.zs(e),this._o()}isLocalQueryTarget(e){return this.Po.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(td(this.persistenceKey,e))}updateQueryState(e,t,r){this.To(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.ho(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Io(e)}notifyBundleLoaded(e){this.Eo(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return D(Wt,"READ",e,t),t}setItem(e,t){D(Wt,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){D(Wt,"REMOVE",e),this.storage.removeItem(e)}Hs(e){let t=e;if(t.storageArea===this.storage){if(D(Wt,"EVENT",t.key,t.newValue),t.key===this.Xs)return void be("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.no.test(t.key)){if(t.newValue==null){let r=this.Ao(t.key);return this.Ro(r,null)}{let r=this.Vo(t.key,t.newValue);if(r)return this.Ro(r.clientId,r)}}else if(this.ro.test(t.key)){if(t.newValue!==null){let r=this.mo(t.key,t.newValue);if(r)return this.fo(r)}}else if(this.io.test(t.key)){if(t.newValue!==null){let r=this.po(t.key,t.newValue);if(r)return this.yo(r)}}else if(t.key===this.so){if(t.newValue!==null){let r=this.ao(t.newValue);if(r)return this.uo(r)}}else if(t.key===this.eo){let r=(function(s){let o=vt.ue;if(s!=null)try{let a=JSON.parse(s);j(typeof a=="number",30636,{wo:s}),o=a}catch(a){be(Wt,"Failed to read sequence number from WebStorage",a)}return o})(t.newValue);r!==vt.ue&&this.sequenceNumberHandler(r)}else if(t.key===this.oo){let r=this.So(t.newValue);await Promise.all(r.map(i=>this.syncEngine.bo(i)))}}}else this.Zs.push(t)})}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(e,t,r){let i=new Tc(this.currentUser,e,t,r),s=Qv(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Ws())}ho(e){let t=Qv(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Io(e){let t={clientId:this.js,onlineState:e};this.storage.setItem(this.so,JSON.stringify(t))}To(e,t,r){let i=td(this.persistenceKey,e),s=new ko(e,t,r);this.setItem(i,s.Ws())}Eo(e){let t=JSON.stringify(Array.from(e));this.setItem(this.oo,t)}Ao(e){let t=this.no.exec(e);return t?t[1]:null}Vo(e,t){let r=this.Ao(e);return Ic.Ks(r,t)}mo(e,t){let r=this.ro.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Tc.Ks(new De(s),i,t)}po(e,t){let r=this.io.exec(e),i=Number(r[1]);return ko.Ks(i,t)}ao(e){return Ef.Ks(e)}So(e){return JSON.parse(e)}async fo(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Do(e.batchId,e.state,e.error);D(Wt,`Ignoring mutation for non-active user ${e.user.uid}`)}yo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Ro(e,t){let r=t?this.Ys.insert(e,t):this.Ys.remove(e),i=this.co(this.Ys),s=this.co(r),o=[],a=[];return s.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.Co(o,a).then(()=>{this.Ys=r})}uo(e){this.Ys.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}co(e){let t=Sp();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},Ac=class{constructor(){this.Fo=new Zo,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,r){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new Zo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var Tf=class{xo(e){}shutdown(){}};var Hv="ConnectivityMonitor",Sc=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){D(Hv,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){D(Hv,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Ol=null;function If(){return Ol===null?Ol=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ol++,"0x"+Ol.toString(16)}var nd="RestConnection",iC={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},Af=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===wd?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(e,t,r,i,s){let o=If(),a=this.Go(e,t.toUriEncodedString());D(nd,`Sending RPC '${e}' ${o}:`,a,r);let c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(c,i,s);let{host:u}=new URL(a),d=vi(u);return this.jo(e,a,c,r,d).then(p=>(D(nd,`Received RPC '${e}' ${o}: `,p),p),p=>{throw gt(nd,`RPC '${e}' ${o} failed with error: `,p,"url: ",a,"request:",r),p})}Jo(e,t,r,i,s,o){return this.Wo(e,t,r,i,s)}zo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+as})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}Go(e,t){let r=iC[e];return`${this.$o}/v1/${t}:${r}`}terminate(){}};var Sf=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var Je="WebChannelConnection",bf=class extends Af{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,r,i,s){let o=If();return new Promise((a,c)=>{let u=new Kh;u.setWithCredentials(!0),u.listenOnce($h.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case yo.NO_ERROR:let p=u.getResponseJson();D(Je,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(p)),a(p);break;case yo.TIMEOUT:D(Je,`RPC '${e}' ${o} timed out`),c(new x(R.DEADLINE_EXCEEDED,"Request time out"));break;case yo.HTTP_ERROR:let g=u.getStatus();if(D(Je,`RPC '${e}' ${o} failed with status:`,g,"response text:",u.getResponseText()),g>0){let y=u.getResponseJson();Array.isArray(y)&&(y=y[0]);let S=y?.error;if(S&&S.status&&S.message){let N=(function(q){let B=q.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(B)>=0?B:R.UNKNOWN})(S.status);c(new x(N,S.message))}else c(new x(R.UNKNOWN,"Server responded with status "+u.getStatus()))}else c(new x(R.UNAVAILABLE,"Connection failed."));break;default:U(9055,{c_:e,streamId:o,l_:u.getLastErrorCode(),h_:u.getLastError()})}}finally{D(Je,`RPC '${e}' ${o} completed.`)}});let d=JSON.stringify(i);D(Je,`RPC '${e}' ${o} sending request:`,i),u.send(t,"POST",d,r,15)})}P_(e,t,r){let i=If(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=Yh(),a=Hh(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.zo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;let d=s.join("");D(Je,`Creating RPC '${e}' stream ${i}: ${d}`,c);let p=o.createWebChannel(d,c);this.T_(p);let g=!1,y=!1,S=new Sf({Ho:k=>{y?D(Je,`Not sending because RPC '${e}' stream ${i} is closed:`,k):(g||(D(Je,`Opening RPC '${e}' stream ${i} transport.`),p.open(),g=!0),D(Je,`RPC '${e}' stream ${i} sending:`,k),p.send(k))},Yo:()=>p.close()}),N=(k,q,B)=>{k.listen(q,O=>{try{B(O)}catch(z){setTimeout(()=>{throw z},0)}})};return N(p,Ti.EventType.OPEN,()=>{y||(D(Je,`RPC '${e}' stream ${i} transport opened.`),S.s_())}),N(p,Ti.EventType.CLOSE,()=>{y||(y=!0,D(Je,`RPC '${e}' stream ${i} transport closed`),S.__(),this.I_(p))}),N(p,Ti.EventType.ERROR,k=>{y||(y=!0,gt(Je,`RPC '${e}' stream ${i} transport errored. Name:`,k.name,"Message:",k.message),S.__(new x(R.UNAVAILABLE,"The operation could not be completed")))}),N(p,Ti.EventType.MESSAGE,k=>{var q;if(!y){let B=k.data[0];j(!!B,16349);let O=B,z=O?.error||((q=O[0])===null||q===void 0?void 0:q.error);if(z){D(Je,`RPC '${e}' stream ${i} received error:`,z);let Q=z.status,H=(function(w){let T=ke[w];if(T!==void 0)return lE(T)})(Q),E=z.message;H===void 0&&(H=R.INTERNAL,E="Unknown error status: "+Q+" with message "+z.message),y=!0,S.__(new x(H,E)),p.close()}else D(Je,`RPC '${e}' stream ${i} received:`,B),S.a_(B)}}),N(a,Qh.STAT_EVENT,k=>{k.stat===Nl.PROXY?D(Je,`RPC '${e}' stream ${i} detected buffering proxy`):k.stat===Nl.NOPROXY&&D(Je,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{S.o_()},0),S}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function qE(){return typeof window<"u"?window:null}function Gl(){return typeof document<"u"?document:null}function ua(n){return new Ud(n,!0)}var ea=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-r);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var Yv="PersistentStream",bc=class{constructor(e,t,r,i,s,o,a,c){this.Fi=e,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new ea(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(be(t.toString()),be("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===t&&this.W_(r,i)},r=>{e(()=>{let i=new x(R.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(e,t){let r=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(async()=>{this.state=0,this.start()})}G_(e){return D(Yv,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(D(Yv,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Cf=class extends bc{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=qb(this.serializer,e),r=(function(s){if(!("targetChange"in s))return G.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?G.min():o.readTime?Re(o.readTime):G.min()})(e);return this.listener.J_(t,r)}H_(e){let t={};t.database=jd(this.serializer),t.addTarget=(function(s,o){let a,c=o.target;if(a=nc(c)?{documents:gE(s,c)}:{query:mE(s,c).Vt},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=cE(s,o.resumeToken);let u=Bd(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(G.min())>0){a.readTime=Yi(s,o.snapshotVersion.toTimestamp());let u=Bd(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a})(this.serializer,e);let r=Gb(this.serializer,e);r&&(t.labels=r),this.k_(t)}Y_(e){let t={};t.database=jd(this.serializer),t.removeTarget=e,this.k_(t)}},Rf=class extends bc{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return j(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,j(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){j(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=jb(e.writeResults,e.commitTime),r=Re(e.commitTime);return this.listener.ta(r,t)}na(){let e={};e.database=jd(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Ho(this.serializer,r))};this.k_(t)}};var Pf=class{},Nf=class extends Pf{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new x(R.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Wo(e,qd(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new x(R.UNKNOWN,s.toString())})}Jo(e,t,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Jo(e,qd(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new x(R.UNKNOWN,o.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},kf=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(be(t),this._a=!1):D("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var $r="RemoteStore",xf=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(o=>{r.enqueueAndForget(async()=>{hr(this)&&(D($r,"Restarting streams for network reachability change."),await(async function(c){let u=L(c);u.Ia.add(4),await cs(u),u.Aa.set("Unknown"),u.Ia.delete(4),await ha(u)})(this))})}),this.Aa=new kf(r,i)}};async function ha(n){if(hr(n))for(let e of n.da)await e(!0)}async function cs(n){for(let e of n.da)await e(!1)}function Jc(n,e){let t=L(n);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),Vp(t)?Dp(t):hs(t).x_()&&xp(t,e))}function ts(n,e){let t=L(n),r=hs(t);t.Ta.delete(e),r.x_()&&jE(t,e),t.Ta.size===0&&(r.x_()?r.B_():hr(t)&&t.Aa.set("Unknown"))}function xp(n,e){if(n.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(G.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}hs(n).H_(e)}function jE(n,e){n.Ra.$e(e),hs(n).Y_(e)}function Dp(n){n.Ra=new Ld({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>n.Ta.get(e)||null,lt:()=>n.datastore.serializer.databaseId}),hs(n).start(),n.Aa.aa()}function Vp(n){return hr(n)&&!hs(n).M_()&&n.Ta.size>0}function hr(n){return L(n).Ia.size===0}function GE(n){n.Ra=void 0}async function sC(n){n.Aa.set("Online")}async function oC(n){n.Ta.forEach((e,t)=>{xp(n,e)})}async function aC(n,e){GE(n),Vp(n)?(n.Aa.la(e),Dp(n)):n.Aa.set("Unknown")}async function lC(n,e,t){if(n.Aa.set("Online"),e instanceof oc&&e.state===2&&e.cause)try{await(async function(i,s){let o=s.cause;for(let a of s.targetIds)i.Ta.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.Ta.delete(a),i.Ra.removeTarget(a))})(n,e)}catch(r){D($r,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Cc(n,r)}else if(e instanceof Mi?n.Ra.Ye(e):e instanceof sc?n.Ra.it(e):n.Ra.et(e),!t.isEqual(G.min()))try{let r=await DE(n.localStore);t.compareTo(r)>=0&&await(function(s,o){let a=s.Ra.Pt(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){let d=s.Ta.get(u);d&&s.Ta.set(u,d.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{let d=s.Ta.get(c);if(!d)return;s.Ta.set(c,d.withResumeToken(Pe.EMPTY_BYTE_STRING,d.snapshotVersion)),jE(s,c);let p=new Xi(d.target,c,u,d.sequenceNumber);xp(s,p)}),s.remoteSyncer.applyRemoteEvent(a)})(n,t)}catch(r){D($r,"Failed to raise snapshot:",r),await Cc(n,r)}}async function Cc(n,e,t){if(!cr(e))throw e;n.Ia.add(1),await cs(n),n.Aa.set("Offline"),t||(t=()=>DE(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{D($r,"Retrying IndexedDB access"),await t(),n.Ia.delete(1),await ha(n)})}function zE(n,e){return e().catch(t=>Cc(n,t,e))}async function us(n){let e=L(n),t=or(e),r=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Qn;for(;cC(e);)try{let i=await tC(e.localStore,r);if(i===null){e.Pa.length===0&&t.B_();break}r=i.batchId,uC(e,i)}catch(i){await Cc(e,i)}WE(e)&&KE(e)}function cC(n){return hr(n)&&n.Pa.length<10}function uC(n,e){n.Pa.push(e);let t=or(n);t.x_()&&t.Z_&&t.X_(e.mutations)}function WE(n){return hr(n)&&!or(n).M_()&&n.Pa.length>0}function KE(n){or(n).start()}async function hC(n){or(n).na()}async function dC(n){let e=or(n);for(let t of n.Pa)e.X_(t.mutations)}async function fC(n,e,t){let r=n.Pa.shift(),i=Od.from(r,e,t);await zE(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await us(n)}async function pC(n,e){e&&or(n).Z_&&await(async function(r,i){if((function(o){return aE(o)&&o!==R.ABORTED})(i.code)){let s=r.Pa.shift();or(r).N_(),await zE(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await us(r)}})(n,e),WE(n)&&KE(n)}async function Xv(n,e){let t=L(n);t.asyncQueue.verifyOperationInProgress(),D($r,"RemoteStore received new credentials");let r=hr(t);t.Ia.add(3),await cs(t),r&&t.Aa.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),await ha(t)}async function Df(n,e){let t=L(n);e?(t.Ia.delete(2),await ha(t)):e||(t.Ia.add(2),await cs(t),t.Aa.set("Unknown"))}function hs(n){return n.Va||(n.Va=(function(t,r,i){let s=L(t);return s.ia(),new Cf(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:sC.bind(null,n),e_:oC.bind(null,n),n_:aC.bind(null,n),J_:lC.bind(null,n)}),n.da.push(async e=>{e?(n.Va.N_(),Vp(n)?Dp(n):n.Aa.set("Unknown")):(await n.Va.stop(),GE(n))})),n.Va}function or(n){return n.ma||(n.ma=(function(t,r,i){let s=L(t);return s.ia(),new Rf(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:hC.bind(null,n),n_:pC.bind(null,n),ea:dC.bind(null,n),ta:fC.bind(null,n)}),n.da.push(async e=>{e?(n.ma.N_(),await us(n)):(await n.ma.stop(),n.Pa.length>0&&(D($r,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))})),n.ma}var Vf=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Le,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new x(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function ds(n,e){if(be("AsyncQueue",`${e}: ${n}`),cr(n))return new x(R.UNAVAILABLE,`${e}: ${n}`);throw n}var Rc=class n{static emptySet(e){return new n(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||M.comparator(t.key,r.key):(t,r)=>M.comparator(t.key,r.key),this.keyedMap=Io(),this.sortedSet=new _e(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Pc=class{constructor(){this.fa=new _e(M.comparator)}track(e){let t=e.doc.key,r=this.fa.get(t);r?e.type!==0&&r.type===3?this.fa=this.fa.insert(t,e):e.type===3&&r.type!==1?this.fa=this.fa.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.fa=this.fa.remove(t):e.type===1&&r.type===2?this.fa=this.fa.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):U(63341,{At:e,ga:r}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,r)=>{e.push(r)}),e}},ns=class n{constructor(e,t,r,i,s,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Rc.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&la(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Of=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},Ff=class{constructor(){this.queries=Jv(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,r){let i=L(t),s=i.queries;i.queries=Jv(),s.forEach((o,a)=>{for(let c of a.wa)c.onError(r)})})(this,new x(R.ABORTED,"Firestore shutting down"))}};function Jv(){return new Mt(n=>$w(n),la)}async function Op(n,e){let t=L(n),r=3,i=e.query,s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(r=2):(s=new Of,r=e.ba()?0:1);try{switch(r){case 0:s.ya=await t.onListen(i,!0);break;case 1:s.ya=await t.onListen(i,!1);break;case 2:await t.onFirstRemoteStoreListen(i)}}catch(o){let a=ds(o,`Initialization of query '${Ni(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&Mp(t)}async function Fp(n,e){let t=L(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.wa.indexOf(e);o>=0&&(s.wa.splice(o,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function gC(n,e){let t=L(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.wa)a.Ca(i)&&(r=!0);o.ya=i}}r&&Mp(t)}function mC(n,e,t){let r=L(n),i=r.queries.get(e);if(i)for(let s of i.wa)s.onError(t);r.queries.delete(e)}function Mp(n){n.Da.forEach(e=>{e.next()})}var Mf,Zv;(Zv=Mf||(Mf={})).Fa="default",Zv.Cache="cache";var ta=class{constructor(e,t,r){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ns(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let r=t!=="Offline";return(!this.options.ka||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=ns.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Mf.Cache}};var Lf=class{constructor(e,t){this.qa=e,this.byteLength=t}Qa(){return"metadata"in this.qa}};var Nc=class{constructor(e){this.serializer=e}Qs(e){return Ht(this.serializer,e)}$s(e){return e.metadata.exists?pE(this.serializer,e.document,!1):Oe.newNoDocument(this.Qs(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return Re(e)}},Uf=class{constructor(e,t){this.$a=e,this.serializer=t,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=$E(e)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Ua.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Ka.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let r=re.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.qa.document&&(this.Ka[this.Ka.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){let t=new Map,r=new Nc(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Qs(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||X()).add(s);t.set(o,a)}}return t}async za(e){let t=await nC(e,new Nc(this.serializer),this.Ka,this.$a.id),r=this.Ga(this.documents);for(let i of this.Ua)await rC(e,i,r.get(i.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:t}}};function $E(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var kc=class{constructor(e){this.key=e}},xc=class{constructor(e){this.key=e}},Dc=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=X(),this.mutatedKeys=X(),this.Xa=Hw(e),this.eu=new Rc(this.Xa)}get tu(){return this.Ha}nu(e,t){let r=t?t.ru:new Pc,i=t?t.eu:this.eu,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((d,p)=>{let g=i.get(d),y=ca(this.query,p)?p:null,S=!!g&&this.mutatedKeys.has(g.key),N=!!y&&(y.hasLocalMutations||this.mutatedKeys.has(y.key)&&y.hasCommittedMutations),k=!1;g&&y?g.data.isEqual(y.data)?S!==N&&(r.track({type:3,doc:y}),k=!0):this.iu(g,y)||(r.track({type:2,doc:y}),k=!0,(c&&this.Xa(y,c)>0||u&&this.Xa(y,u)<0)&&(a=!0)):!g&&y?(r.track({type:0,doc:y}),k=!0):g&&!y&&(r.track({type:1,doc:g}),k=!0,(c||u)&&(a=!0)),k&&(y?(o=o.add(y),s=N?s.add(d):s.delete(d)):(o=o.delete(d),s=s.delete(d)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let d=this.query.limitType==="F"?o.last():o.first();o=o.delete(d.key),s=s.delete(d.key),r.track({type:1,doc:d})}return{eu:o,ru:r,Ds:a,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let o=e.ru.pa();o.sort((d,p)=>(function(y,S){let N=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U(20277,{At:k})}};return N(y)-N(S)})(d.type,p.type)||this.Xa(d.doc,p.doc)),this.su(r),i=i!=null&&i;let a=t&&!i?this.ou():[],c=this.Za.size===0&&this.current&&!i?1:0,u=c!==this.Ya;return this.Ya=c,o.length!==0||u?{snapshot:new ns(this.query,e.eu,s,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:a}:{_u:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Pc,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=X(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let t=[];return e.forEach(r=>{this.Za.has(r)||t.push(new xc(r))}),this.Za.forEach(r=>{e.has(r)||t.push(new kc(r))}),t}uu(e){this.Ha=e.qs,this.Za=X();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return ns.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},dr="SyncEngine",Bf=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},qf=class{constructor(e){this.key=e,this.lu=!1}},jf=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.hu={},this.Pu=new Mt(a=>$w(a),la),this.Tu=new Map,this.Iu=new Set,this.du=new _e(M.comparator),this.Eu=new Map,this.Au=new Xo,this.Ru={},this.Vu=new Map,this.mu=Ji.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};async function _C(n,e,t=!0){let r=Zc(n),i,s=r.Pu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=await QE(r,e,t,!0),i}async function yC(n,e){let t=Zc(n);await QE(t,e,!0,!1)}async function QE(n,e,t,r){let i=await Zi(n.localStore,st(e)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,t),a;return r&&(a=await Lp(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Jc(n.remoteStore,i),a}async function Lp(n,e,t,r,i){n.gu=(p,g,y)=>(async function(N,k,q,B){let O=k.view.nu(q);O.Ds&&(O=await Ec(N.localStore,k.query,!1).then(({documents:E})=>k.view.nu(E,O)));let z=B&&B.targetChanges.get(k.targetId),Q=B&&B.targetMismatches.get(k.targetId)!=null,H=k.view.applyChanges(O,N.isPrimaryClient,z,Q);return Gf(N,k.targetId,H._u),H.snapshot})(n,p,g,y);let s=await Ec(n.localStore,e,!0),o=new Dc(e,s.qs),a=o.nu(s.documents),c=$o.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),u=o.applyChanges(a,n.isPrimaryClient,c);Gf(n,t,u._u);let d=new Bf(e,t,o);return n.Pu.set(e,d),n.Tu.has(t)?n.Tu.get(t).push(e):n.Tu.set(t,[e]),u.snapshot}async function vC(n,e,t){let r=L(n),i=r.Pu.get(e),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(o=>!la(o,e))),void r.Pu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await es(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&ts(r.remoteStore,i.targetId),rs(r,i.targetId)}).catch(lr)):(rs(r,i.targetId),await es(r.localStore,i.targetId,!0))}async function wC(n,e){let t=L(n),r=t.Pu.get(e),i=t.Tu.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),ts(t.remoteStore,r.targetId))}async function EC(n,e,t){let r=jp(n);try{let i=await(function(o,a){let c=L(o),u=pe.now(),d=a.reduce((y,S)=>y.add(S.key),X()),p,g;return c.persistence.runTransaction("Locally write mutations","readwrite",y=>{let S=ft(),N=X();return c.Os.getEntries(y,d).next(k=>{S=k,S.forEach((q,B)=>{B.isValidDocument()||(N=N.add(q))})}).next(()=>c.localDocuments.getOverlayedDocuments(y,S)).next(k=>{p=k;let q=[];for(let B of a){let O=Vb(B,p.get(B.key).overlayedDocument);O!=null&&q.push(new Lt(B.key,O,Bw(O.value.mapValue),Ae.exists(!0)))}return c.mutationQueue.addMutationBatch(y,u,q,a)}).next(k=>{g=k;let q=k.applyToLocalDocumentSet(p,N);return c.documentOverlayCache.saveOverlays(y,k.batchId,q)})}).then(()=>({batchId:g.batchId,changes:Xw(p)}))})(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),(function(o,a,c){let u=o.Ru[o.currentUser.toKey()];u||(u=new _e($)),u=u.insert(a,c),o.Ru[o.currentUser.toKey()]=u})(r,i.batchId,t),await Tn(r,i.changes),await us(r.remoteStore)}catch(i){let s=ds(i,"Failed to persist write");t.reject(s)}}async function HE(n,e){let t=L(n);try{let r=await eC(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Eu.get(s);o&&(j(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.lu=!0:i.modifiedDocuments.size>0?j(o.lu,14607):i.removedDocuments.size>0&&(j(o.lu,42227),o.lu=!1))}),await Tn(t,r,e)}catch(r){await lr(r)}}function ew(n,e,t){let r=L(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.Pu.forEach((s,o)=>{let a=o.view.va(e);a.snapshot&&i.push(a.snapshot)}),(function(o,a){let c=L(o);c.onlineState=a;let u=!1;c.queries.forEach((d,p)=>{for(let g of p.wa)g.va(a)&&(u=!0)}),u&&Mp(c)})(r.eventManager,e),i.length&&r.hu.J_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function TC(n,e,t){let r=L(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Eu.get(e),s=i&&i.key;if(s){let o=new _e(M.comparator);o=o.insert(s,Oe.newNoDocument(s,G.min()));let a=X().add(s),c=new Ko(G.min(),new Map,new _e($),o,a);await HE(r,c),r.du=r.du.remove(s),r.Eu.delete(e),qp(r)}else await es(r.localStore,e,!1).then(()=>rs(r,e,t)).catch(lr)}async function IC(n,e){let t=L(n),r=e.batch.batchId;try{let i=await Zb(t.localStore,e);Bp(t,r,null),Up(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Tn(t,i)}catch(i){await lr(i)}}async function AC(n,e,t){let r=L(n);try{let i=await(function(o,a){let c=L(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let d;return c.mutationQueue.lookupMutationBatch(u,a).next(p=>(j(p!==null,37113),d=p.keys(),c.mutationQueue.removeMutationBatch(u,p))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,d,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,d)).next(()=>c.localDocuments.getDocuments(u,d))})})(r.localStore,e);Bp(r,e,t),Up(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Tn(r,i)}catch(i){await lr(i)}}async function SC(n,e){let t=L(n);hr(t.remoteStore)||D(dr,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=await(function(o){let a=L(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))})(t.localStore);if(r===Qn)return void e.resolve();let i=t.Vu.get(r)||[];i.push(e),t.Vu.set(r,i)}catch(r){let i=ds(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}function Up(n,e){(n.Vu.get(e)||[]).forEach(t=>{t.resolve()}),n.Vu.delete(e)}function Bp(n,e,t){let r=L(n),i=r.Ru[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Ru[r.currentUser.toKey()]=i}}function rs(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Tu.get(e))n.Pu.delete(r),t&&n.hu.pu(r,t);n.Tu.delete(e),n.isPrimaryClient&&n.Au.zr(e).forEach(r=>{n.Au.containsKey(r)||YE(n,r)})}function YE(n,e){n.Iu.delete(e.path.canonicalString());let t=n.du.get(e);t!==null&&(ts(n.remoteStore,t),n.du=n.du.remove(e),n.Eu.delete(t),qp(n))}function Gf(n,e,t){for(let r of t)r instanceof kc?(n.Au.addReference(r.key,e),bC(n,r)):r instanceof xc?(D(dr,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,e),n.Au.containsKey(r.key)||YE(n,r.key)):U(19791,{yu:r})}function bC(n,e){let t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Iu.has(r)||(D(dr,"New document in limbo: "+t),n.Iu.add(r),qp(n))}function qp(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let e=n.Iu.values().next().value;n.Iu.delete(e);let t=new M(re.fromString(e)),r=n.mu.next();n.Eu.set(r,new qf(t)),n.du=n.du.insert(t,r),Jc(n.remoteStore,new Xi(st(ls(t.path)),r,"TargetPurposeLimboResolution",vt.ue))}}async function Tn(n,e,t){let r=L(n),i=[],s=[],o=[];r.Pu.isEmpty()||(r.Pu.forEach((a,c)=>{o.push(r.gu(c,e,t).then(u=>{var d;if((u||t)&&r.isPrimaryClient){let p=u?!u.fromCache:(d=t?.targetChanges.get(c.targetId))===null||d===void 0?void 0:d.current;r.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(u){i.push(u);let p=yf.Es(c.targetId,u);s.push(p)}}))}),await Promise.all(o),r.hu.J_(i),await(async function(c,u){let d=L(c);try{await d.persistence.runTransaction("notifyLocalViewChanges","readwrite",p=>C.forEach(u,g=>C.forEach(g.Is,y=>d.persistence.referenceDelegate.addReference(p,g.targetId,y)).next(()=>C.forEach(g.ds,y=>d.persistence.referenceDelegate.removeReference(p,g.targetId,y)))))}catch(p){if(!cr(p))throw p;D(kp,"Failed to update sequence numbers: "+p)}for(let p of u){let g=p.targetId;if(!p.fromCache){let y=d.Fs.get(g),S=y.snapshotVersion,N=y.withLastLimboFreeSnapshotVersion(S);d.Fs=d.Fs.insert(g,N)}}})(r.localStore,s))}async function CC(n,e){let t=L(n);if(!t.currentUser.isEqual(e)){D(dr,"User change. New user:",e.toKey());let r=await xE(t.localStore,e);t.currentUser=e,(function(s,o){s.Vu.forEach(a=>{a.forEach(c=>{c.reject(new x(R.CANCELLED,o))})}),s.Vu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Tn(t,r.Bs)}}function RC(n,e){let t=L(n),r=t.Eu.get(e);if(r&&r.lu)return X().add(r.key);{let i=X(),s=t.Tu.get(e);if(!s)return i;for(let o of s){let a=t.Pu.get(o);i=i.unionWith(a.view.tu)}return i}}async function PC(n,e){let t=L(n),r=await Ec(t.localStore,e.query,!0),i=e.view.uu(r);return t.isPrimaryClient&&Gf(t,e.targetId,i._u),i}async function NC(n,e){let t=L(n);return FE(t.localStore,e).then(r=>Tn(t,r))}async function kC(n,e,t,r){let i=L(n),s=await(function(a,c){let u=L(a),d=L(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",p=>d.Xn(p,c).next(g=>g?u.localDocuments.getDocuments(p,g):C.resolve(null)))})(i.localStore,e);s!==null?(t==="pending"?await us(i.remoteStore):t==="acknowledged"||t==="rejected"?(Bp(i,e,r||null),Up(i,e),(function(a,c){L(L(a).mutationQueue).rr(c)})(i.localStore,e)):U(6720,"Unknown batchState",{wu:t}),await Tn(i,s)):D(dr,"Cannot apply mutation batch with id: "+e)}async function xC(n,e){let t=L(n);if(Zc(t),jp(t),e===!0&&t.fu!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=await tw(t,r.toArray());t.fu=!0,await Df(t.remoteStore,!0);for(let s of i)Jc(t.remoteStore,s)}else if(e===!1&&t.fu!==!1){let r=[],i=Promise.resolve();t.Tu.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(rs(t,o),es(t.localStore,o,!0))),ts(t.remoteStore,o)}),await i,await tw(t,r),(function(o){let a=L(o);a.Eu.forEach((c,u)=>{ts(a.remoteStore,u)}),a.Au.jr(),a.Eu=new Map,a.du=new _e(M.comparator)})(t),t.fu=!1,await Df(t.remoteStore,!1)}}async function tw(n,e,t){let r=L(n),i=[],s=[];for(let o of e){let a,c=r.Tu.get(o);if(c&&c.length!==0){a=await Zi(r.localStore,st(c[0]));for(let u of c){let d=r.Pu.get(u),p=await PC(r,d);p.snapshot&&s.push(p.snapshot)}}else{let u=await OE(r.localStore,o);a=await Zi(r.localStore,u),await Lp(r,XE(u),o,!1,a.resumeToken)}i.push(a)}return r.hu.J_(s),i}function XE(n){return Kw(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function DC(n){return(function(t){return L(L(t).persistence).Ps()})(L(n).localStore)}async function VC(n,e,t,r){let i=L(n);if(i.fu)return void D(dr,"Ignoring unexpected query state notification.");let s=i.Tu.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=await FE(i.localStore,Qw(s[0])),a=Ko.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Pe.EMPTY_BYTE_STRING);await Tn(i,o,a);break}case"rejected":await es(i.localStore,e,!0),rs(i,e,r);break;default:U(64155,t)}}async function OC(n,e,t){let r=Zc(n);if(r.fu){for(let i of e){if(r.Tu.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){D(dr,"Adding an already active target "+i);continue}let s=await OE(r.localStore,i),o=await Zi(r.localStore,s);await Lp(r,XE(s),o.targetId,!1,o.resumeToken),Jc(r.remoteStore,o)}for(let i of t)r.Tu.has(i)&&await es(r.localStore,i,!1).then(()=>{ts(r.remoteStore,i),rs(r,i)}).catch(lr)}}function Zc(n){let e=L(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=HE.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=RC.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=TC.bind(null,e),e.hu.J_=gC.bind(null,e.eventManager),e.hu.pu=mC.bind(null,e.eventManager),e}function jp(n){let e=L(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=IC.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=AC.bind(null,e),e}function FC(n,e,t){let r=L(n);(async function(s,o,a){try{let c=await o.getMetadata();if(await(function(y,S){let N=L(y),k=Re(S.createTime);return N.persistence.runTransaction("hasNewerBundle","readonly",q=>N.Ti.getBundleMetadata(q,S.id)).then(q=>!!q&&q.createTime.compareTo(k)>=0)})(s.localStore,c))return await o.close(),a._completeWith((function(y){return{taskState:"Success",documentsLoaded:y.totalDocuments,bytesLoaded:y.totalBytes,totalDocuments:y.totalDocuments,totalBytes:y.totalBytes}})(c)),Promise.resolve(new Set);a._updateProgress($E(c));let u=new Uf(c,o.serializer),d=await o.Su();for(;d;){let g=await u.Wa(d);g&&a._updateProgress(g),d=await o.Su()}let p=await u.za(s.localStore);return await Tn(s,p.Ja,void 0),await(function(y,S){let N=L(y);return N.persistence.runTransaction("Save bundle","readwrite",k=>N.Ti.saveBundleMetadata(k,S))})(s.localStore,c),a._completeWith(p.progress),Promise.resolve(p.ja)}catch(c){return gt(dr,`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var Gp=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=ua(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)}Cu(t,r){return null}Fu(t,r){return null}vu(t){return kE(this.persistence,new wc,t.initialUser,this.serializer)}Du(t){return new Jo(yc.Vi,this.serializer)}bu(t){return new Ac}async terminate(){var t,r;(t=this.gcScheduler)===null||t===void 0||t.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}return n.provider={build:()=>new n},n})(),zf=class extends Gp{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){j(this.persistence.referenceDelegate instanceof vc,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new gc(r,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?dt.withCacheSize(this.cacheSizeBytes):dt.DEFAULT;return new Jo(r=>vc.Vi(r,t),this.serializer)}},Vc=class extends Gp{constructor(e,t,r){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Mu.initialize(this,e),await jp(this.Mu.syncEngine),await us(this.Mu.remoteStore),await this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return kE(this.persistence,new wc,e.initialUser,this.serializer)}Cu(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new gc(r,e.asyncQueue,t)}Fu(e,t){let r=new gd(t,this.persistence);return new pd(e.asyncQueue,r)}Du(e){let t=Np(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?dt.withCacheSize(this.cacheSizeBytes):dt.DEFAULT;return new _f(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,qE(),Gl(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new Ac}},Wf=class extends Vc{constructor(e,t){super(e,t,!1),this.Mu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.Mu.syncEngine;this.sharedClientState instanceof xo&&(this.sharedClientState.syncEngine={Do:kC.bind(null,t),vo:VC.bind(null,t),Co:OC.bind(null,t),Ps:DC.bind(null,t),bo:NC.bind(null,t)},await this.sharedClientState.start()),await this.persistence.ji(async r=>{await xC(this.Mu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}bu(e){let t=qE();if(!xo.C(t))throw new x(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Np(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new xo(t,e.asyncQueue,r,e.clientId,e.initialUser)}},zp=(()=>{class n{async initialize(t,r){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>ew(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=CC.bind(null,this.syncEngine),await Df(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new Ff})()}createDatastore(t){let r=ua(t.databaseInfo.databaseId),i=(function(o){return new bf(o)})(t.databaseInfo);return(function(o,a,c,u){return new Nf(o,a,c,u)})(t.authCredentials,t.appCheckCredentials,i,r)}createRemoteStore(t){return(function(i,s,o,a,c){return new xf(i,s,o,a,c)})(this.localStore,this.datastore,t.asyncQueue,r=>ew(this.syncEngine,r,0),(function(){return Sc.C()?new Sc:new Tf})())}createSyncEngine(t,r){return(function(s,o,a,c,u,d,p){let g=new jf(s,o,a,c,u,d);return p&&(g.fu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,r)}async terminate(){var t,r;await(async function(s){let o=L(s);D($r,"RemoteStore shutting down."),o.Ia.add(5),await cs(o),o.Ea.shutdown(),o.Aa.set("Unknown")})(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()}}return n.provider={build:()=>new n},n})();function nw(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){let r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}var is=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):be("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Kf=class{constructor(e,t){this.Nu=e,this.serializer=t,this.metadata=new Le,this.buffer=new Uint8Array,this.Bu=(function(){return new TextDecoder("utf-8")})(),this.Lu().then(r=>{r&&r.Qa()?this.metadata.resolve(r.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.qa)}`))},r=>this.metadata.reject(r))}close(){return this.Nu.cancel()}async getMetadata(){return this.metadata.promise}async Su(){return await this.getMetadata(),this.Lu()}async Lu(){let e=await this.ku();if(e===null)return null;let t=this.Bu.decode(e),r=Number(t);isNaN(r)&&this.qu(`length string (${t}) is not valid number`);let i=await this.Qu(r);return new Lf(JSON.parse(i),e.length+r)}$u(){return this.buffer.findIndex(e=>e===123)}async ku(){for(;this.$u()<0&&!await this.Uu(););if(this.buffer.length===0)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Qu(e){for(;this.buffer.length<e;)await this.Uu()&&this.qu("Reached the end of bundle when more is expected.");let t=this.Bu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}qu(e){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${e}`)}async Uu(){let e=await this.Nu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}};var $f=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new x(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await(async function(i,s){let o=L(i),a={documents:s.map(p=>Qo(o.serializer,p))},c=await o.Jo("BatchGetDocuments",o.serializer.databaseId,re.emptyPath(),a,s.length),u=new Map;c.forEach(p=>{let g=Bb(o.serializer,p);u.set(g.key.toString(),g)});let d=[];return s.forEach(p=>{let g=u.get(p.toString());j(!!g,55234,{key:p}),d.push(g)}),d})(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new sr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=M.fromPath(r);this.mutations.push(new Go(i,this.precondition(i)))}),await(async function(r,i){let s=L(r),o={writes:i.map(a=>Ho(s.serializer,a))};await s.Wo("Commit",s.serializer.databaseId,re.emptyPath(),o)})(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U(50498,{Wu:e.constructor.name});t=G.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new x(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(G.min())?Ae.exists(!1):Ae.updateTime(t):Ae.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(G.min()))throw new x(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ae.updateTime(t)}return Ae.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var Qf=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Gu=r.maxAttempts,this.F_=new ea(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(async()=>{let e=new $f(this.datastore),t=this.Ju(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.Hu(i)}))}).catch(r=>{this.Hu(r)})})}Ju(e){try{let t=this.updateFunction(e);return!sa(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(e)}Yu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!aE(t)}return!1}};var ar="FirestoreClient",Hf=class{constructor(e,t,r,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=De.UNAUTHENTICATED,this.clientId=Do.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async o=>{D(ar,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(D(ar,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Le;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=ds(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}};async function rd(n,e){n.asyncQueue.verifyOperationInProgress(),D(ar,"Initializing OfflineComponentProvider");let t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await xE(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>{gt("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{D("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{gt("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=e}async function rw(n,e){n.asyncQueue.verifyOperationInProgress();let t=await Wp(n);D(ar,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>Xv(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Xv(e.remoteStore,i)),n._onlineComponents=e}async function Wp(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){D(ar,"Using user provided OfflineComponentProvider");try{await rd(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!(function(i){return i.name==="FirebaseError"?i.code===R.FAILED_PRECONDITION||i.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(t))throw t;gt("Error using user provided cache. Falling back to memory cache: "+t),await rd(n,new Gp)}}else D(ar,"Using default OfflineComponentProvider"),await rd(n,new zf(void 0));return n._offlineComponents}async function eu(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(D(ar,"Using user provided OnlineComponentProvider"),await rw(n,n._uninitializedComponentsProvider._online)):(D(ar,"Using default OnlineComponentProvider"),await rw(n,new zp))),n._onlineComponents}function JE(n){return Wp(n).then(e=>e.persistence)}function Kp(n){return Wp(n).then(e=>e.localStore)}function ZE(n){return eu(n).then(e=>e.remoteStore)}function $p(n){return eu(n).then(e=>e.syncEngine)}function MC(n){return eu(n).then(e=>e.datastore)}async function ss(n){let e=await eu(n),t=e.eventManager;return t.onListen=_C.bind(null,e.syncEngine),t.onUnlisten=vC.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=yC.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=wC.bind(null,e.syncEngine),t}function LC(n){return n.asyncQueue.enqueue(async()=>{let e=await JE(n),t=await ZE(n);return e.setNetworkEnabled(!0),(function(i){let s=L(i);return s.Ia.delete(0),ha(s)})(t)})}function UC(n){return n.asyncQueue.enqueue(async()=>{let e=await JE(n),t=await ZE(n);return e.setNetworkEnabled(!1),(async function(i){let s=L(i);s.Ia.add(0),await cs(s),s.Aa.set("Offline")})(t)})}function BC(n,e){let t=new Le;return n.asyncQueue.enqueueAndForget(async()=>(async function(i,s,o){try{let a=await(function(u,d){let p=L(u);return p.persistence.runTransaction("read document","readonly",g=>p.localDocuments.getDocument(g,d))})(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new x(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let c=ds(a,`Failed to get document '${s} from cache`);o.reject(c)}})(await Kp(n),e,t)),t.promise}function eT(n,e,t={}){let r=new Le;return n.asyncQueue.enqueueAndForget(async()=>(function(s,o,a,c,u){let d=new is({next:g=>{d.Ou(),o.enqueueAndForget(()=>Fp(s,p));let y=g.docs.has(a);!y&&g.fromCache?u.reject(new x(R.UNAVAILABLE,"Failed to get document because the client is offline.")):y&&g.fromCache&&c&&c.source==="server"?u.reject(new x(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(g)},error:g=>u.reject(g)}),p=new ta(ls(a.path),d,{includeMetadataChanges:!0,ka:!0});return Op(s,p)})(await ss(n),n.asyncQueue,e,t,r)),r.promise}function qC(n,e){let t=new Le;return n.asyncQueue.enqueueAndForget(async()=>(async function(i,s,o){try{let a=await Ec(i,s,!0),c=new Dc(s,a.qs),u=c.nu(a.documents),d=c.applyChanges(u,!1);o.resolve(d.snapshot)}catch(a){let c=ds(a,`Failed to execute query '${s} against cache`);o.reject(c)}})(await Kp(n),e,t)),t.promise}function tT(n,e,t={}){let r=new Le;return n.asyncQueue.enqueueAndForget(async()=>(function(s,o,a,c,u){let d=new is({next:g=>{d.Ou(),o.enqueueAndForget(()=>Fp(s,p)),g.fromCache&&c.source==="server"?u.reject(new x(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(g)},error:g=>u.reject(g)}),p=new ta(a,d,{includeMetadataChanges:!0,ka:!0});return Op(s,p)})(await ss(n),n.asyncQueue,e,t,r)),r.promise}function jC(n,e){let t=new is(e);return n.asyncQueue.enqueueAndForget(async()=>(function(i,s){L(i).Da.add(s),s.next()})(await ss(n),t)),()=>{t.Ou(),n.asyncQueue.enqueueAndForget(async()=>(function(i,s){L(i).Da.delete(s)})(await ss(n),t))}}function GC(n,e,t,r){let i=(function(o,a){let c;return c=typeof o=="string"?dp().encode(o):o,(function(d,p){return new Kf(d,p)})((function(d,p){if(d instanceof Uint8Array)return nw(d,p);if(d instanceof ArrayBuffer)return nw(new Uint8Array(d),p);if(d instanceof ReadableStream)return d.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(c),a)})(t,ua(e));n.asyncQueue.enqueueAndForget(async()=>{FC(await $p(n),i,r)})}function zC(n,e){return n.asyncQueue.enqueue(async()=>(function(r,i){let s=L(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Ti.getNamedQuery(o,i))})(await Kp(n),e))}function nT(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var iw=new Map;var rT="firestore.googleapis.com",sw=!0,Oc=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new x(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=rT,this.ssl=sw}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:sw;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=AE;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Xb)throw new x(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}pp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=nT((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new x(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new x(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new x(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},Qr=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Oc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new x(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new x(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Oc(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new id;switch(r.type){case"firstParty":return new ld(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new x(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){let r=iw.get(t);r&&(D("ComponentProvider","Removing Datastore"),iw.delete(t),r.terminate())})(this),Promise.resolve()}};function iT(n,e,t,r={}){var i;n=se(n,Qr);let s=vi(e),o=n._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),c=`${e}:${t}`;s&&(ml(`https://${c}`),yl("Firestore",!0)),o.host!==rT&&o.host!==c&&gt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let u=Object.assign(Object.assign({},o),{host:c,ssl:s,emulatorOptions:r});if(!wi(u,a)&&(n._setSettings(u),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=De.MOCK_USER;else{d=_l(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new x(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new De(g)}n._authCredentials=new sd(new zl(d,p))}}var Ke=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ue=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Yt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ia(t,n._jsonSchema))return new n(e,r||null,new M(re.fromString(t.referencePath)))}};ue._jsonSchemaVersion="firestore/documentReference/1.0",ue._jsonSchema={type:Ve("string",ue._jsonSchemaVersion),referencePath:Ve("string")};var Yt=class n extends Ke{constructor(e,t,r){super(e,t,ls(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ue(this.firestore,null,new M(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Qp(n,e,...t){if(n=te(n),fp("collection","path",e),n instanceof Qr){let r=re.fromString(e,...t);return Zy(r),new Yt(n,null,r)}{if(!(n instanceof ue||n instanceof Yt))throw new x(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(re.fromString(e,...t));return Zy(r),new Yt(n.firestore,null,r)}}function sT(n,e){if(n=se(n,Qr),fp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new x(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ke(n,null,(function(r){return new Ft(re.emptyPath(),r)})(e))}function da(n,e,...t){if(n=te(n),arguments.length===1&&(e=Do.newId()),fp("doc","path",e),n instanceof Qr){let r=re.fromString(e,...t);return Jy(r),new ue(n,null,new M(r))}{if(!(n instanceof ue||n instanceof Yt))throw new x(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(re.fromString(e,...t));return Jy(r),new ue(n.firestore,n instanceof Yt?n.converter:null,new M(r))}}function Hp(n,e){return n=te(n),e=te(e),(n instanceof ue||n instanceof Yt)&&(e instanceof ue||e instanceof Yt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Yp(n,e){return n=te(n),e=te(e),n instanceof Ke&&e instanceof Ke&&n.firestore===e.firestore&&la(n._query,e._query)&&n.converter===e.converter}var ow="AsyncQueue",Fc=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new ea(this,"async_queue_retry"),this.oc=()=>{let r=Gl();r&&D(ow,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=e;let t=Gl();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=Gl();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new Le;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}async cc(){if(this.Zu.length!==0){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!cr(e))throw e;D(ow,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(r=>{throw this.tc=r,this.nc=!1,be("INTERNAL UNHANDLED ERROR: ",aw(r)),r}).then(r=>(this.nc=!1,r))));return this._c=t,t}enqueueAfterDelay(e,t,r){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=Vf.createAndSchedule(this,e,t,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&U(47125,{hc:aw(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do e=this._c,await e;while(e!==this._c)}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function aw(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}function Yf(n){return(function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1})(n,["next","error","complete"])}var Xf=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Le,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var oT=-1,we=class extends Qr{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new Fc,this._persistenceKey=i?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new Fc(e),this._firestoreClient=void 0,await e}}};function $e(n){if(n._terminated)throw new x(R.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||aT(n),n._firestoreClient}function aT(n){var e,t,r;let i=n._freezeSettings(),s=(function(a,c,u,d){return new vd(a,c,u,d.host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,nT(d.experimentalLongPollingOptions),d.useFetchStreams,d.isUsingEmulator)})(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new Hf(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&(function(a){let c=a?._online.build();return{_offline:a?._offline.build(c),_online:c}})(n._componentsProvider))}function lT(n,e){gt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();return uT(n,zp.provider,{build:r=>new Vc(r,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}async function cT(n){gt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();uT(n,zp.provider,{build:t=>new Wf(t,e.cacheSizeBytes)})}function uT(n,e,t){if((n=se(n,we))._firestoreClient||n._terminated)throw new x(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new x(R.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:e,_offline:t},aT(n)}function hT(n){if(n._initialized&&!n._terminated)throw new x(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Le;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await(async function(r){if(!Jn.C())return Promise.resolve();let i=r+NE;await Jn.delete(i)})(Np(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function dT(n){return(function(t){let r=new Le;return t.asyncQueue.enqueueAndForget(async()=>SC(await $p(t),r)),r.promise})($e(n=se(n,we)))}function fT(n){return LC($e(n=se(n,we)))}function pT(n){return UC($e(n=se(n,we)))}function gT(n,e){let t=$e(n=se(n,we)),r=new Xf;return GC(t,n._databaseId,e,r),r}function mT(n,e){return zC($e(n=se(n,we)),e).then(t=>t?new Ke(n,null,t.query):null)}var Et=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Pe.fromBase64String(e))}catch(t){throw new x(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Pe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ia(e,n._jsonSchema))return n.fromBase64String(e.bytes)}};Et._jsonSchemaVersion="firestore/bytes/1.0",Et._jsonSchema={type:Ve("string",Et._jsonSchemaVersion),bytes:Ve("string")};var Ut=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new x(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ce(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var wn=class{constructor(e){this._methodName=e}};var Xt=class n{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new x(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new x(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return $(this._lat,e._lat)||$(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(e){if(ia(e,n._jsonSchema))return new n(e.latitude,e.longitude)}};Xt._jsonSchemaVersion="firestore/geoPoint/1.0",Xt._jsonSchema={type:Ve("string",Xt._jsonSchemaVersion),latitude:Ve("number"),longitude:Ve("number")};var Hn=class n{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,e._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ia(e,n._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new n(e.vectorValues);throw new x(R.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Hn._jsonSchemaVersion="firestore/vectorValue/1.0",Hn._jsonSchema={type:Ve("string",Hn._jsonSchemaVersion),vectorValues:Ve("object")};var WC=/^__.*__$/,Jf=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Lt(e,this.data,this.fieldMask,t,this.fieldTransforms):new ir(e,this.data,t,this.fieldTransforms)}},Mc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Lt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function _T(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U(40011,{Ec:n})}}var Lc=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.fc(e),i}gc(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Uc(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(_T(this.Ec)&&WC.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},Zf=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||ua(e)}Dc(e,t,r,i=!1){return new Lc({Ec:e,methodName:t,bc:r,path:Ce.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Xr(n){let e=n._freezeSettings(),t=ua(n._databaseId);return new Zf(n._databaseId,!!e.ignoreUndefinedProperties,t)}function tu(n,e,t,r,i,s={}){let o=n.Dc(s.merge||s.mergeFields?2:0,e,t,i);Zp("Data must be an object, but it was:",o,r);let a=wT(r,o),c,u;if(s.merge)c=new wt(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){let d=[];for(let p of s.mergeFields){let g=ip(e,p,t);if(!o.contains(g))throw new x(R.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);TT(d,g)||d.push(g)}c=new wt(d),u=o.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,u=o.fieldTransforms;return new Jf(new Ze(a),c,u)}var na=class n extends wn{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function yT(n,e,t){return new Lc({Ec:3,bc:e.settings.bc,methodName:n._methodName,mc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var ep=class n extends wn{_toFieldTransform(e){return new zr(e.path,new nr)}isEqual(e){return e instanceof n}},tp=class n extends wn{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=yT(this,e,!0),r=this.vc.map(s=>Jr(s,t)),i=new yn(r);return new zr(e.path,i)}isEqual(e){return e instanceof n&&wi(this.vc,e.vc)}},np=class n extends wn{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=yT(this,e,!0),r=this.vc.map(s=>Jr(s,t)),i=new vn(r);return new zr(e.path,i)}isEqual(e){return e instanceof n&&wi(this.vc,e.vc)}},rp=class n extends wn{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){let t=new rr(e.serializer,eE(e.serializer,this.Cc));return new zr(e.path,t)}isEqual(e){return e instanceof n&&this.Cc===e.Cc}};function Xp(n,e,t,r){let i=n.Dc(1,e,t);Zp("Data must be an object, but it was:",i,r);let s=[],o=Ze.empty();ur(r,(c,u)=>{let d=eg(e,c,t);u=te(u);let p=i.gc(d);if(u instanceof na)s.push(d);else{let g=Jr(u,p);g!=null&&(s.push(d),o.set(d,g))}});let a=new wt(s);return new Mc(o,a,i.fieldTransforms)}function Jp(n,e,t,r,i,s){let o=n.Dc(1,e,t),a=[ip(e,r,t)],c=[i];if(s.length%2!=0)throw new x(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)a.push(ip(e,s[g])),c.push(s[g+1]);let u=[],d=Ze.empty();for(let g=a.length-1;g>=0;--g)if(!TT(u,a[g])){let y=a[g],S=c[g];S=te(S);let N=o.gc(y);if(S instanceof na)u.push(y);else{let k=Jr(S,N);k!=null&&(u.push(y),d.set(y,k))}}let p=new wt(u);return new Mc(d,p,o.fieldTransforms)}function vT(n,e,t,r=!1){return Jr(t,n.Dc(r?4:3,e))}function Jr(n,e){if(ET(n=te(n)))return Zp("Unsupported field value:",e,n),wT(n,e);if(n instanceof wn)return(function(r,i){if(!_T(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return(function(r,i){let s=[],o=0;for(let a of r){let c=Jr(a,i.yc(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}})(n,e)}return(function(r,i){if((r=te(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return eE(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=pe.fromDate(r);return{timestampValue:Yi(i.serializer,s)}}if(r instanceof pe){let s=new pe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Yi(i.serializer,s)}}if(r instanceof Xt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Et)return{bytesValue:cE(i.serializer,r._byteString)};if(r instanceof ue){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.wc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Cp(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Hn)return(function(o,a){return{mapValue:{fields:{[Ep]:{stringValue:Tp},[Wi]:{arrayValue:{values:o.toArray().map(u=>{if(typeof u!="number")throw a.wc("VectorValues must only contain numeric values.");return bp(a.serializer,u)})}}}}}})(r,i);throw i.wc(`Unsupported field value: ${Wc(r)}`)})(n,e)}function wT(n,e){let t={};return kw(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ur(n,(r,i)=>{let s=Jr(i,e.Vc(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function ET(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof pe||n instanceof Xt||n instanceof Et||n instanceof ue||n instanceof wn||n instanceof Hn)}function Zp(n,e,t){if(!ET(t)||!pw(t)){let r=Wc(t);throw r==="an object"?e.wc(n+" a custom object"):e.wc(n+" "+r)}}function ip(n,e,t){if((e=te(e))instanceof Ut)return e._internalPath;if(typeof e=="string")return eg(n,e);throw Uc("Field path arguments must be of type string or ",n,!1,void 0,t)}var KC=new RegExp("[~\\*/\\[\\]]");function eg(n,e,t){if(e.search(KC)>=0)throw Uc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ut(...e.split("."))._internalPath}catch{throw Uc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Uc(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new x(R.INVALID_ARGUMENT,a+n+c)}function TT(n,e){return n.some(t=>t.isEqual(e))}var Hr=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new sp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(nu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},sp=class extends Hr{data(){return super.data()}};function nu(n,e){return typeof e=="string"?eg(n,e):e instanceof Ut?e._internalPath:e._delegate._internalPath}function IT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new x(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ra=class{},Yr=class extends ra{};function In(n,e,...t){let r=[];e instanceof ra&&r.push(e),r=r.concat(t),(function(s){let o=s.filter(c=>c instanceof op).length,a=s.filter(c=>c instanceof Bc).length;if(o>1||o>0&&a>0)throw new x(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let i of r)n=i._apply(n);return n}var Bc=class n extends Yr{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return DT(e._query,t),new Ke(e.firestore,e.converter,Dd(e._query,t))}_parse(e){let t=Xr(e.firestore);return(function(s,o,a,c,u,d,p){let g;if(u.isKeyField()){if(d==="array-contains"||d==="array-contains-any")throw new x(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${d}' queries on documentId().`);if(d==="in"||d==="not-in"){cw(p,d);let S=[];for(let N of p)S.push(lw(c,s,N));g={arrayValue:{values:S}}}else g=lw(c,s,p)}else d!=="in"&&d!=="not-in"&&d!=="array-contains-any"||cw(p,d),g=vT(a,o,p,d==="in"||d==="not-in");return ne.create(u,d,g)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function AT(n,e,t){let r=e,i=nu("where",n);return Bc._create(i,r,t)}var op=class n extends ra{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ce.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:((function(i,s){let o=i,a=s.getFlattenedFilters();for(let c of a)DT(o,c),o=Dd(o,c)})(e._query,t),new Ke(e.firestore,e.converter,Dd(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var ap=class n extends Yr{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=(function(i,s,o){if(i.startAt!==null)throw new x(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new x(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new jr(s,o)})(e._query,this._field,this._direction);return new Ke(e.firestore,e.converter,(function(i,s){let o=i.explicitOrderBy.concat([s]);return new Ft(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(e._query,t))}};function ST(n,e="asc"){let t=e,r=nu("orderBy",n);return ap._create(r,t)}var qc=class n extends Yr{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Ke(e.firestore,e.converter,ic(e._query,this._limit,this._limitType))}};function bT(n){return gw("limit",n),qc._create("limit",n,"F")}function CT(n){return gw("limitToLast",n),qc._create("limitToLast",n,"L")}var jc=class n extends Yr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=xT(e,this.type,this._docOrFields,this._inclusive);return new Ke(e.firestore,e.converter,(function(i,s){return new Ft(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)})(e._query,t))}};function RT(...n){return jc._create("startAt",n,!0)}function PT(...n){return jc._create("startAfter",n,!1)}var Gc=class n extends Yr{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=xT(e,this.type,this._docOrFields,this._inclusive);return new Ke(e.firestore,e.converter,(function(i,s){return new Ft(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)})(e._query,t))}};function NT(...n){return Gc._create("endBefore",n,!1)}function kT(...n){return Gc._create("endAt",n,!0)}function xT(n,e,t,r){if(t[0]=te(t[0]),t[0]instanceof Hr)return(function(s,o,a,c,u){if(!c)throw new x(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let d=[];for(let p of Fi(s))if(p.field.isKeyField())d.push(qr(o,c.key));else{let g=c.data.field(p.field);if(Hc(g))throw new x(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){let y=p.field.canonicalString();throw new x(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${y}' (used as the orderBy) does not exist.`)}d.push(g)}return new Zt(d,u)})(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Xr(n.firestore);return(function(o,a,c,u,d,p){let g=o.explicitOrderBy;if(d.length>g.length)throw new x(R.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let y=[];for(let S=0;S<d.length;S++){let N=d[S];if(g[S].field.isKeyField()){if(typeof N!="string")throw new x(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof N}`);if(!Ap(o)&&N.indexOf("/")!==-1)throw new x(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${N}' contains a slash.`);let k=o.path.child(re.fromString(N));if(!M.isDocumentKey(k))throw new x(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${k}' is not because it contains an odd number of segments.`);let q=new M(k);y.push(qr(a,q))}else{let k=vT(c,u,N);y.push(k)}}return new Zt(y,p)})(n._query,n.firestore._databaseId,i,e,t,r)}}function lw(n,e,t){if(typeof(t=te(t))=="string"){if(t==="")throw new x(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ap(e)&&t.indexOf("/")!==-1)throw new x(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(re.fromString(t));if(!M.isDocumentKey(r))throw new x(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return qr(n,new M(r))}if(t instanceof ue)return qr(n,t._key);throw new x(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Wc(t)}.`)}function cw(n,e){if(!Array.isArray(n)||n.length===0)throw new x(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function DT(n,e){let t=(function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new x(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var os=class{convertValue(e,t="none"){switch(er(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ye(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_n(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw U(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return ur(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertVectorValue(e){var t,r,i;let s=(i=(r=(t=e.fields)===null||t===void 0?void 0:t[Wi].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>ye(o.doubleValue));return new Hn(s)}convertGeoPoint(e){return new Xt(ye(e.latitude),ye(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Yc(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Bo(e));default:return null}}convertTimestamp(e){let t=mn(e);return new pe(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=re.fromString(e);j(wE(r),9688,{name:e});let i=new Zn(r.get(1),r.get(3)),s=new M(r.popFirst(5));return i.isEqual(t)||be(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function ru(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var lp=class extends os{constructor(e){super(),this.firestore=e}convertBytes(e){return new Et(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ue(this.firestore,null,t)}};var gn=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},ot=class n extends Hr{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Yn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(nu("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new x(R.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=n._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};ot._jsonSchemaVersion="firestore/documentSnapshot/1.0",ot._jsonSchema={type:Ve("string",ot._jsonSchemaVersion),bundleSource:Ve("string","DocumentSnapshot"),bundleName:Ve("string"),bundle:Ve("string")};var Yn=class extends ot{data(e={}){return super.data(e)}},pt=class n{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new gn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Yn(this._firestore,this._userDataWriter,r.key,r,new gn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new x(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let c=new Yn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new gn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let c=new Yn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new gn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),u=-1,d=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),d=o.indexOf(a.doc.key)),{type:$C(a.type),doc:c,oldIndex:u,newIndex:d}})}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new x(R.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=n._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Do.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function $C(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U(61501,{type:n})}}function tg(n,e){return n instanceof ot&&e instanceof ot?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof pt&&e instanceof pt&&n._firestore===e._firestore&&Yp(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function VT(n){n=se(n,ue);let e=se(n.firestore,we);return eT($e(e),n._key).then(t=>sg(e,n,t))}pt._jsonSchemaVersion="firestore/querySnapshot/1.0",pt._jsonSchema={type:Ve("string",pt._jsonSchemaVersion),bundleSource:Ve("string","QuerySnapshot"),bundleName:Ve("string"),bundle:Ve("string")};var En=class extends os{constructor(e){super(),this.firestore=e}convertBytes(e){return new Et(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ue(this.firestore,null,t)}};function OT(n){n=se(n,ue);let e=se(n.firestore,we),t=$e(e),r=new En(e);return BC(t,n._key).then(i=>new ot(e,r,n._key,i,new gn(i!==null&&i.hasLocalMutations,!0),n.converter))}function FT(n){n=se(n,ue);let e=se(n.firestore,we);return eT($e(e),n._key,{source:"server"}).then(t=>sg(e,n,t))}function MT(n){n=se(n,Ke);let e=se(n.firestore,we),t=$e(e),r=new En(e);return IT(n._query),tT(t,n._query).then(i=>new pt(e,r,n,i))}function LT(n){n=se(n,Ke);let e=se(n.firestore,we),t=$e(e),r=new En(e);return qC(t,n._query).then(i=>new pt(e,r,n,i))}function UT(n){n=se(n,Ke);let e=se(n.firestore,we),t=$e(e),r=new En(e);return tT(t,n._query,{source:"server"}).then(i=>new pt(e,r,n,i))}function ng(n,e,t){n=se(n,ue);let r=se(n.firestore,we),i=ru(n.converter,e,t);return fs(r,[tu(Xr(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ae.none())])}function rg(n,e,t,...r){n=se(n,ue);let i=se(n.firestore,we),s=Xr(i),o;return o=typeof(e=te(e))=="string"||e instanceof Ut?Jp(s,"updateDoc",n._key,e,t,r):Xp(s,"updateDoc",n._key,e),fs(i,[o.toMutation(n._key,Ae.exists(!0))])}function BT(n){return fs(se(n.firestore,we),[new sr(n._key,Ae.none())])}function qT(n,e){let t=se(n.firestore,we),r=da(n),i=ru(n.converter,e);return fs(t,[tu(Xr(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Ae.exists(!1))]).then(()=>r)}function ig(n,...e){var t,r,i;n=te(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||Yf(e[o])||(s=e[o++]);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Yf(e[o])){let p=e[o];e[o]=(t=p.next)===null||t===void 0?void 0:t.bind(p),e[o+1]=(r=p.error)===null||r===void 0?void 0:r.bind(p),e[o+2]=(i=p.complete)===null||i===void 0?void 0:i.bind(p)}let c,u,d;if(n instanceof ue)u=se(n.firestore,we),d=ls(n._key.path),c={next:p=>{e[o]&&e[o](sg(u,n,p))},error:e[o+1],complete:e[o+2]};else{let p=se(n,Ke);u=se(p.firestore,we),d=p._query;let g=new En(u);c={next:y=>{e[o]&&e[o](new pt(u,g,p,y))},error:e[o+1],complete:e[o+2]},IT(n._query)}return(function(g,y,S,N){let k=new is(N),q=new ta(y,k,S);return g.asyncQueue.enqueueAndForget(async()=>Op(await ss(g),q)),()=>{k.Ou(),g.asyncQueue.enqueueAndForget(async()=>Fp(await ss(g),q))}})($e(u),d,a,c)}function jT(n,e){return jC($e(n=se(n,we)),Yf(e)?e:{next:e})}function fs(n,e){return(function(r,i){let s=new Le;return r.asyncQueue.enqueueAndForget(async()=>EC(await $p(r),i,s)),s.promise})($e(n),e)}function sg(n,e,t){let r=t.docs.get(e._key),i=new En(n);return new ot(n,i,e._key,r,new gn(t.hasPendingWrites,t.fromCache),e.converter)}var QC={maxAttempts:5};var zc=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Xr(e)}set(e,t,r){this._verifyNotCommitted();let i=$n(e,this._firestore),s=ru(i.converter,t,r),o=tu(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Ae.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=$n(e,this._firestore),o;return o=typeof(t=te(t))=="string"||t instanceof Ut?Jp(this._dataReader,"WriteBatch.update",s._key,t,r,i):Xp(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Ae.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=$n(e,this._firestore);return this._mutations=this._mutations.concat(new sr(t._key,Ae.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function $n(n,e){if((n=te(n)).firestore!==e)throw new x(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var cp=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Xr(e)}get(e){let t=$n(e,this._firestore),r=new lp(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return U(24041);let s=i[0];if(s.isFoundDocument())return new Hr(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Hr(this._firestore,r,t._key,null,t.converter);throw U(18433,{doc:s})})}set(e,t,r){let i=$n(e,this._firestore),s=ru(i.converter,t,r),o=tu(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=$n(e,this._firestore),o;return o=typeof(t=te(t))=="string"||t instanceof Ut?Jp(this._dataReader,"Transaction.update",s._key,t,r,i):Xp(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=$n(e,this._firestore);return this._transaction.delete(t._key),this}};var up=class extends cp{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=$n(e,this._firestore),r=new En(this._firestore);return super.get(e).then(i=>new ot(this._firestore,r,t._key,i._document,new gn(!1,!1),t.converter))}};function GT(n,e,t){n=se(n,we);let r=Object.assign(Object.assign({},QC),t);return(function(s){if(s.maxAttempts<1)throw new x(R.INVALID_ARGUMENT,"Max attempts must be at least 1")})(r),(function(s,o,a){let c=new Le;return s.asyncQueue.enqueueAndForget(async()=>{let u=await MC(s);new Qf(s.asyncQueue,u,a,o,c).zu()}),c.promise})($e(n),i=>e(new up(n,i)),r)}function zT(){return new na("deleteField")}function WT(){return new ep("serverTimestamp")}function KT(...n){return new tp("arrayUnion",n)}function $T(...n){return new np("arrayRemove",n)}function QT(n){return new rp("increment",n)}(function(e,t=!0){(function(i){as=i})(Al),Cr(new _t("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new we(new od(r.getProvider("auth-internal")),new cd(o,r.getProvider("app-check-internal")),(function(u,d){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new x(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zn(u.options.projectId,d)})(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Dt(Qy,Hy,e),Dt(Qy,Hy,"esm2017")})();var HC="@firebase/firestore-compat",YC="0.3.53";function hg(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new x("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function HT(){if(typeof Uint8Array>"u")throw new x("unimplemented","Uint8Arrays are not available in this environment.")}function YT(){if(!xw())throw new x("unimplemented","Blobs are unavailable in Firestore in this environment.")}var iu=class n{constructor(e){this._delegate=e}static fromBase64String(e){return YT(),new n(Et.fromBase64String(e))}static fromUint8Array(e){return HT(),new n(Et.fromUint8Array(e))}toBase64(){return YT(),this._delegate.toBase64()}toUint8Array(){return HT(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function og(n){return XC(n,["next","error","complete"])}function XC(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var ag=class{enableIndexedDbPersistence(e,t){return lT(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return cT(e._delegate)}clearIndexedDbPersistence(e){return hT(e._delegate)}},su=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Zn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&gt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){iT(this._delegate,e,t,r)}enableNetwork(){return fT(this._delegate)}disableNetwork(){return pT(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,pp("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return dT(this._delegate)}onSnapshotsInSync(e){return jT(this._delegate,e)}get app(){if(!this._appCompat)throw new x("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ms(this,Qp(this._delegate,e))}catch(t){throw at(t,"collection()","Firestore.collection()")}}doc(e){try{return new en(this,da(this._delegate,e))}catch(t){throw at(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ni(this,sT(this._delegate,e))}catch(t){throw at(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return GT(this._delegate,t=>e(new ou(this,t)))}batch(){return $e(this._delegate),new au(new zc(this._delegate,e=>fs(this._delegate,e)))}loadBundle(e){return gT(this._delegate,e)}namedQuery(e){return mT(this._delegate,e).then(t=>t?new ni(this,t):null)}},ps=class extends os{constructor(e){super(),this.firestore=e}convertBytes(e){return new iu(new Et(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return en.forKey(t,this.firestore,null)}};function JC(n){uw(n)}var ou=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ps(e)}get(e){let t=Zr(e);return this._delegate.get(t).then(r=>new ei(this._firestore,new ot(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Zr(e);return r?(hg("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Zr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Zr(e);return this._delegate.delete(t),this}},au=class{constructor(e){this._delegate=e}set(e,t,r){let i=Zr(e);return r?(hg("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Zr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Zr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},gs=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Yn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ti(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new ps(e),t),i.set(t,s)),s}};gs.INSTANCES=new WeakMap;var en=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ps(e)}static forPath(e,t,r){if(e.length%2!==0)throw new x("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new ue(t._delegate,r,new M(e)))}static forKey(e,t,r){return new n(t,new ue(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new ms(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ms(this.firestore,Qp(this._delegate,e))}catch(t){throw at(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=te(e),e instanceof ue?Hp(this._delegate,e):!1}set(e,t){t=hg("DocumentReference.set",t);try{return t?ng(this._delegate,e,t):ng(this._delegate,e)}catch(r){throw at(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?rg(this._delegate,e):rg(this._delegate,e,t,...r)}catch(i){throw at(i,"updateDoc()","DocumentReference.update()")}}delete(){return BT(this._delegate)}onSnapshot(...e){let t=XT(e),r=JT(e,i=>new ei(this.firestore,new ot(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return ig(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=OT(this._delegate):e?.source==="server"?t=FT(this._delegate):t=VT(this._delegate),t.then(r=>new ei(this.firestore,new ot(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(gs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function at(n,e,t){return n.message=n.message.replace(e,t),n}function XT(n){for(let e of n)if(typeof e=="object"&&!og(e))return e;return{}}function JT(n,e){var t,r;let i;return og(n[0])?i=n[0]:og(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var ei=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new en(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return tg(this._delegate,e._delegate)}},ti=class extends ei{data(e){let t=this._delegate.data(e);return this._delegate._converter||dw(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},ni=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ps(e)}where(e,t,r){try{return new n(this.firestore,In(this._delegate,AT(e,t,r)))}catch(i){throw at(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,In(this._delegate,ST(e,t)))}catch(r){throw at(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,In(this._delegate,bT(e)))}catch(t){throw at(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,In(this._delegate,CT(e)))}catch(t){throw at(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,In(this._delegate,RT(...e)))}catch(t){throw at(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,In(this._delegate,PT(...e)))}catch(t){throw at(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,In(this._delegate,NT(...e)))}catch(t){throw at(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,In(this._delegate,kT(...e)))}catch(t){throw at(t,"endAt()","Query.endAt()")}}isEqual(e){return Yp(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=LT(this._delegate):e?.source==="server"?t=UT(this._delegate):t=MT(this._delegate),t.then(r=>new fa(this.firestore,new pt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=XT(e),r=JT(e,i=>new fa(this.firestore,new pt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return ig(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(gs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},lg=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ti(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},fa=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ni(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ti(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new lg(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new ti(this._firestore,r))})}isEqual(e){return tg(this._delegate,e._delegate)}},ms=class n extends ni{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new en(this.firestore,e):null}doc(e){try{return e===void 0?new en(this.firestore,da(this._delegate)):new en(this.firestore,da(this._delegate,e))}catch(t){throw at(t,"doc()","CollectionReference.doc()")}}add(e){return qT(this._delegate,e).then(t=>new en(this.firestore,t))}isEqual(e){return Hp(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(gs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Zr(n){return se(n,ue)}var cg=class n{constructor(...e){this._delegate=new Ut(...e)}static documentId(){return new n(Ce.keyField().canonicalString())}isEqual(e){return e=te(e),e instanceof Ut?this._delegate._internalPath.isEqual(e._internalPath):!1}};var ug=class n{static serverTimestamp(){let e=WT();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=zT();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=KT(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=$T(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=QT(e);return t._methodName="FieldValue.increment",new n(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}};var ZC={Firestore:su,GeoPoint:Xt,Timestamp:pe,Blob:iu,Transaction:ou,WriteBatch:au,DocumentReference:en,DocumentSnapshot:ei,Query:ni,QueryDocumentSnapshot:ti,QuerySnapshot:fa,CollectionReference:ms,FieldPath:cg,FieldValue:ug,setLogLevel:JC,CACHE_SIZE_UNLIMITED:oT};function eR(n,e){n.INTERNAL.registerComponent(new _t("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},ZC)))}function tR(n){eR(n,(e,t)=>new su(e,t,new ag)),n.registerVersion(HC,YC)}tR(Me);function nR(n,e=_i){return new Nn(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function ZT(n,e){return nR(n,e)}function rR(n,e){return ZT(n,e).pipe(fl(void 0),dl(),Ie(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function pg(n,e){return ZT(n,e).pipe(Ie(t=>({payload:t,type:"query"})))}var lu=class{ref;afs;injector=it(hn);constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=iI(r,t);return new uu(i,s,this.afs)}snapshotChanges(){return rR(this.ref,this.afs.schedulers.outsideAngular).pipe(Se(this.injector))}valueChanges(e={}){return this.snapshotChanges().pipe(Ie(({payload:t})=>e.idField?Zs(mi({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return kn(this.ref.get(e)).pipe(Se(this.injector))}};function cu(n,e){return pg(n,e).pipe(fl(void 0),dl(),Ie(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,c)=>{let u=s.find(p=>p.doc.ref.isEqual(a.ref)),d=r?.payload.docs.find(p=>p.ref.isEqual(a.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(a.metadata)||!u&&d&&JSON.stringify(d.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:a}})}),o}))}function eI(n,e,t){return cu(n,t).pipe(br((r,i)=>iR(r,i.map(s=>s.payload),e),[]),hl(),Ie(r=>r.map(i=>({type:i.type,payload:i}))))}function iR(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=sR(n,r))}),n}function dg(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function sR(n,e){switch(e.type){case"added":if(!n[e.newIndex]?.doc.ref.isEqual(e.doc.ref))return dg(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return dg(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]?.doc.ref.isEqual(e.doc.ref))return dg(n,e.oldIndex,1);break}return n}function tI(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var uu=class{ref;query;afs;injector=it(hn);constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=cu(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Ie(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(fl(void 0),dl(),no(([r,i])=>i.length>0||!r),Ie(([,r])=>r),Se(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(br((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=tI(e);return eI(this.query,t,this.afs.schedulers.outsideAngular).pipe(Se(this.injector))}valueChanges(e={}){return pg(this.query,this.afs.schedulers.outsideAngular).pipe(Ie(t=>t.payload.docs.map(r=>e.idField?Zs(mi({},r.data()),{[e.idField]:r.id}):r.data())),Se(this.injector))}get(e){return kn(this.query.get(e)).pipe(Se(this.injector))}add(e){return this.ref.add(e)}doc(e){return new lu(this.ref.doc(e),this.afs)}},fg=class{query;afs;injector=it(hn);constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?cu(this.query,this.afs.schedulers.outsideAngular).pipe(Se(this.injector)):cu(this.query,this.afs.schedulers.outsideAngular).pipe(Ie(t=>t.filter(r=>e.indexOf(r.type)>-1)),no(t=>t.length>0),Se(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(br((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=tI(e);return eI(this.query,t,this.afs.schedulers.outsideAngular).pipe(Se(this.injector))}valueChanges(e={}){return pg(this.query,this.afs.schedulers.outsideAngular).pipe(Ie(r=>r.payload.docs.map(i=>e.idField?mi({[e.idField]:i.id},i.data()):i.data())),Se(this.injector))}get(e){return kn(this.query.get(e)).pipe(Se(this.injector))}},nI=new Be("angularfire2.enableFirestorePersistence"),rI=new Be("angularfire2.firestore.persistenceSettings"),oR=new Be("angularfire2.firestore.settings"),aR=new Be("angularfire2.firestore.use-emulator");function iI(n,e=t=>t){return{query:e(n),ref:n}}var lR=(()=>{class n{schedulers;firestore;persistenceEnabled$;ngZone=it(We);constructor(t,r,i,s,o,a,c,u,d,p,g,y,S,N,k,q,B){this.schedulers=c;let O=Pr(t,a,r),z=d;p&&mo(O,a,g,S,N,k,y,q),[this.firestore,this.persistenceEnabled$]=Ei(`${O.name}.firestore`,"AngularFirestore",O.name,()=>{let Q=a.runOutsideAngular(()=>O.firestore());if(s&&Q.settings(s),z&&Q.useEmulator(...z),i&&!pl(o)){let H=()=>{try{return kn(Q.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(E){return typeof console<"u"&&console.warn(E),jt(!1)}};return[Q,a.runOutsideAngular(H)]}else return[Q,jt(!1)]},[s,z,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=iI(i,r),a=this.ngZone.run(()=>s);return new uu(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new fg(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.ngZone.run(()=>r);return new lu(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(K(Ln),K(Un,8),K(nI,8),K(oR,8),K(Vn),K(We),K(Rr),K(rI,8),K(aR,8),K(_o,8),K(co,8),K(uo,8),K(ho,8),K(fo,8),K(po,8),K(go,8),K(qn,8))};static \u0275prov=xn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Qx=(()=>{class n{constructor(){Me.registerVersion("angularfire",zt.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:nI,useValue:!0},{provide:rI,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=On({type:n});static \u0275inj=Dn({providers:[lR]})}return n})();var sI="@firebase/database",oI="1.0.20";var bm="";function Cm(n){bm=n}var Tg=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ne(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:wl(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var Ig=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return bt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var MI=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Tg(e)}}catch{}return new Ig},ii=MI("localStorage"),Ag=MI("sessionStorage");var ws=new Mn("@firebase/database"),LI=(function(){let n=1;return function(){return n++}})(),UI=function(n){let e=Ry(n),t=new Cy;t.update(e);let r=t.digest();return gl.encodeByteArray(r)},Ma=function(...n){let e="";for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=Ma.apply(null,r):typeof r=="object"?e+=Ne(r):e+=r,e+=" "}return e},si=null,aI=!0,BI=function(n,e){V(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(ws.logLevel=Ct.VERBOSE,si=ws.log.bind(ws),e&&Ag.set("logging_enabled",!0)):typeof n=="function"?si=n:(si=null,Ag.remove("logging_enabled"))},je=function(...n){if(aI===!0&&(aI=!1,si===null&&Ag.get("logging_enabled")===!0&&BI(!0)),si){let e=Ma.apply(null,n);si(e)}},La=function(n){return function(...e){je(n,...e)}},Sg=function(...n){let e="FIREBASE INTERNAL ERROR: "+Ma(...n);ws.error(e)},rn=function(...n){let e=`FIREBASE FATAL ERROR: ${Ma(...n)}`;throw ws.error(e),new Error(e)},tt=function(...n){let e="FIREBASE WARNING: "+Ma(...n);ws.warn(e)},cR=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&tt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Lu=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},uR=function(n){if(Gt()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},mr="[MIN_NAME]",An="[MAX_NAME]",ai=function(n,e){if(n===e)return 0;if(n===mr||e===An)return-1;if(e===mr||n===An)return 1;{let t=lI(n),r=lI(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},hR=function(n,e){return n===e?0:n<e?-1:1},pa=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ne(e))},Rm=function(n){if(typeof n!="object"||n===null)return Ne(n);let e=[];for(let r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=Ne(e[r]),t+=":",t+=Rm(n[e[r]]);return t+="}",t},qI=function(n,e){let t=n.length;if(t<=e)return[n];let r=[];for(let i=0;i<t;i+=e)i+e>t?r.push(n.substring(i,t)):r.push(n.substring(i,i+e));return r};function Ge(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var jI=function(n){V(!Lu(n),"Invalid JSON number");let e=11,t=52,r=(1<<e-1)-1,i,s,o,a,c;n===0?(s=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),r),s=a+r,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-r-t))));let u=[];for(c=t;c;c-=1)u.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(i?1:0),u.reverse();let d=u.join(""),p="";for(c=0;c<64;c+=8){let g=parseInt(d.substr(c,8),2).toString(16);g.length===1&&(g="0"+g),p=p+g}return p.toLowerCase()},dR=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},fR=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function pR(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let r=new Error(n+" at "+e._path.toString()+": "+t);return r.code=n.toUpperCase(),r}var gR=new RegExp("^-?(0*)\\d{1,10}$"),mR=-2147483648,_R=2147483647,lI=function(n){if(gR.test(n)){let e=Number(n);if(e>=mR&&e<=_R)return e}return null},Ps=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw tt("Exception was thrown by user callback.",t),e},Math.floor(0))}},yR=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ya=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var bg=class{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Il(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){tt(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Cg=class{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(je("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',tt(e)}},va=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),du="5",GI="v",zI="s",WI="r",KI="f",$I=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,QI="ls",HI="p",Rg="ac",YI="websocket",XI="long_polling";var fu=class{constructor(e,t,r,i,s=!1,o="",a=!1,c=!1,u=null){this.secure=t,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=u,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ii.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ii.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function vR(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function JI(n,e,t){V(typeof e=="string","typeof type must == string"),V(typeof t=="object","typeof params must == object");let r;if(e===YI)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===XI)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);vR(n)&&(t.ns=n.namespace);let i=[];return Ge(t,(s,o)=>{i.push(s+"="+o)}),r+i.join("&")}var Pg=class{constructor(){this.counters_={}}incrementCounter(e,t=1){bt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return wy(this.counters_)}};var gg={},mg={};function Pm(n){let e=n.toString();return gg[e]||(gg[e]=new Pg),gg[e]}function wR(n,e){let t=n.toString();return mg[t]||(mg[t]=e()),mg[t]}var Ng=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<r.length;++i)r[i]&&Ps(()=>{this.onMessage_(r[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var cI="start",ER="close",TR="pLPCommand",IR="pRTLPCB",ZI="id",eA="pw",tA="ser",AR="cb",SR="seg",bR="ts",CR="d",RR="dframe",nA=1870,rA=30,PR=nA-rA,NR=25e3,kR=3e4,Ia=class n{constructor(e,t,r,i,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=i,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=La(e),this.stats_=Pm(t),this.urlFn=c=>(this.appCheckToken&&(c[Rg]=this.appCheckToken),JI(t,XI,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ng(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(kR)),uR(()=>{if(this.isClosed_)return;this.scriptTagHolder=new kg((...s)=>{let[o,a,c,u,d]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===cI)this.id=a,this.password=c;else if(o===ER)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let r={};r[cI]="t",r[tA]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[AR]=this.scriptTagHolder.uniqueCallbackIdentifier),r[GI]=du,this.transportSessionId&&(r[zI]=this.transportSessionId),this.lastSessionId&&(r[QI]=this.lastSessionId),this.applicationId&&(r[HI]=this.applicationId),this.appCheckToken&&(r[Rg]=this.appCheckToken),typeof location<"u"&&location.hostname&&$I.test(location.hostname)&&(r[WI]=KI);let i=this.urlFn(r);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Gt()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!dR()&&!fR()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=Ne(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let r=vy(t),i=qI(r,PR);for(let s=0;s<i.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Gt())return;this.myDisconnFrame=document.createElement("iframe");let r={};r[RR]="t",r[ZI]=e,r[eA]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=Ne(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},kg=class n{constructor(e,t,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Gt())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=LI(),window[TR+this.uniqueCallbackIdentifier]=e,window[IR+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){je("frame writing exception"),a.stack&&je(a.stack),je(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||je("No IE domain setting required")}catch{let r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[ZI]=this.myID,e[eA]=this.myPW,e[tA]=this.currentSerial;let t=this.urlFn(e),r="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+rA+r.length<=nA;){let o=this.pendingSegs.shift();r=r+"&"+SR+i+"="+o.seg+"&"+bR+i+"="+o.ts+"&"+CR+i+"="+o.d,i++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(r,Math.floor(NR)),s=()=>{clearTimeout(i),r()};this.addTag(e,s)}addTag(e,t){Gt()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){let i=r.readyState;(!i||i==="loaded"||i==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{je("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}};var xR=16384,DR=45e3,pu=null;typeof MozWebSocket<"u"?pu=MozWebSocket:typeof WebSocket<"u"&&(pu=WebSocket);var ys=(()=>{class n{constructor(t,r,i,s,o,a,c){this.connId=t,this.applicationId=i,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=La(this.connId),this.stats_=Pm(r),this.connURL=n.connectionURL_(r,a,c,s,i),this.nodeAdmin=r.nodeAdmin}static connectionURL_(t,r,i,s,o){let a={};return a[GI]=du,!Gt()&&typeof location<"u"&&location.hostname&&$I.test(location.hostname)&&(a[WI]=KI),r&&(a[zI]=r),i&&(a[QI]=i),s&&(a[Rg]=s),o&&(a[HI]=o),JI(t,YI,a)}open(t,r){this.onDisconnect=r,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ii.set("previous_websocket_failure",!0);try{let i;if(Gt()){let s=this.nodeAdmin?"AdminNode":"Node";i={headers:{"User-Agent":`Firebase/${du}/${bm}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(i.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(i.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(i.proxy={origin:a})}this.mySock=new pu(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");let s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let r=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(r);i&&i.length>1&&parseFloat(i[1])<4.4&&(t=!0)}return!t&&pu!==null&&!n.forceDisallow_}static previouslyFailed(){return ii.isInMemoryStorage||ii.get("previous_websocket_failure")===!0}markConnectionHealthy(){ii.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let r=this.frames.join("");this.frames=null;let i=wl(r);this.onMessage(i)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(V(this.frames===null,"We already have a frame buffer"),t.length<=6){let r=Number(t);if(!isNaN(r))return this.handleNewFrameCount_(r),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let r=t.data;if(this.bytesReceived+=r.length,this.stats_.incrementCounter("bytes_received",r.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(r);else{let i=this.extractFrameCount_(r);i!==null&&this.appendFrame_(i)}}send(t){this.resetKeepAlive();let r=Ne(t);this.bytesSent+=r.length,this.stats_.incrementCounter("bytes_sent",r.length);let i=qI(r,xR);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(DR))}sendString_(t){try{this.mySock.send(t)}catch(r){this.log_("Exception thrown from WebSocket.send():",r.message||r.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),iA=(()=>{class n{static get ALL_TRANSPORTS(){return[Ia,ys]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){let r=ys&&ys.isAvailable(),i=r&&!ys.previouslyFailed();if(t.webSocketOnly&&(r||tt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[ys];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),VR=6e4,OR=5e3,FR=10*1024,MR=100*1024,_g="t",uI="d",LR="s",hI="r",UR="e",dI="o",fI="a",pI="n",gI="p",BR="h",xg=class{constructor(e,t,r,i,s,o,a,c,u,d){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=La("c:"+this.id+":"),this.transportManager_=new iA(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=ya(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>MR?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>FR?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(_g in e){let t=e[_g];t===fI?this.upgradeIfSecondaryHealthy_():t===hI?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===dI&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=pa("t",e),r=pa("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:gI,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:fI,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:pI,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=pa("t",e),r=pa("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=pa(_g,e);if(uI in e){let r=e[uI];if(t===BR){let i=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===pI){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===LR?this.onConnectionShutdown_(r):t===hI?this.onReset_(r):t===UR?Sg("Server Error: "+r):t===dI?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Sg("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,r=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),du!==r&&tt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),ya(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(VR))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ya(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(OR))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:gI,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ii.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var gu=class{put(e,t,r,i){}merge(e,t,r,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}};var mu=class{constructor(e){this.allowedEvents_=e,this.listeners_={},V(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let r=[...this.listeners_[e]];for(let i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});let i=this.getInitialEvent(e);i&&t.apply(r,i)}off(e,t,r){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let s=0;s<i.length;s++)if(i[s].callback===t&&(!r||r===i[s].context)){i.splice(s,1);return}}validateEventType_(e){V(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var _u=class n extends mu{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!kh()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return V(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var mI=32,_I=768,le=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function ae(){return new le("")}function J(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function _r(n){return n.pieces_.length-n.pieceNum_}function fe(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new le(n.pieces_,e)}function Nm(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function qR(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Aa(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function sA(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new le(e,0)}function ve(n,e){let t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof le)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{let r=e.split("/");for(let i=0;i<r.length;i++)r[i].length>0&&t.push(r[i])}return new le(t,0)}function Z(n){return n.pieceNum_>=n.pieces_.length}function lt(n,e){let t=J(n),r=J(e);if(t===null)return e;if(t===r)return lt(fe(n),fe(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function jR(n,e){let t=Aa(n,0),r=Aa(e,0);for(let i=0;i<t.length&&i<r.length;i++){let s=ai(t[i],r[i]);if(s!==0)return s}return t.length===r.length?0:t.length<r.length?-1:1}function km(n,e){if(_r(n)!==_r(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Pt(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(_r(n)>_r(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}var Dg=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Aa(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=oo(this.parts_[r]);oA(this)}};function GR(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=oo(e),oA(n)}function zR(n){let e=n.parts_.pop();n.byteLength_-=oo(e),n.parts_.length>0&&(n.byteLength_-=1)}function oA(n){if(n.byteLength_>_I)throw new Error(n.errorPrefix_+"has a key path longer than "+_I+" bytes ("+n.byteLength_+").");if(n.parts_.length>mI)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+mI+") or object contains a cycle "+ri(n))}function ri(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Vg=class n extends mu{static getInstance(){return new n}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return V(e==="visible","Unknown event type: "+e),[this.visible_]}};var ga=1e3,WR=300*1e3,yI=30*1e3,KR=1.3,$R=3e4,QR="server_kill",vI=3,xm=(()=>{class n extends gu{constructor(t,r,i,s,o,a,c,u){if(super(),this.repoInfo_=t,this.applicationId_=r,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=n.nextPersistentConnectionId_++,this.log_=La("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ga,this.maxReconnectDelay_=WR,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u&&!Gt())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Vg.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&_u.getInstance().on("online",this.onOnline_,this)}sendRequest(t,r,i){let s=++this.requestNumber_,o={r:s,a:t,b:r};this.log_(Ne(o)),V(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),i&&(this.requestCBHash_[s]=i)}get(t){this.initConnection_();let r=new qe,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?r.resolve(c):r.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),r.promise}listen(t,r,i,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),V(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),V(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:s,hashFn:r,query:t,tag:i};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let r=this.outstandingGets_[t];this.sendRequest("g",r.request,i=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),r.onComplete&&r.onComplete(i)})}sendListen_(t){let r=t.query,i=r._path.toString(),s=r._queryIdentifier;this.log_("Listen on "+i+" for "+s);let o={p:i},a="q";t.tag&&(o.q=r._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let u=c.d,d=c.s;n.warnOnListenWarnings_(u,r),(this.listens.get(i)&&this.listens.get(i).get(s))===t&&(this.log_("listen response",c),d!=="ok"&&this.removeListen_(i,s),t.onComplete&&t.onComplete(d,u))})}static warnOnListenWarnings_(t,r){if(t&&typeof t=="object"&&bt(t,"w")){let i=Fn(t,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){let s='".indexOn": "'+r._queryParams.getIndex().toString()+'"',o=r._path.toString();tt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||Sy(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=yI)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,r=Ay(t)?"auth":"gauth",i={cred:t};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(r,i,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let r=t.s,i=t.d||"error";r==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(r,i)})}unlisten(t,r){let i=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),V(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,t._queryObject,r)}sendUnlisten_(t,r,i,s){this.log_("Unlisten on "+t+" for "+r);let o={p:t},a="n";s&&(o.q=i,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:r,onComplete:i})}onDisconnectMerge(t,r,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,r,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:r,onComplete:i})}onDisconnectCancel(t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:r})}sendOnDisconnect_(t,r,i,s){let o={p:r,d:i};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,r,i,s){this.putInternal("p",t,r,i,s)}merge(t,r,i,s){this.putInternal("m",t,r,i,s)}putInternal(t,r,i,s,o){this.initConnection_();let a={p:r,d:i};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+r)}sendPut_(t){let r=this.outstandingPuts_[t].action,i=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(r,i,o=>{this.log_(r+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let r={c:t};this.log_("reportStats",r),this.sendRequest("s",r,i=>{if(i.s!=="ok"){let o=i.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+Ne(t));let r=t.r,i=this.requestCBHash_[r];i&&(delete this.requestCBHash_[r],i(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,r){this.log_("handleServerMessage",t,r),t==="d"?this.onDataUpdate_(r.p,r.d,!1,r.t):t==="m"?this.onDataUpdate_(r.p,r.d,!0,r.t):t==="c"?this.onListenRevoked_(r.p,r.q):t==="ac"?this.onAuthRevoked_(r.s,r.d):t==="apc"?this.onAppCheckRevoked_(r.s,r.d):t==="sd"?this.onSecurityDebugPacket_(r):Sg("Unrecognized action received from server: "+Ne(t)+`
Are you using the latest client?`)}onReady_(t,r){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=r,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){V(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ga,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=ga,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>$R&&(this.reconnectDelay_=ga),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),r=Math.max(0,this.reconnectDelay_-t);r=Math.random()*r,this.log_("Trying to reconnect in "+r+"ms"),this.scheduleConnect_(r),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*KR)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,u=function(){c?c.close():(a=!0,i())},d=function(g){V(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(g)};this.realtime_={close:u,sendRequest:d};let p=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[g,y]=await Promise.all([this.authTokenProvider_.getToken(p),this.appCheckTokenProvider_.getToken(p)]);a?je("getToken() completed but was canceled"):(je("getToken() completed. Creating connection."),this.authToken_=g&&g.accessToken,this.appCheckToken_=y&&y.token,c=new xg(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,r,i,S=>{tt(S+" ("+this.repoInfo_.toString()+")"),this.interrupt(QR)},o))}catch(g){this.log_("Failed to get token: "+g),a||(this.repoInfo_.nodeAdmin&&tt(g),u())}}}interrupt(t){je("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){je("Resuming connection for reason: "+t),delete this.interruptReasons_[t],El(this.interruptReasons_)&&(this.reconnectDelay_=ga,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let r=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:r})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let r=this.outstandingPuts_[t];r&&"h"in r.request&&r.queued&&(r.onComplete&&r.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,r){let i;r?i=r.map(o=>Rm(o)).join("$"):i="default";let s=this.removeListen_(t,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,r){let i=new le(t).toString(),s;if(this.listens.has(i)){let o=this.listens.get(i);s=o.get(r),o.delete(r),o.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(t,r){je("Auth token revoked: "+t+"/"+r),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=vI&&(this.reconnectDelay_=yI,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,r){je("App check token revoked: "+t+"/"+r),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=vI&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let r of t.values())this.sendListen_(r);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},r="js";Gt()&&(this.repoInfo_.nodeAdmin?r="admin_node":r="node"),t["sdk."+r+"."+bm.replace(/\./g,"-")]=1,kh()?t["framework.cordova"]=1:Ey()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=_u.getInstance().currentlyOnline();return El(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),ee=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Es=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let r=new ee(mr,e),i=new ee(mr,t);return this.compare(r,i)!==0}minPost(){return ee.MIN}};var hu,yu=class extends Es{static get __EMPTY_NODE(){return hu}static set __EMPTY_NODE(e){hu=e}compare(e,t){return ai(e.name,t.name)}isDefinedOn(e){throw yi("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return ee.MIN}maxPost(){return new ee(An,hu)}makePost(e,t){return V(typeof e=="string","KeyIndex indexValue must always be a string."),new ee(e,hu)}toString(){return".key"}},nn=new yu;var vs=class{constructor(e,t,r,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?r(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},Bt=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??Nt.EMPTY_NODE,this.right=o??Nt.EMPTY_NODE}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return Nt.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,r){let i,s;if(i=this,r(t,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(t,r),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),r(t,i.key)===0){if(i.right.isEmpty())return Nt.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(t,r))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Og=class{copy(e,t,r,i,s){return this}insert(e,t,r){return new Bt(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},Nt=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Bt.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Bt.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,i=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return i?i.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(i=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new vs(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new vs(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new vs(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new vs(this.root_,null,this.comparator_,!0,e)}};Nt.EMPTY_NODE=new Og;function HR(n,e){return ai(n.name,e.name)}function Dm(n,e){return ai(n,e)}var Fg;function YR(n){Fg=n}var aA=function(n){return typeof n=="number"?"number:"+jI(n):"string:"+n},lA=function(n){if(n.isLeafNode()){let e=n.val();V(typeof e=="string"||typeof e=="number"||typeof e=="object"&&bt(e,".sv"),"Priority must be a string or number.")}else V(n===Fg||n.isEmpty(),"priority of unexpected type.");V(n===Fg||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var wI,Ts=(()=>{class n{static set __childrenNodeConstructor(t){wI=t}static get __childrenNodeConstructor(){return wI}constructor(t,r=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=r,this.lazyHash_=null,V(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),lA(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return Z(t)?this:J(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,r){return null}updateImmediateChild(t,r){return t===".priority"?this.updatePriority(r):r.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,r).updatePriority(this.priorityNode_)}updateChild(t,r){let i=J(t);return i===null?r:r.isEmpty()&&i!==".priority"?this:(V(i!==".priority"||_r(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(fe(t),r)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,r){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+aA(this.priorityNode_.val())+":");let r=typeof this.value_;t+=r+":",r==="number"?t+=jI(this.value_):t+=this.value_,this.lazyHash_=UI(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(V(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let r=typeof t.value_,i=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(r),o=n.VALUE_TYPE_ORDER.indexOf(i);return V(s>=0,"Unknown leaf type: "+r),V(o>=0,"Unknown leaf type: "+i),s===o?i==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let r=t;return this.value_===r.value_&&this.priorityNode_.equals(r.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),cA,uA;function XR(n){cA=n}function JR(n){uA=n}var Mg=class extends Es{compare(e,t){let r=e.node.getPriority(),i=t.node.getPriority(),s=r.compareTo(i);return s===0?ai(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return ee.MIN}maxPost(){return new ee(An,new Ts("[PRIORITY-POST]",uA))}makePost(e,t){let r=cA(e);return new ee(t,new Ts("[PRIORITY-POST]",r))}toString(){return".priority"}},ge=new Mg;var ZR=Math.log(2),Lg=class{constructor(e){let t=s=>parseInt(Math.log(s)/ZR,10),r=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let i=r(this.count);this.bits_=e+1&i}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},vu=function(n,e,t,r){n.sort(e);let i=function(c,u){let d=u-c,p,g;if(d===0)return null;if(d===1)return p=n[c],g=t?t(p):p,new Bt(g,p.node,Bt.BLACK,null,null);{let y=parseInt(d/2,10)+c,S=i(c,y),N=i(y+1,u);return p=n[y],g=t?t(p):p,new Bt(g,p.node,Bt.BLACK,S,N)}},s=function(c){let u=null,d=null,p=n.length,g=function(S,N){let k=p-S,q=p;p-=S;let B=i(k+1,q),O=n[k],z=t?t(O):O;y(new Bt(z,O.node,N,null,B))},y=function(S){u?(u.left=S,u=S):(d=S,u=S)};for(let S=0;S<c.count;++S){let N=c.nextBitIsOne(),k=Math.pow(2,c.count-(S+1));N?g(k,Bt.BLACK):(g(k,Bt.BLACK),g(k,Bt.RED))}return d},o=new Lg(n.length),a=s(o);return new Nt(r||e,a)};var yg,_s={},Is=class n{static get Default(){return V(_s&&ge,"ChildrenNode.ts has not been loaded"),yg=yg||new n({".priority":_s},{".priority":ge}),yg}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=Fn(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Nt?t:null}hasIndex(e){return bt(this.indexSet_,e.toString())}addIndex(e,t){V(e!==nn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(ee.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();let a;i?a=vu(r,e.getCompare()):a=_s;let c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;let d=Object.assign({},this.indexes_);return d[c]=a,new n(d,u)}addToIndexes(e,t){let r=so(this.indexes_,(i,s)=>{let o=Fn(this.indexSet_,s);if(V(o,"Missing index implementation for "+s),i===_s)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(ee.Wrap),u=c.getNext();for(;u;)u.name!==e.name&&a.push(u),u=c.getNext();return a.push(e),vu(a,o.getCompare())}else return _s;else{let a=t.get(e.name),c=i;return a&&(c=c.remove(new ee(e.name,a))),c.insert(e,e.node)}});return new n(r,this.indexSet_)}removeFromIndexes(e,t){let r=so(this.indexes_,i=>{if(i===_s)return i;{let s=t.get(e.name);return s?i.remove(new ee(e.name,s)):i}});return new n(r,this.indexSet_)}};var ma,Y=(()=>{class n{static get EMPTY_NODE(){return ma||(ma=new n(new Nt(Dm),null,Is.Default))}constructor(t,r,i){this.children_=t,this.priorityNode_=r,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&lA(this.priorityNode_),this.children_.isEmpty()&&V(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ma}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let r=this.children_.get(t);return r===null?ma:r}}getChild(t){let r=J(t);return r===null?this:this.getImmediateChild(r).getChild(fe(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,r){if(V(r,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(r);{let i=new ee(t,r),s,o;r.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(t,r),o=this.indexMap_.addToIndexes(i,this.children_));let a=s.isEmpty()?ma:this.priorityNode_;return new n(s,a,o)}}updateChild(t,r){let i=J(t);if(i===null)return r;{V(J(t)!==".priority"||_r(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(i).updateChild(fe(t),r);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let r={},i=0,s=0,o=!0;if(this.forEachChild(ge,(a,c)=>{r[a]=c.val(t),i++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*i){let a=[];for(let c in r)a[c]=r[c];return a}else return t&&!this.getPriority().isEmpty()&&(r[".priority"]=this.getPriority().val()),r}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+aA(this.getPriority().val())+":"),this.forEachChild(ge,(r,i)=>{let s=i.hash();s!==""&&(t+=":"+r+":"+s)}),this.lazyHash_=t===""?"":UI(t)}return this.lazyHash_}getPredecessorChildName(t,r,i){let s=this.resolveIndex_(i);if(s){let o=s.getPredecessorKey(new ee(t,r));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(t){let r=this.getFirstChildName(t);return r?new ee(r,this.children_.get(r)):null}getLastChildName(t){let r=this.resolveIndex_(t);if(r){let i=r.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(t){let r=this.getLastChildName(t);return r?new ee(r,this.children_.get(r)):null}forEachChild(t,r){let i=this.resolveIndex_(t);return i?i.inorderTraversal(s=>r(s.name,s.node)):this.children_.inorderTraversal(r)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,ee.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,r){let i=this.resolveIndex_(r);if(i)return i.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,ee.Wrap),o=s.peek();for(;o!=null&&r.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===Ua?-1:0}withIndex(t){if(t===nn||this.indexMap_.hasIndex(t))return this;{let r=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,r)}}isIndexed(t){return t===nn||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let r=t;if(this.getPriority().equals(r.getPriority()))if(this.children_.count()===r.children_.count()){let i=this.getIterator(ge),s=r.getIterator(ge),o=i.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=i.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===nn?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Ug=class extends Y{constructor(){super(new Nt(Dm),Y.EMPTY_NODE,Is.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Y.EMPTY_NODE}isEmpty(){return!1}},Ua=new Ug;Object.defineProperties(ee,{MIN:{value:new ee(mr,Y.EMPTY_NODE)},MAX:{value:new ee(An,Ua)}});yu.__EMPTY_NODE=Y.EMPTY_NODE;Ts.__childrenNodeConstructor=Y;YR(Ua);JR(Ua);var eP=!0;function Ee(n,e=null){if(n===null)return Y.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),V(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Ts(t,Ee(e))}if(!(n instanceof Array)&&eP){let t=[],r=!1;if(Ge(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=Ee(a);c.isEmpty()||(r=r||!c.getPriority().isEmpty(),t.push(new ee(o,c)))}}),t.length===0)return Y.EMPTY_NODE;let s=vu(t,HR,o=>o.name,Dm);if(r){let o=vu(t,ge.getCompare());return new Y(s,Ee(e),new Is({".priority":o},{".priority":ge}))}else return new Y(s,Ee(e),Is.Default)}else{let t=Y.EMPTY_NODE;return Ge(n,(r,i)=>{if(bt(n,r)&&r.substring(0,1)!=="."){let s=Ee(i);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(r,s))}}),t.updatePriority(Ee(e))}}XR(Ee);var Sa=class extends Es{constructor(e){super(),this.indexPath_=e,V(!Z(e)&&J(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let r=this.extractChild(e.node),i=this.extractChild(t.node),s=r.compareTo(i);return s===0?ai(e.name,t.name):s}makePost(e,t){let r=Ee(e),i=Y.EMPTY_NODE.updateChild(this.indexPath_,r);return new ee(t,i)}maxPost(){let e=Y.EMPTY_NODE.updateChild(this.indexPath_,Ua);return new ee(An,e)}toString(){return Aa(this.indexPath_,0).join("/")}};var Bg=class extends Es{compare(e,t){let r=e.node.compareTo(t.node);return r===0?ai(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return ee.MIN}maxPost(){return ee.MAX}makePost(e,t){let r=Ee(e);return new ee(t,r)}toString(){return".value"}},Vm=new Bg;function hA(n){return{type:"value",snapshotNode:n}}function As(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ba(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ca(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function tP(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Ra=class{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){V(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()||(o!=null&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(ba(t,a)):V(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(As(t,r)):o.trackChildChange(Ca(t,r,a))),e.isLeafNode()&&r.isEmpty())?e:e.updateImmediateChild(t,r).withIndex(this.index_)}updateFullNode(e,t,r){return r!=null&&(e.isLeafNode()||e.forEachChild(ge,(i,s)=>{t.hasChild(i)||r.trackChildChange(ba(i,s))}),t.isLeafNode()||t.forEachChild(ge,(i,s)=>{if(e.hasChild(i)){let o=e.getImmediateChild(i);o.equals(s)||r.trackChildChange(Ca(i,s,o))}else r.trackChildChange(As(i,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Y.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var wu=class n{constructor(e){this.indexedFilter_=new Ra(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,r=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&r}updateChild(e,t,r,i,s,o){return this.matches(new ee(t,r))||(r=Y.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,r,i,s,o)}updateFullNode(e,t,r){t.isLeafNode()&&(t=Y.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(Y.EMPTY_NODE);let s=this;return t.forEachChild(ge,(o,a)=>{s.matches(new ee(o,a))||(i=i.updateImmediateChild(o,Y.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var qg=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let r=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?r<=0:r<0},this.withinEndPost=t=>{let r=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?r<=0:r<0},this.rangedFilter_=new wu(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,r,i,s,o){return this.rangedFilter_.matches(new ee(t,r))||(r=Y.EMPTY_NODE),e.getImmediateChild(t).equals(r)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,r,i,s,o):this.fullLimitUpdateChild_(e,t,r,s,o)}updateFullNode(e,t,r){let i;if(t.isLeafNode()||t.isEmpty())i=Y.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=Y.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(Y.EMPTY_NODE);let s;this.reverse_?s=i.getReverseIterator(this.index_):s=i.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,Y.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,r)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){let p=this.index_.getCompare();o=(g,y)=>p(y,g)}else o=this.index_.getCompare();let a=e;V(a.numChildren()===this.limit_,"");let c=new ee(t,r),u=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(t)){let p=a.getImmediateChild(t),g=i.getChildAfterChild(this.index_,u,this.reverse_);for(;g!=null&&(g.name===t||a.hasChild(g.name));)g=i.getChildAfterChild(this.index_,g,this.reverse_);let y=g==null?1:o(g,c);if(d&&!r.isEmpty()&&y>=0)return s?.trackChildChange(Ca(t,r,p)),a.updateImmediateChild(t,r);{s?.trackChildChange(ba(t,p));let N=a.updateImmediateChild(t,Y.EMPTY_NODE);return g!=null&&this.rangedFilter_.matches(g)?(s?.trackChildChange(As(g.name,g.node)),N.updateImmediateChild(g.name,g.node)):N}}else return r.isEmpty()?e:d&&o(u,c)>=0?(s!=null&&(s.trackChildChange(ba(u.name,u.node)),s.trackChildChange(As(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(u.name,Y.EMPTY_NODE)):e}};var Pa=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ge}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return V(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return V(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:mr}hasEnd(){return this.endSet_}getIndexEndValue(){return V(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return V(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:An}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return V(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ge}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function nP(n){return n.loadsAllData()?new Ra(n.getIndex()):n.hasLimit()?new qg(n):new wu(n)}function rP(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function iP(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function jg(n,e,t){let r=n.copy();return r.startSet_=!0,e===void 0&&(e=null),r.indexStartValue_=e,t!=null?(r.startNameSet_=!0,r.indexStartName_=t):(r.startNameSet_=!1,r.indexStartName_=""),r}function sP(n,e,t){let r;return n.index_===nn||t?r=jg(n,e,t):r=jg(n,e,An),r.startAfterSet_=!0,r}function Gg(n,e,t){let r=n.copy();return r.endSet_=!0,e===void 0&&(e=null),r.indexEndValue_=e,t!==void 0?(r.endNameSet_=!0,r.indexEndName_=t):(r.endNameSet_=!1,r.indexEndName_=""),r}function oP(n,e,t){let r;return n.index_===nn||t?r=Gg(n,e,t):r=Gg(n,e,mr),r.endBeforeSet_=!0,r}function Uu(n,e){let t=n.copy();return t.index_=e,t}function EI(n){let e={};if(n.isDefault())return e;let t;if(n.index_===ge?t="$priority":n.index_===Vm?t="$value":n.index_===nn?t="$key":(V(n.index_ instanceof Sa,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ne(t),n.startSet_){let r=n.startAfterSet_?"startAfter":"startAt";e[r]=Ne(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+Ne(n.indexStartName_))}if(n.endSet_){let r=n.endBeforeSet_?"endBefore":"endAt";e[r]=Ne(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+Ne(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function TI(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==ge&&(e.i=n.index_.toString()),e}var zg=class n extends gu{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(V(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=i,this.log_=La("p:rest:"),this.listens_={}}listen(e,t,r,i){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,r),a={};this.listens_[o]=a;let c=EI(e._queryParams);this.restRequest_(s+".json",c,(u,d)=>{let p=d;if(u===404&&(p=null,u=null),u===null&&this.onDataUpdate_(s,p,!1,r),Fn(this.listens_,o)===a){let g;u?u===401?g="permission_denied":g="rest_error:"+u:g="ok",i(g,null)}})}unlisten(e,t){let r=n.getListenId_(e,t);delete this.listens_[r]}get(e){let t=EI(e._queryParams),r=e._path.toString(),i=new qe;return this.restRequest_(r+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+by(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(r&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=wl(a.responseText)}catch{tt("Failed to parse JSON response for "+o+": "+a.responseText)}r(null,c)}else a.status!==401&&a.status!==404&&tt("Got unsuccessful REST response for "+o+" Status: "+a.status),r(a.status);r=null}},a.open("GET",o,!0),a.send()})}};var Wg=class{constructor(){this.rootNode_=Y.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Eu(){return{value:null,children:new Map}}function Ns(n,e,t){if(Z(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let r=J(e);n.children.has(r)||n.children.set(r,Eu());let i=n.children.get(r);e=fe(e),Ns(i,e,t)}}function Kg(n,e){if(Z(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(ge,(r,i)=>{Ns(n,new le(r),i)}),Kg(n,e)}}else if(n.children.size>0){let t=J(e);return e=fe(e),n.children.has(t)&&Kg(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function $g(n,e,t){n.value!==null?t(e,n.value):aP(n,(r,i)=>{let s=new le(e.toString()+"/"+r);$g(i,s,t)})}function aP(n,e){n.children.forEach((t,r)=>{e(r,t)})}var Qg=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ge(this.last_,(r,i)=>{t[r]=t[r]-i}),this.last_=e,t}};var II=10*1e3,lP=30*1e3,cP=300*1e3,Hg=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Qg(e);let r=II+(lP-II)*Math.random();ya(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){let e=this.statsListener_.get(),t={},r=!1;Ge(e,(i,s)=>{s>0&&bt(this.statsToReport_,i)&&(t[i]=s,r=!0)}),r&&this.server_.reportStats(t),ya(this.reportStats_.bind(this),Math.floor(Math.random()*2*cP))}};var tn=(function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n})(tn||{});function Om(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Fm(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Mm(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Yg=class n{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=tn.ACK_USER_WRITE,this.source=Om()}operationForChild(e){if(Z(this.path)){if(this.affectedTree.value!=null)return V(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new le(e));return new n(ae(),t,this.revert)}}else return V(J(this.path)===e,"operationForChild called for unrelated child."),new n(fe(this.path),this.affectedTree,this.revert)}};var Tu=class n{constructor(e,t){this.source=e,this.path=t,this.type=tn.LISTEN_COMPLETE}operationForChild(e){return Z(this.path)?new n(this.source,ae()):new n(this.source,fe(this.path))}};var Ss=class n{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=tn.OVERWRITE}operationForChild(e){return Z(this.path)?new n(this.source,ae(),this.snap.getImmediateChild(e)):new n(this.source,fe(this.path),this.snap)}};var Na=class n{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=tn.MERGE}operationForChild(e){if(Z(this.path)){let t=this.children.subtree(new le(e));return t.isEmpty()?null:t.value?new Ss(this.source,ae(),t.value):new n(this.source,ae(),t)}else return V(J(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,fe(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var sn=class{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Z(e))return this.isFullyInitialized()&&!this.filtered_;let t=J(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Xg=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function uP(n,e,t,r){let i=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(tP(o.childName,o.snapshotNode))}),_a(n,i,"child_removed",e,r,t),_a(n,i,"child_added",e,r,t),_a(n,i,"child_moved",s,r,t),_a(n,i,"child_changed",e,r,t),_a(n,i,"value",e,r,t),i}function _a(n,e,t,r,i,s){let o=r.filter(a=>a.type===t);o.sort((a,c)=>dP(n,a,c)),o.forEach(a=>{let c=hP(n,a,s);i.forEach(u=>{u.respondsTo(a.type)&&e.push(u.createEvent(c,n.query_))})})}function hP(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function dP(n,e,t){if(e.childName==null||t.childName==null)throw yi("Should only compare child_ events.");let r=new ee(e.childName,e.snapshotNode),i=new ee(t.childName,t.snapshotNode);return n.index_.compare(r,i)}function Bu(n,e){return{eventCache:n,serverCache:e}}function wa(n,e,t,r){return Bu(new sn(e,t,r),n.serverCache)}function dA(n,e,t,r){return Bu(n.eventCache,new sn(e,t,r))}function Iu(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function oi(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var vg,fP=()=>(vg||(vg=new Nt(hR)),vg),ct=class n{static fromObject(e){let t=new n(null);return Ge(e,(r,i)=>{t=t.set(new le(r),i)}),t}constructor(e,t=fP()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:ae(),value:this.value};if(Z(e))return null;{let r=J(e),i=this.children.get(r);if(i!==null){let s=i.findRootMostMatchingPathAndValue(fe(e),t);return s!=null?{path:ve(new le(r),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Z(e))return this;{let t=J(e),r=this.children.get(t);return r!==null?r.subtree(fe(e)):new n(null)}}set(e,t){if(Z(e))return new n(t,this.children);{let r=J(e),s=(this.children.get(r)||new n(null)).set(fe(e),t),o=this.children.insert(r,s);return new n(this.value,o)}}remove(e){if(Z(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=J(e),r=this.children.get(t);if(r){let i=r.remove(fe(e)),s;return i.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,i),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(Z(e))return this.value;{let t=J(e),r=this.children.get(t);return r?r.get(fe(e)):null}}setTree(e,t){if(Z(e))return t;{let r=J(e),s=(this.children.get(r)||new n(null)).setTree(fe(e),t),o;return s.isEmpty()?o=this.children.remove(r):o=this.children.insert(r,s),new n(this.value,o)}}fold(e){return this.fold_(ae(),e)}fold_(e,t){let r={};return this.children.inorderTraversal((i,s)=>{r[i]=s.fold_(ve(e,i),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,ae(),t)}findOnPath_(e,t,r){let i=this.value?r(t,this.value):!1;if(i)return i;if(Z(e))return null;{let s=J(e),o=this.children.get(s);return o?o.findOnPath_(fe(e),ve(t,s),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,ae(),t)}foreachOnPath_(e,t,r){if(Z(e))return this;{this.value&&r(t,this.value);let i=J(e),s=this.children.get(i);return s?s.foreachOnPath_(fe(e),ve(t,i),r):new n(null)}}foreach(e){this.foreach_(ae(),e)}foreach_(e,t){this.children.inorderTraversal((r,i)=>{i.foreach_(ve(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}};var qt=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new ct(null))}};function Ea(n,e,t){if(Z(e))return new qt(new ct(t));{let r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){let i=r.path,s=r.value,o=lt(i,e);return s=s.updateChild(o,t),new qt(n.writeTree_.set(i,s))}else{let i=new ct(t),s=n.writeTree_.setTree(e,i);return new qt(s)}}}function Jg(n,e,t){let r=n;return Ge(t,(i,s)=>{r=Ea(r,ve(e,i),s)}),r}function AI(n,e){if(Z(e))return qt.empty();{let t=n.writeTree_.setTree(e,new ct(null));return new qt(t)}}function Zg(n,e){return li(n,e)!=null}function li(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(lt(t.path,e)):null}function SI(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ge,(r,i)=>{e.push(new ee(r,i))}):n.writeTree_.children.inorderTraversal((r,i)=>{i.value!=null&&e.push(new ee(r,i.value))}),e}function pr(n,e){if(Z(e))return n;{let t=li(n,e);return t!=null?new qt(new ct(t)):new qt(n.writeTree_.subtree(e))}}function em(n){return n.writeTree_.isEmpty()}function bs(n,e){return fA(ae(),n.writeTree_,e)}function fA(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((i,s)=>{i===".priority"?(V(s.value!==null,"Priority writes must always be leaf nodes"),r=s.value):t=fA(ve(n,i),s,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(ve(n,".priority"),r)),t}}function qu(n,e){return _A(e,n)}function pP(n,e,t,r,i){V(r>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:i}),i&&(n.visibleWrites=Ea(n.visibleWrites,e,t)),n.lastWriteId=r}function gP(n,e,t,r){V(r>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:r,visible:!0}),n.visibleWrites=Jg(n.visibleWrites,e,t),n.lastWriteId=r}function mP(n,e){for(let t=0;t<n.allWrites.length;t++){let r=n.allWrites[t];if(r.writeId===e)return r}return null}function _P(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);V(t>=0,"removeWrite called with nonexistent writeId.");let r=n.allWrites[t];n.allWrites.splice(t,1);let i=r.visible,s=!1,o=n.allWrites.length-1;for(;i&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&yP(a,r.path)?i=!1:Pt(r.path,a.path)&&(s=!0)),o--}if(i){if(s)return vP(n),!0;if(r.snap)n.visibleWrites=AI(n.visibleWrites,r.path);else{let a=r.children;Ge(a,c=>{n.visibleWrites=AI(n.visibleWrites,ve(r.path,c))})}return!0}else return!1}function yP(n,e){if(n.snap)return Pt(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Pt(ve(n.path,t),e))return!0;return!1}function vP(n){n.visibleWrites=pA(n.allWrites,wP,ae()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function wP(n){return n.visible}function pA(n,e,t){let r=qt.empty();for(let i=0;i<n.length;++i){let s=n[i];if(e(s)){let o=s.path,a;if(s.snap)Pt(t,o)?(a=lt(t,o),r=Ea(r,a,s.snap)):Pt(o,t)&&(a=lt(o,t),r=Ea(r,ae(),s.snap.getChild(a)));else if(s.children){if(Pt(t,o))a=lt(t,o),r=Jg(r,a,s.children);else if(Pt(o,t))if(a=lt(o,t),Z(a))r=Jg(r,ae(),s.children);else{let c=Fn(s.children,J(a));if(c){let u=c.getChild(fe(a));r=Ea(r,ae(),u)}}}else throw yi("WriteRecord should have .snap or .children")}}return r}function gA(n,e,t,r,i){if(!r&&!i){let s=li(n.visibleWrites,e);if(s!=null)return s;{let o=pr(n.visibleWrites,e);if(em(o))return t;if(t==null&&!Zg(o,ae()))return null;{let a=t||Y.EMPTY_NODE;return bs(o,a)}}}else{let s=pr(n.visibleWrites,e);if(!i&&em(s))return t;if(!i&&t==null&&!Zg(s,ae()))return null;{let o=function(u){return(u.visible||i)&&(!r||!~r.indexOf(u.writeId))&&(Pt(u.path,e)||Pt(e,u.path))},a=pA(n.allWrites,o,e),c=t||Y.EMPTY_NODE;return bs(a,c)}}}function EP(n,e,t){let r=Y.EMPTY_NODE,i=li(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(ge,(s,o)=>{r=r.updateImmediateChild(s,o)}),r;if(t){let s=pr(n.visibleWrites,e);return t.forEachChild(ge,(o,a)=>{let c=bs(pr(s,new le(o)),a);r=r.updateImmediateChild(o,c)}),SI(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}else{let s=pr(n.visibleWrites,e);return SI(s).forEach(o=>{r=r.updateImmediateChild(o.name,o.node)}),r}}function TP(n,e,t,r,i){V(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=ve(e,t);if(Zg(n.visibleWrites,s))return null;{let o=pr(n.visibleWrites,s);return em(o)?i.getChild(t):bs(o,i.getChild(t))}}function IP(n,e,t,r){let i=ve(e,t),s=li(n.visibleWrites,i);if(s!=null)return s;if(r.isCompleteForChild(t)){let o=pr(n.visibleWrites,i);return bs(o,r.getNode().getImmediateChild(t))}else return null}function AP(n,e){return li(n.visibleWrites,e)}function SP(n,e,t,r,i,s,o){let a,c=pr(n.visibleWrites,e),u=li(c,ae());if(u!=null)a=u;else if(t!=null)a=bs(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let d=[],p=o.getCompare(),g=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),y=g.getNext();for(;y&&d.length<i;)p(y,r)!==0&&d.push(y),y=g.getNext();return d}else return[]}function bP(){return{visibleWrites:qt.empty(),allWrites:[],lastWriteId:-1}}function Au(n,e,t,r){return gA(n.writeTree,n.treePath,e,t,r)}function Lm(n,e){return EP(n.writeTree,n.treePath,e)}function bI(n,e,t,r){return TP(n.writeTree,n.treePath,e,t,r)}function Su(n,e){return AP(n.writeTree,ve(n.treePath,e))}function CP(n,e,t,r,i,s){return SP(n.writeTree,n.treePath,e,t,r,i,s)}function Um(n,e,t){return IP(n.writeTree,n.treePath,e,t)}function mA(n,e){return _A(ve(n.treePath,e),n.writeTree)}function _A(n,e){return{treePath:n,writeTree:e}}var tm=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,r=e.childName;V(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),V(r!==".priority","Only non-priority child changes can be tracked.");let i=this.changeMap.get(r);if(i){let s=i.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(r,Ca(r,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(r,ba(r,i.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(r,As(r,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(r,Ca(r,e.snapshotNode,i.oldSnap));else throw yi("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}};var nm=class{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}},yA=new nm,ka=class{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let r=this.optCompleteServerCache_!=null?new sn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Um(this.writes_,e,r)}}getChildAfterChild(e,t,r){let i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:oi(this.viewCache_),s=CP(this.writes_,i,t,1,r,e);return s.length===0?null:s[0]}};function RP(n){return{filter:n}}function PP(n,e){V(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),V(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function NP(n,e,t,r,i){let s=new tm,o,a;if(t.type===tn.OVERWRITE){let u=t;u.source.fromUser?o=rm(n,e,u.path,u.snap,r,i,s):(V(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered()&&!Z(u.path),o=bu(n,e,u.path,u.snap,r,i,a,s))}else if(t.type===tn.MERGE){let u=t;u.source.fromUser?o=xP(n,e,u.path,u.children,r,i,s):(V(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),o=im(n,e,u.path,u.children,r,i,a,s))}else if(t.type===tn.ACK_USER_WRITE){let u=t;u.revert?o=OP(n,e,u.path,r,i,s):o=DP(n,e,u.path,u.affectedTree,r,i,s)}else if(t.type===tn.LISTEN_COMPLETE)o=VP(n,e,t.path,r,s);else throw yi("Unknown operation type: "+t.type);let c=s.getChanges();return kP(e,o,c),{viewCache:o,changes:c}}function kP(n,e,t){let r=e.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Iu(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&t.push(hA(Iu(e)))}}function vA(n,e,t,r,i,s){let o=e.eventCache;if(Su(r,t)!=null)return e;{let a,c;if(Z(t))if(V(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let u=oi(e),d=u instanceof Y?u:Y.EMPTY_NODE,p=Lm(r,d);a=n.filter.updateFullNode(e.eventCache.getNode(),p,s)}else{let u=Au(r,oi(e));a=n.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{let u=J(t);if(u===".priority"){V(_r(t)===1,"Can't have a priority with additional path components");let d=o.getNode();c=e.serverCache.getNode();let p=bI(r,t,d,c);p!=null?a=n.filter.updatePriority(d,p):a=o.getNode()}else{let d=fe(t),p;if(o.isCompleteForChild(u)){c=e.serverCache.getNode();let g=bI(r,t,o.getNode(),c);g!=null?p=o.getNode().getImmediateChild(u).updateChild(d,g):p=o.getNode().getImmediateChild(u)}else p=Um(r,u,e.serverCache);p!=null?a=n.filter.updateChild(o.getNode(),u,p,d,i,s):a=o.getNode()}}return wa(e,a,o.isFullyInitialized()||Z(t),n.filter.filtersNodes())}}function bu(n,e,t,r,i,s,o,a){let c=e.serverCache,u,d=o?n.filter:n.filter.getIndexedFilter();if(Z(t))u=d.updateFullNode(c.getNode(),r,null);else if(d.filtersNodes()&&!c.isFiltered()){let y=c.getNode().updateChild(t,r);u=d.updateFullNode(c.getNode(),y,null)}else{let y=J(t);if(!c.isCompleteForPath(t)&&_r(t)>1)return e;let S=fe(t),k=c.getNode().getImmediateChild(y).updateChild(S,r);y===".priority"?u=d.updatePriority(c.getNode(),k):u=d.updateChild(c.getNode(),y,k,S,yA,null)}let p=dA(e,u,c.isFullyInitialized()||Z(t),d.filtersNodes()),g=new ka(i,p,s);return vA(n,p,t,i,g,a)}function rm(n,e,t,r,i,s,o){let a=e.eventCache,c,u,d=new ka(i,e,s);if(Z(t))u=n.filter.updateFullNode(e.eventCache.getNode(),r,o),c=wa(e,u,!0,n.filter.filtersNodes());else{let p=J(t);if(p===".priority")u=n.filter.updatePriority(e.eventCache.getNode(),r),c=wa(e,u,a.isFullyInitialized(),a.isFiltered());else{let g=fe(t),y=a.getNode().getImmediateChild(p),S;if(Z(g))S=r;else{let N=d.getCompleteChild(p);N!=null?Nm(g)===".priority"&&N.getChild(sA(g)).isEmpty()?S=N:S=N.updateChild(g,r):S=Y.EMPTY_NODE}if(y.equals(S))c=e;else{let N=n.filter.updateChild(a.getNode(),p,S,g,d,o);c=wa(e,N,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function CI(n,e){return n.eventCache.isCompleteForChild(e)}function xP(n,e,t,r,i,s,o){let a=e;return r.foreach((c,u)=>{let d=ve(t,c);CI(e,J(d))&&(a=rm(n,a,d,u,i,s,o))}),r.foreach((c,u)=>{let d=ve(t,c);CI(e,J(d))||(a=rm(n,a,d,u,i,s,o))}),a}function RI(n,e,t){return t.foreach((r,i)=>{e=e.updateChild(r,i)}),e}function im(n,e,t,r,i,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,u;Z(t)?u=r:u=new ct(null).setTree(t,r);let d=e.serverCache.getNode();return u.children.inorderTraversal((p,g)=>{if(d.hasChild(p)){let y=e.serverCache.getNode().getImmediateChild(p),S=RI(n,y,g);c=bu(n,c,new le(p),S,i,s,o,a)}}),u.children.inorderTraversal((p,g)=>{let y=!e.serverCache.isCompleteForChild(p)&&g.value===null;if(!d.hasChild(p)&&!y){let S=e.serverCache.getNode().getImmediateChild(p),N=RI(n,S,g);c=bu(n,c,new le(p),N,i,s,o,a)}}),c}function DP(n,e,t,r,i,s,o){if(Su(i,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(r.value!=null){if(Z(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return bu(n,e,t,c.getNode().getChild(t),i,s,a,o);if(Z(t)){let u=new ct(null);return c.getNode().forEachChild(nn,(d,p)=>{u=u.set(new le(d),p)}),im(n,e,t,u,i,s,a,o)}else return e}else{let u=new ct(null);return r.foreach((d,p)=>{let g=ve(t,d);c.isCompleteForPath(g)&&(u=u.set(d,c.getNode().getChild(g)))}),im(n,e,t,u,i,s,a,o)}}function VP(n,e,t,r,i){let s=e.serverCache,o=dA(e,s.getNode(),s.isFullyInitialized()||Z(t),s.isFiltered());return vA(n,o,t,r,yA,i)}function OP(n,e,t,r,i,s){let o;if(Su(r,t)!=null)return e;{let a=new ka(r,e,i),c=e.eventCache.getNode(),u;if(Z(t)||J(t)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Au(r,oi(e));else{let p=e.serverCache.getNode();V(p instanceof Y,"serverChildren would be complete if leaf node"),d=Lm(r,p)}d=d,u=n.filter.updateFullNode(c,d,s)}else{let d=J(t),p=Um(r,d,e.serverCache);p==null&&e.serverCache.isCompleteForChild(d)&&(p=c.getImmediateChild(d)),p!=null?u=n.filter.updateChild(c,d,p,fe(t),a,s):e.eventCache.getNode().hasChild(d)?u=n.filter.updateChild(c,d,Y.EMPTY_NODE,fe(t),a,s):u=c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Au(r,oi(e)),o.isLeafNode()&&(u=n.filter.updateFullNode(u,o,s)))}return o=e.serverCache.isFullyInitialized()||Su(r,ae())!=null,wa(e,u,o,n.filter.filtersNodes())}}var sm=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let r=this.query_._queryParams,i=new Ra(r.getIndex()),s=nP(r);this.processor_=RP(s);let o=t.serverCache,a=t.eventCache,c=i.updateFullNode(Y.EMPTY_NODE,o.getNode(),null),u=s.updateFullNode(Y.EMPTY_NODE,a.getNode(),null),d=new sn(c,o.isFullyInitialized(),i.filtersNodes()),p=new sn(u,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Bu(p,d),this.eventGenerator_=new Xg(this.query_)}get query(){return this.query_}};function FP(n){return n.viewCache_.serverCache.getNode()}function MP(n){return Iu(n.viewCache_)}function LP(n,e){let t=oi(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Z(e)&&!t.getImmediateChild(J(e)).isEmpty())?t.getChild(e):null}function PI(n){return n.eventRegistrations_.length===0}function UP(n,e){n.eventRegistrations_.push(e)}function NI(n,e,t){let r=[];if(t){V(e==null,"A cancel should cancel all event registrations.");let i=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,i);o&&r.push(o)})}if(e){let i=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return r}function kI(n,e,t,r){e.type===tn.MERGE&&e.source.queryId!==null&&(V(oi(n.viewCache_),"We should always have a full cache before handling merges"),V(Iu(n.viewCache_),"Missing event cache, even though we have a server cache"));let i=n.viewCache_,s=NP(n.processor_,i,e,t,r);return PP(n.processor_,s.viewCache),V(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,wA(n,s.changes,s.viewCache.eventCache.getNode(),null)}function BP(n,e){let t=n.viewCache_.eventCache,r=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ge,(s,o)=>{r.push(As(s,o))}),t.isFullyInitialized()&&r.push(hA(t.getNode())),wA(n,r,t.getNode(),e)}function wA(n,e,t,r){let i=r?[r]:n.eventRegistrations_;return uP(n.eventGenerator_,e,t,i)}var Cu,Ru=class{constructor(){this.views=new Map}};function qP(n){V(!Cu,"__referenceConstructor has already been defined"),Cu=n}function jP(){return V(Cu,"Reference.ts has not been loaded"),Cu}function GP(n){return n.views.size===0}function Bm(n,e,t,r){let i=e.source.queryId;if(i!==null){let s=n.views.get(i);return V(s!=null,"SyncTree gave us an op for an invalid query."),kI(s,e,t,r)}else{let s=[];for(let o of n.views.values())s=s.concat(kI(o,e,t,r));return s}}function EA(n,e,t,r,i){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Au(t,i?r:null),c=!1;a?c=!0:r instanceof Y?(a=Lm(t,r),c=!1):(a=Y.EMPTY_NODE,c=!1);let u=Bu(new sn(a,c,!1),new sn(r,i,!1));return new sm(e,u)}return o}function zP(n,e,t,r,i,s){let o=EA(n,e,r,i,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),UP(o,t),BP(o,t)}function WP(n,e,t,r){let i=e._queryIdentifier,s=[],o=[],a=yr(n);if(i==="default")for(let[c,u]of n.views.entries())o=o.concat(NI(u,t,r)),PI(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||s.push(u.query));else{let c=n.views.get(i);c&&(o=o.concat(NI(c,t,r)),PI(c)&&(n.views.delete(i),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!yr(n)&&s.push(new(jP())(e._repo,e._path)),{removed:s,events:o}}function TA(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function gr(n,e){let t=null;for(let r of n.views.values())t=t||LP(r,e);return t}function IA(n,e){if(e._queryParams.loadsAllData())return ju(n);{let r=e._queryIdentifier;return n.views.get(r)}}function AA(n,e){return IA(n,e)!=null}function yr(n){return ju(n)!=null}function ju(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var Pu;function KP(n){V(!Pu,"__referenceConstructor has already been defined"),Pu=n}function $P(){return V(Pu,"Reference.ts has not been loaded"),Pu}var QP=1,Nu=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ct(null),this.pendingWriteTree_=bP(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function qm(n,e,t,r,i){return pP(n.pendingWriteTree_,e,t,r,i),i?ks(n,new Ss(Om(),e,t)):[]}function HP(n,e,t,r){gP(n.pendingWriteTree_,e,t,r);let i=ct.fromObject(t);return ks(n,new Na(Om(),e,i))}function fr(n,e,t=!1){let r=mP(n.pendingWriteTree_,e);if(_P(n.pendingWriteTree_,e)){let s=new ct(null);return r.snap!=null?s=s.set(ae(),!0):Ge(r.children,o=>{s=s.set(new le(o),!0)}),ks(n,new Yg(r.path,s,t))}else return[]}function Ba(n,e,t){return ks(n,new Ss(Fm(),e,t))}function YP(n,e,t){let r=ct.fromObject(t);return ks(n,new Na(Fm(),e,r))}function XP(n,e){return ks(n,new Tu(Fm(),e))}function JP(n,e,t){let r=jm(n,t);if(r){let i=Gm(r),s=i.path,o=i.queryId,a=lt(s,e),c=new Tu(Mm(o),a);return zm(n,s,c)}else return[]}function ku(n,e,t,r,i=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||AA(o,e))){let c=WP(o,e,t,r);GP(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let u=c.removed;if(a=c.events,!i){let d=u.findIndex(g=>g._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(s,(g,y)=>yr(y));if(d&&!p){let g=n.syncPointTree_.subtree(s);if(!g.isEmpty()){let y=tN(g);for(let S=0;S<y.length;++S){let N=y[S],k=N.query,q=RA(n,N);n.listenProvider_.startListening(Ta(k),xa(n,k),q.hashFn,q.onComplete)}}}!p&&u.length>0&&!r&&(d?n.listenProvider_.stopListening(Ta(e),null):u.forEach(g=>{let y=n.queryToTagMap.get(zu(g));n.listenProvider_.stopListening(Ta(g),y)}))}nN(n,u)}return a}function SA(n,e,t,r){let i=jm(n,r);if(i!=null){let s=Gm(i),o=s.path,a=s.queryId,c=lt(o,e),u=new Ss(Mm(a),c,t);return zm(n,o,u)}else return[]}function ZP(n,e,t,r){let i=jm(n,r);if(i){let s=Gm(i),o=s.path,a=s.queryId,c=lt(o,e),u=ct.fromObject(t),d=new Na(Mm(a),c,u);return zm(n,o,d)}else return[]}function om(n,e,t,r=!1){let i=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(i,(g,y)=>{let S=lt(g,i);s=s||gr(y,S),o=o||yr(y)});let a=n.syncPointTree_.get(i);a?(o=o||yr(a),s=s||gr(a,ae())):(a=new Ru,n.syncPointTree_=n.syncPointTree_.set(i,a));let c;s!=null?c=!0:(c=!1,s=Y.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((y,S)=>{let N=gr(S,ae());N&&(s=s.updateImmediateChild(y,N))}));let u=AA(a,e);if(!u&&!e._queryParams.loadsAllData()){let g=zu(e);V(!n.queryToTagMap.has(g),"View does not exist, but we have a tag");let y=rN();n.queryToTagMap.set(g,y),n.tagToQueryMap.set(y,g)}let d=qu(n.pendingWriteTree_,i),p=zP(a,e,t,d,s,c);if(!u&&!o&&!r){let g=IA(a,e);p=p.concat(iN(n,e,g))}return p}function Gu(n,e,t){let i=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=lt(o,e),u=gr(a,c);if(u)return u});return gA(i,e,s,t,!0)}function eN(n,e){let t=e._path,r=null;n.syncPointTree_.foreachOnPath(t,(u,d)=>{let p=lt(u,t);r=r||gr(d,p)});let i=n.syncPointTree_.get(t);i?r=r||gr(i,ae()):(i=new Ru,n.syncPointTree_=n.syncPointTree_.set(t,i));let s=r!=null,o=s?new sn(r,!0,!1):null,a=qu(n.pendingWriteTree_,e._path),c=EA(i,e,a,s?o.getNode():Y.EMPTY_NODE,s);return MP(c)}function ks(n,e){return bA(e,n.syncPointTree_,null,qu(n.pendingWriteTree_,ae()))}function bA(n,e,t,r){if(Z(n.path))return CA(n,e,t,r);{let i=e.get(ae());t==null&&i!=null&&(t=gr(i,ae()));let s=[],o=J(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let u=t?t.getImmediateChild(o):null,d=mA(r,o);s=s.concat(bA(a,c,u,d))}return i&&(s=s.concat(Bm(i,n,r,t))),s}}function CA(n,e,t,r){let i=e.get(ae());t==null&&i!=null&&(t=gr(i,ae()));let s=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,u=mA(r,o),d=n.operationForChild(o);d&&(s=s.concat(CA(d,a,c,u)))}),i&&(s=s.concat(Bm(i,n,r,t))),s}function RA(n,e){let t=e.query,r=xa(n,t);return{hashFn:()=>(FP(e)||Y.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return r?JP(n,t._path,r):XP(n,t._path);{let s=pR(i,t);return ku(n,t,null,s)}}}}function xa(n,e){let t=zu(e);return n.queryToTagMap.get(t)}function zu(n){return n._path.toString()+"$"+n._queryIdentifier}function jm(n,e){return n.tagToQueryMap.get(e)}function Gm(n){let e=n.indexOf("$");return V(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new le(n.substr(0,e))}}function zm(n,e,t){let r=n.syncPointTree_.get(e);V(r,"Missing sync point for query tag that we're tracking");let i=qu(n.pendingWriteTree_,e);return Bm(r,t,i,null)}function tN(n){return n.fold((e,t,r)=>{if(t&&yr(t))return[ju(t)];{let i=[];return t&&(i=TA(t)),Ge(r,(s,o)=>{i=i.concat(o)}),i}})}function Ta(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new($P())(n._repo,n._path):n}function nN(n,e){for(let t=0;t<e.length;++t){let r=e[t];if(!r._queryParams.loadsAllData()){let i=zu(r),s=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(s)}}}function rN(){return QP++}function iN(n,e,t){let r=e._path,i=xa(n,e),s=RA(n,t),o=n.listenProvider_.startListening(Ta(e),i,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(r);if(i)V(!yr(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((u,d,p)=>{if(!Z(u)&&d&&yr(d))return[ju(d).query];{let g=[];return d&&(g=g.concat(TA(d).map(y=>y.query))),Ge(p,(y,S)=>{g=g.concat(S)}),g}});for(let u=0;u<c.length;++u){let d=c[u];n.listenProvider_.stopListening(Ta(d),xa(n,d))}}return o}var am=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},lm=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=ve(this.path_,e);return new n(this.syncTree_,t)}node(){return Gu(this.syncTree_,this.path_)}},sN=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},xI=function(n,e,t){if(!n||typeof n!="object")return n;if(V(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return oN(n[".sv"],e,t);if(typeof n[".sv"]=="object")return aN(n[".sv"],e);V(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},oN=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:V(!1,"Unexpected server value: "+n)}},aN=function(n,e,t){n.hasOwnProperty("increment")||V(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let r=n.increment;typeof r!="number"&&V(!1,"Unexpected increment value: "+r);let i=e.node();if(V(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let o=i.getValue();return typeof o!="number"?r:o+r},PA=function(n,e,t,r){return Km(e,new lm(t,n),r)},Wm=function(n,e,t){return Km(n,new am(e),t)};function Km(n,e,t){let r=n.getPriority().val(),i=xI(r,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=xI(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new Ts(a,Ee(i)):n}else{let o=n;return s=o,i!==o.getPriority().val()&&(s=s.updatePriority(new Ts(i))),o.forEachChild(ge,(a,c)=>{let u=Km(c,e.getImmediateChild(a),t);u!==c&&(s=s.updateImmediateChild(a,u))}),s}}var Da=class{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}};function Wu(n,e){let t=e instanceof le?e:new le(e),r=n,i=J(t);for(;i!==null;){let s=Fn(r.node.children,i)||{children:{},childCount:0};r=new Da(i,r,s),t=fe(t),i=J(t)}return r}function ci(n){return n.node.value}function $m(n,e){n.node.value=e,cm(n)}function NA(n){return n.node.childCount>0}function lN(n){return ci(n)===void 0&&!NA(n)}function Ku(n,e){Ge(n.node.children,(t,r)=>{e(new Da(t,n,r))})}function kA(n,e,t,r){t&&!r&&e(n),Ku(n,i=>{kA(i,e,!0,r)}),t&&r&&e(n)}function cN(n,e,t){let r=t?n:n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function qa(n){return new le(n.parent===null?n.name:qa(n.parent)+"/"+n.name)}function cm(n){n.parent!==null&&uN(n.parent,n.name,n)}function uN(n,e,t){let r=lN(t),i=bt(n.node.children,e);r&&i?(delete n.node.children[e],n.node.childCount--,cm(n)):!r&&!i&&(n.node.children[e]=t.node,n.node.childCount++,cm(n))}var hN=/[\[\].#$\/\u0000-\u001F\u007F]/,dN=/[\[\].#$\u0000-\u001F\u007F]/,wg=10*1024*1024,$u=function(n){return typeof n=="string"&&n.length!==0&&!hN.test(n)},xA=function(n){return typeof n=="string"&&n.length!==0&&!dN.test(n)},fN=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),xA(n)},Va=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Lu(n)||n&&typeof n=="object"&&bt(n,".sv")},on=function(n,e,t,r){r&&e===void 0||ja(ht(n,"value"),e,t)},ja=function(n,e,t){let r=t instanceof le?new Dg(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+ri(r));if(typeof e=="function")throw new Error(n+"contains a function "+ri(r)+" with contents = "+e.toString());if(Lu(e))throw new Error(n+"contains "+e.toString()+" "+ri(r));if(typeof e=="string"&&e.length>wg/3&&oo(e)>wg)throw new Error(n+"contains a string greater than "+wg+" utf8 bytes "+ri(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,s=!1;if(Ge(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!$u(o)))throw new Error(n+" contains an invalid key ("+o+") "+ri(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);GR(r,o),ja(n,a,r),zR(r)}),i&&s)throw new Error(n+' contains ".value" child '+ri(r)+" in addition to actual children.")}},pN=function(n,e){let t,r;for(t=0;t<e.length;t++){r=e[t];let s=Aa(r);for(let o=0;o<s.length;o++)if(!(s[o]===".priority"&&o===s.length-1)){if(!$u(s[o]))throw new Error(n+"contains an invalid key ("+s[o]+") in path "+r.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(jR);let i=null;for(t=0;t<e.length;t++){if(r=e[t],i!==null&&Pt(i,r))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}},DA=function(n,e,t,r){if(r&&e===void 0)return;let i=ht(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");let s=[];Ge(e,(o,a)=>{let c=new le(o);if(ja(i,a,ve(t,c)),Nm(c)===".priority"&&!Va(a))throw new Error(i+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(c)}),pN(i,s)},Qm=function(n,e,t){if(!(t&&e===void 0)){if(Lu(e))throw new Error(ht(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Va(e))throw new Error(ht(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},Ga=function(n,e,t,r){if(!(r&&t===void 0)&&!$u(t))throw new Error(ht(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},xs=function(n,e,t,r){if(!(r&&t===void 0)&&!xA(t))throw new Error(ht(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},gN=function(n,e,t,r){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),xs(n,e,t,r)},Tt=function(n,e){if(J(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},VA=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!$u(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!fN(t))throw new Error(ht(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var um=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Qu(n,e){let t=null;for(let r=0;r<e.length;r++){let i=e[r],s=i.getPath();t!==null&&!km(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(i)}t&&n.eventLists_.push(t)}function OA(n,e,t){Qu(n,t),FA(n,r=>km(r,e))}function It(n,e,t){Qu(n,t),FA(n,r=>Pt(r,e)||Pt(e,r))}function FA(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){let i=n.eventLists_[r];if(i){let s=i.path;e(s)?(mN(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function mN(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let r=t.getEventRunner();si&&je("event: "+t.toString()),Ps(r)}}}var MA="repo_interrupt",_N=25,hm=class{constructor(e,t,r,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new um,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Eu(),this.transactionQueueTree_=new Da,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function yN(n,e,t){if(n.stats_=Pm(n.repoInfo_),n.forceRestClient_||yR())n.server_=new zg(n.repoInfo_,(r,i,s,o)=>{DI(n,r,i,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>VI(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ne(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new xm(n.repoInfo_,e,(r,i,s,o)=>{DI(n,r,i,s,o)},r=>{VI(n,r)},r=>{vN(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=wR(n.repoInfo_,()=>new Hg(n.stats_,n.server_)),n.infoData_=new Wg,n.infoSyncTree_=new Nu({startListening:(r,i,s,o)=>{let a=[],c=n.infoData_.getNode(r._path);return c.isEmpty()||(a=Ba(n.infoSyncTree_,r._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Hm(n,"connected",!1),n.serverSyncTree_=new Nu({startListening:(r,i,s,o)=>(n.server_.listen(r,s,i,(a,c)=>{let u=o(a,c);It(n.eventQueue_,r._path,u)}),[]),stopListening:(r,i)=>{n.server_.unlisten(r,i)}})}function LA(n){let t=n.infoData_.getNode(new le(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function za(n){return sN({timestamp:LA(n)})}function DI(n,e,t,r,i){n.dataUpdateCount++;let s=new le(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(r){let c=so(t,u=>Ee(u));o=ZP(n.serverSyncTree_,s,c,i)}else{let c=Ee(t);o=SA(n.serverSyncTree_,s,c,i)}else if(r){let c=so(t,u=>Ee(u));o=YP(n.serverSyncTree_,s,c)}else{let c=Ee(t);o=Ba(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=Cs(n,s)),It(n.eventQueue_,a,o)}function VI(n,e){Hm(n,"connected",e),e===!1&&TN(n)}function vN(n,e){Ge(e,(t,r)=>{Hm(n,t,r)})}function Hm(n,e,t){let r=new le("/.info/"+e),i=Ee(t);n.infoData_.updateSnapshot(r,i);let s=Ba(n.infoSyncTree_,r,i);It(n.eventQueue_,r,s)}function Hu(n){return n.nextWriteId_++}function wN(n,e,t){let r=eN(n.serverSyncTree_,e);return r!=null?Promise.resolve(r):n.server_.get(e).then(i=>{let s=Ee(i).withIndex(e._queryParams.getIndex());om(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Ba(n.serverSyncTree_,e._path,s);else{let a=xa(n.serverSyncTree_,e);o=SA(n.serverSyncTree_,e._path,s,a)}return It(n.eventQueue_,e._path,o),ku(n.serverSyncTree_,e,t,null,!0),s},i=>(Ds(n,"get for query "+Ne(e)+" failed: "+i),Promise.reject(new Error(i))))}function Ym(n,e,t,r,i){Ds(n,"set",{path:e.toString(),value:t,priority:r});let s=za(n),o=Ee(t,r),a=Gu(n.serverSyncTree_,e),c=Wm(o,a,s),u=Hu(n),d=qm(n.serverSyncTree_,e,c,u,!0);Qu(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(g,y)=>{let S=g==="ok";S||tt("set at "+e+" failed: "+g);let N=fr(n.serverSyncTree_,u,!S);It(n.eventQueue_,e,N),vr(n,i,g,y)});let p=Jm(n,e);Cs(n,p),It(n.eventQueue_,p,[])}function EN(n,e,t,r){Ds(n,"update",{path:e.toString(),value:t});let i=!0,s=za(n),o={};if(Ge(t,(a,c)=>{i=!1,o[a]=PA(ve(e,a),Ee(c),n.serverSyncTree_,s)}),i)je("update() called with empty data.  Don't do anything."),vr(n,r,"ok",void 0);else{let a=Hu(n),c=HP(n.serverSyncTree_,e,o,a);Qu(n.eventQueue_,c),n.server_.merge(e.toString(),t,(u,d)=>{let p=u==="ok";p||tt("update at "+e+" failed: "+u);let g=fr(n.serverSyncTree_,a,!p),y=g.length>0?Cs(n,e):e;It(n.eventQueue_,y,g),vr(n,r,u,d)}),Ge(t,u=>{let d=Jm(n,ve(e,u));Cs(n,d)}),It(n.eventQueue_,e,[])}}function TN(n){Ds(n,"onDisconnectEvents");let e=za(n),t=Eu();$g(n.onDisconnect_,ae(),(i,s)=>{let o=PA(i,s,n.serverSyncTree_,e);Ns(t,i,o)});let r=[];$g(t,ae(),(i,s)=>{r=r.concat(Ba(n.serverSyncTree_,i,s));let o=Jm(n,i);Cs(n,o)}),n.onDisconnect_=Eu(),It(n.eventQueue_,ae(),r)}function IN(n,e,t){n.server_.onDisconnectCancel(e.toString(),(r,i)=>{r==="ok"&&Kg(n.onDisconnect_,e),vr(n,t,r,i)})}function OI(n,e,t,r){let i=Ee(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(s,o)=>{s==="ok"&&Ns(n.onDisconnect_,e,i),vr(n,r,s,o)})}function AN(n,e,t,r,i){let s=Ee(t,r);n.server_.onDisconnectPut(e.toString(),s.val(!0),(o,a)=>{o==="ok"&&Ns(n.onDisconnect_,e,s),vr(n,i,o,a)})}function SN(n,e,t,r){if(El(t)){je("onDisconnect().update() called with empty data.  Don't do anything."),vr(n,r,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,s)=>{i==="ok"&&Ge(t,(o,a)=>{let c=Ee(a);Ns(n.onDisconnect_,ve(e,o),c)}),vr(n,r,i,s)})}function bN(n,e,t){let r;J(e._path)===".info"?r=om(n.infoSyncTree_,e,t):r=om(n.serverSyncTree_,e,t),OA(n.eventQueue_,e._path,r)}function dm(n,e,t){let r;J(e._path)===".info"?r=ku(n.infoSyncTree_,e,t):r=ku(n.serverSyncTree_,e,t),OA(n.eventQueue_,e._path,r)}function UA(n){n.persistentConnection_&&n.persistentConnection_.interrupt(MA)}function CN(n){n.persistentConnection_&&n.persistentConnection_.resume(MA)}function Ds(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),je(t,...e)}function vr(n,e,t,r){e&&Ps(()=>{if(t==="ok")e(null);else{let i=(t||"error").toUpperCase(),s=i;r&&(s+=": "+r);let o=new Error(s);o.code=i,e(o)}})}function RN(n,e,t,r,i,s){Ds(n,"transaction on "+e);let o={path:e,update:t,onComplete:r,status:null,order:LI(),applyLocally:s,retryCount:0,unwatcher:i,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Xm(n,e,void 0);o.currentInputSnapshot=a;let c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{ja("transaction failed: Data returned ",c,o.path),o.status=0;let u=Wu(n.transactionQueueTree_,e),d=ci(u)||[];d.push(o),$m(u,d);let p;typeof c=="object"&&c!==null&&bt(c,".priority")?(p=Fn(c,".priority"),V(Va(p),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):p=(Gu(n.serverSyncTree_,e)||Y.EMPTY_NODE).getPriority().val();let g=za(n),y=Ee(c,p),S=Wm(y,a,g);o.currentOutputSnapshotRaw=y,o.currentOutputSnapshotResolved=S,o.currentWriteId=Hu(n);let N=qm(n.serverSyncTree_,e,S,o.currentWriteId,o.applyLocally);It(n.eventQueue_,e,N),Yu(n,n.transactionQueueTree_)}}function Xm(n,e,t){return Gu(n.serverSyncTree_,e,t)||Y.EMPTY_NODE}function Yu(n,e=n.transactionQueueTree_){if(e||Xu(n,e),ci(e)){let t=qA(n,e);V(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&PN(n,qa(e),t)}else NA(e)&&Ku(e,t=>{Yu(n,t)})}function PN(n,e,t){let r=t.map(u=>u.currentWriteId),i=Xm(n,e,r),s=i,o=i.hash();for(let u=0;u<t.length;u++){let d=t[u];V(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;let p=lt(e,d.path);s=s.updateChild(p,d.currentOutputSnapshotRaw)}let a=s.val(!0),c=e;n.server_.put(c.toString(),a,u=>{Ds(n,"transaction put response",{path:c.toString(),status:u});let d=[];if(u==="ok"){let p=[];for(let g=0;g<t.length;g++)t[g].status=2,d=d.concat(fr(n.serverSyncTree_,t[g].currentWriteId)),t[g].onComplete&&p.push(()=>t[g].onComplete(null,!0,t[g].currentOutputSnapshotResolved)),t[g].unwatcher();Xu(n,Wu(n.transactionQueueTree_,e)),Yu(n,n.transactionQueueTree_),It(n.eventQueue_,e,d);for(let g=0;g<p.length;g++)Ps(p[g])}else{if(u==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{tt("transaction at "+c.toString()+" failed: "+u);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=u}Cs(n,e)}},o)}function Cs(n,e){let t=BA(n,e),r=qa(t),i=qA(n,t);return NN(n,i,r),r}function NN(n,e,t){if(e.length===0)return;let r=[],i=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],u=lt(t,c.path),d=!1,p;if(V(u!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,p=c.abortReason,i=i.concat(fr(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=_N)d=!0,p="maxretry",i=i.concat(fr(n.serverSyncTree_,c.currentWriteId,!0));else{let g=Xm(n,c.path,o);c.currentInputSnapshot=g;let y=e[a].update(g.val());if(y!==void 0){ja("transaction failed: Data returned ",y,c.path);let S=Ee(y);typeof y=="object"&&y!=null&&bt(y,".priority")||(S=S.updatePriority(g.getPriority()));let k=c.currentWriteId,q=za(n),B=Wm(S,g,q);c.currentOutputSnapshotRaw=S,c.currentOutputSnapshotResolved=B,c.currentWriteId=Hu(n),o.splice(o.indexOf(k),1),i=i.concat(qm(n.serverSyncTree_,c.path,B,c.currentWriteId,c.applyLocally)),i=i.concat(fr(n.serverSyncTree_,k,!0))}else d=!0,p="nodata",i=i.concat(fr(n.serverSyncTree_,c.currentWriteId,!0))}It(n.eventQueue_,t,i),i=[],d&&(e[a].status=2,(function(g){setTimeout(g,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(p==="nodata"?r.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):r.push(()=>e[a].onComplete(new Error(p),!1,null))))}Xu(n,n.transactionQueueTree_);for(let a=0;a<r.length;a++)Ps(r[a]);Yu(n,n.transactionQueueTree_)}function BA(n,e){let t,r=n.transactionQueueTree_;for(t=J(e);t!==null&&ci(r)===void 0;)r=Wu(r,t),e=fe(e),t=J(e);return r}function qA(n,e){let t=[];return jA(n,e,t),t.sort((r,i)=>r.order-i.order),t}function jA(n,e,t){let r=ci(e);if(r)for(let i=0;i<r.length;i++)t.push(r[i]);Ku(e,i=>{jA(n,i,t)})}function Xu(n,e){let t=ci(e);if(t){let r=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[r]=t[i],r++);t.length=r,$m(e,t.length>0?t:void 0)}Ku(e,r=>{Xu(n,r)})}function Jm(n,e){let t=qa(BA(n,e)),r=Wu(n.transactionQueueTree_,e);return cN(r,i=>{Eg(n,i)}),Eg(n,r),kA(r,i=>{Eg(n,i)}),t}function Eg(n,e){let t=ci(e);if(t){let r=[],i=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(V(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(V(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(fr(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&r.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?$m(e,void 0):t.length=s+1,It(n.eventQueue_,qa(e),i);for(let o=0;o<r.length;o++)Ps(r[o])}}function kN(n){let e="",t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let i=t[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function xN(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):tt(`Invalid query segment '${t}' in query '${n}'`)}return e}var fm=function(n,e){let t=DN(n),r=t.namespace;t.domain==="firebase.com"&&rn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&rn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||cR();let i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new fu(t.host,t.secure,r,i,e,"",r!==t.subdomain),path:new le(t.pathString)}},DN=function(n){let e="",t="",r="",i="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let u=n.indexOf("//");u>=0&&(a=n.substring(0,u-1),n=n.substring(u+2));let d=n.indexOf("/");d===-1&&(d=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(d,p)),d<p&&(i=kN(n.substring(d,p)));let g=xN(n.substring(Math.min(n.length,p)));u=e.indexOf(":"),u>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(u+1),10)):u=e.length;let y=e.slice(0,u);if(y.toLowerCase()==="localhost")t="localhost";else if(y.split(".").length<=2)t=y;else{let S=e.indexOf(".");r=e.substring(0,S).toLowerCase(),t=e.substring(S+1),s=r}"ns"in g&&(s=g.ns)}return{host:e,port:c,domain:t,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};var FI="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",VN=(function(){let n=0,e=[];return function(t){let r=t===n;n=t;let i,s=new Array(8);for(i=7;i>=0;i--)s[i]=FI.charAt(t%64),t=Math.floor(t/64);V(t===0,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=FI.charAt(e[i]);return V(o.length===20,"nextPushId: Length should be 20."),o}})();var xu=class{constructor(e,t,r,i){this.eventType=e,this.eventRegistration=t,this.snapshot=r,this.prevName=i}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ne(this.snapshot.exportVal())}},Du=class{constructor(e,t,r){this.eventRegistration=e,this.error=t,this.path=r}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Oa=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return V(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Vu=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new qe;return IN(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Tt("OnDisconnect.remove",this._path);let e=new qe;return OI(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Tt("OnDisconnect.set",this._path),on("OnDisconnect.set",e,this._path,!1);let t=new qe;return OI(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Tt("OnDisconnect.setWithPriority",this._path),on("OnDisconnect.setWithPriority",e,this._path,!1),Qm("OnDisconnect.setWithPriority",t,!1);let r=new qe;return AN(this._repo,this._path,e,t,r.wrapCallback(()=>{})),r.promise}update(e){Tt("OnDisconnect.update",this._path),DA("OnDisconnect.update",e,this._path,!1);let t=new qe;return SN(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var ut=class n{constructor(e,t,r,i){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=i}get key(){return Z(this._path)?null:Nm(this._path)}get ref(){return new At(this._repo,this._path)}get _queryIdentifier(){let e=TI(this._queryParams),t=Rm(e);return t==="{}"?"default":t}get _queryObject(){return TI(this._queryParams)}isEqual(e){if(e=te(e),!(e instanceof n))return!1;let t=this._repo===e._repo,r=km(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&r&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+qR(this._path)}};function Ju(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function Er(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===nn){let r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==mr)throw new Error(r);if(typeof e!="string")throw new Error(i)}if(n.hasEnd()){if(n.getIndexEndName()!==An)throw new Error(r);if(typeof t!="string")throw new Error(i)}}else if(n.getIndex()===ge){if(e!=null&&!Va(e)||t!=null&&!Va(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(V(n.getIndex()instanceof Sa||n.getIndex()===Vm,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Zu(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var At=class n extends ut{constructor(e,t){super(e,t,new Pa,!1)}get parent(){let e=sA(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},Rs=class n{constructor(e,t,r){this._node=e,this.ref=t,this._index=r}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new le(e),r=wr(this.ref,e);return new n(this._node.getChild(t),r,ge)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(r,i)=>e(new n(i,wr(this.ref,r),ge)))}hasChild(e){let t=new le(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Zm(n,e){return n=te(n),n._checkNotDeleted("ref"),e!==void 0?wr(n._root,e):n._root}function e_(n,e){n=te(n),n._checkNotDeleted("refFromURL");let t=fm(e,n._repo.repoInfo_.nodeAdmin);VA("refFromURL",t);let r=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&r.host!==n._repo.repoInfo_.host&&rn("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+n._repo.repoInfo_.host+")"),Zm(n,t.path.toString())}function wr(n,e){return n=te(n),J(n._path)===null?gN("child","path",e,!1):xs("child","path",e,!1),new At(n._repo,ve(n._path,e))}function GA(n,e){n=te(n),Tt("push",n._path),on("push",e,n._path,!0);let t=LA(n._repo),r=VN(t),i=wr(n,r),s=wr(n,r),o;return e!=null?o=eh(s,e).then(()=>s):o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function zA(n){return Tt("remove",n._path),eh(n,null)}function eh(n,e){n=te(n),Tt("set",n._path),on("set",e,n._path,!1);let t=new qe;return Ym(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function WA(n,e){n=te(n),Tt("setPriority",n._path),Qm("setPriority",e,!1);let t=new qe;return Ym(n._repo,ve(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function KA(n,e,t){if(Tt("setWithPriority",n._path),on("setWithPriority",e,n._path,!1),Qm("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let r=new qe;return Ym(n._repo,n._path,e,t,r.wrapCallback(()=>{})),r.promise}function $A(n,e){DA("update",e,n._path,!1);let t=new qe;return EN(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function QA(n){n=te(n);let e=new Oa(()=>{}),t=new Fa(e);return wN(n._repo,n,t).then(r=>new Rs(r,new At(n._repo,n._path),n._queryParams.getIndex()))}var Fa=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let r=t._queryParams.getIndex();return new xu("value",this,new Rs(e.snapshotNode,new At(t._repo,t._path),r))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Du(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},Ou=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Du(this,e,t):null}createEvent(e,t){V(e.childName!=null,"Child events should have a childName.");let r=wr(new At(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new xu(e.type,this,new Rs(e.snapshotNode,r,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Wa(n,e,t,r,i){let s;if(typeof r=="object"&&(s=void 0,i=r),typeof r=="function"&&(s=r),i&&i.onlyOnce){let c=t,u=(d,p)=>{dm(n._repo,n,a),c(d,p)};u.userCallback=t.userCallback,u.context=t.context,t=u}let o=new Oa(t,s||void 0),a=e==="value"?new Fa(o):new Ou(e,o);return bN(n._repo,n,a),()=>dm(n._repo,n,a)}function th(n,e,t,r){return Wa(n,"value",e,t,r)}function t_(n,e,t,r){return Wa(n,"child_added",e,t,r)}function n_(n,e,t,r){return Wa(n,"child_changed",e,t,r)}function r_(n,e,t,r){return Wa(n,"child_moved",e,t,r)}function i_(n,e,t,r){return Wa(n,"child_removed",e,t,r)}function s_(n,e,t){let r=null,i=t?new Oa(t):null;e==="value"?r=new Fa(i):e&&(r=new Ou(e,i)),dm(n._repo,n,r)}var St=class{},Fu=class extends St{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){on("endAt",this._value,e._path,!0);let t=Gg(e._queryParams,this._value,this._key);if(Zu(t),Er(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function HA(n,e){return Ga("endAt","key",e,!0),new Fu(n,e)}var pm=class extends St{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){on("endBefore",this._value,e._path,!1);let t=oP(e._queryParams,this._value,this._key);if(Zu(t),Er(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function YA(n,e){return Ga("endBefore","key",e,!0),new pm(n,e)}var Mu=class extends St{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){on("startAt",this._value,e._path,!0);let t=jg(e._queryParams,this._value,this._key);if(Zu(t),Er(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function XA(n=null,e){return Ga("startAt","key",e,!0),new Mu(n,e)}var gm=class extends St{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){on("startAfter",this._value,e._path,!1);let t=sP(e._queryParams,this._value,this._key);if(Zu(t),Er(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new ut(e._repo,e._path,t,e._orderByCalled)}};function JA(n,e){return Ga("startAfter","key",e,!0),new gm(n,e)}var mm=class extends St{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new ut(e._repo,e._path,rP(e._queryParams,this._limit),e._orderByCalled)}};function ZA(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new mm(n)}var _m=class extends St{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new ut(e._repo,e._path,iP(e._queryParams,this._limit),e._orderByCalled)}};function e0(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new _m(n)}var ym=class extends St{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Ju(e,"orderByChild");let t=new le(this._path);if(Z(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new Sa(t),i=Uu(e._queryParams,r);return Er(i),new ut(e._repo,e._path,i,!0)}};function t0(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return xs("orderByChild","path",n,!1),new ym(n)}var vm=class extends St{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Ju(e,"orderByKey");let t=Uu(e._queryParams,nn);return Er(t),new ut(e._repo,e._path,t,!0)}};function n0(){return new vm}var wm=class extends St{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Ju(e,"orderByPriority");let t=Uu(e._queryParams,ge);return Er(t),new ut(e._repo,e._path,t,!0)}};function r0(){return new wm}var Em=class extends St{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Ju(e,"orderByValue");let t=Uu(e._queryParams,Vm);return Er(t),new ut(e._repo,e._path,t,!0)}};function i0(){return new Em}var Tm=class extends St{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(on("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Fu(this._value,this._key)._apply(new Mu(this._value,this._key)._apply(e))}};function s0(n,e){return Ga("equalTo","key",e,!0),new Tm(n,e)}function kt(n,...e){let t=te(n);for(let r of e)t=r._apply(t);return t}qP(At);KP(At);var ON="FIREBASE_DATABASE_EMULATOR_HOST",Im={},FN=!1;function MN(n,e,t,r){let i=e.lastIndexOf(":"),s=e.substring(0,i),o=vi(s);n.repoInfo_=new fu(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function o_(n,e,t,r,i){let s=r||n.options.databaseURL;s===void 0&&(n.options.projectId||rn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),je("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=fm(s,i),a=o.repoInfo,c,u;typeof process<"u"&&process.env&&(u=process.env[ON]),u?(c=!0,s=`http://${u}?ns=${a.namespace}`,o=fm(s,i),a=o.repoInfo):c=!o.repoInfo.secure;let d=i&&c?new va(va.OWNER):new Cg(n.name,n.options,e);VA("Invalid Firebase Database URL",o),Z(o.path)||rn("Database URL must point to the root of a Firebase Database (not including a child path).");let p=UN(a,n,d,new bg(n,t));return new Am(p,n)}function LN(n,e){let t=Im[e];(!t||t[n.key]!==n)&&rn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),UA(n),delete t[n.key]}function UN(n,e,t,r){let i=Im[e.name];i||(i={},Im[e.name]=i);let s=i[n.toURLString()];return s&&rn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new hm(n,FN,t,r),i[n.toURLString()]=s,s}var Am=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(yN(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new At(this._repo,ae())),this._rootInternal}_delete(){return this._rootInternal!==null&&(LN(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&rn("Cannot call "+e+" on a deleted database.")}};function o0(){iA.IS_TRANSPORT_INITIALIZED&&tt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function a0(){o0(),Ia.forceDisallow()}function l0(){o0(),ys.forceDisallow(),Ia.forceAllow()}function c0(n,e,t,r={}){n=te(n),n._checkNotDeleted("useEmulator");let i=`${e}:${t}`,s=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&wi(r,s.repoInfo_.emulatorOptions))return;rn("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)r.mockUserToken&&rn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new va(va.OWNER);else if(r.mockUserToken){let a=typeof r.mockUserToken=="string"?r.mockUserToken:_l(r.mockUserToken,n.app.options.projectId);o=new va(a)}vi(e)&&(ml(e),yl("Database",!0)),MN(s,i,r,o)}function u0(n){n=te(n),n._checkNotDeleted("goOffline"),UA(n._repo)}function h0(n){n=te(n),n._checkNotDeleted("goOnline"),CN(n._repo)}function d0(n,e){BI(n,e)}function BN(n){Cm(Al),Cr(new _t("database",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return o_(r,i,s,t)},"PUBLIC").setMultipleInstances(!0)),Dt(sI,oI,n),Dt(sI,oI,"esm2017")}var qN={".sv":"timestamp"};function f0(){return qN}function p0(n){return{".sv":{increment:n}}}var Sm=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function g0(n,e,t){var r;if(n=te(n),Tt("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let i=(r=t?.applyLocally)!==null&&r!==void 0?r:!0,s=new qe,o=(c,u,d)=>{let p=null;c?s.reject(c):(p=new Rs(d,new At(n._repo,n._path),ge),s.resolve(new Sm(u,p)))},a=th(n,()=>{});return RN(n._repo,n._path,e,o,a,i),s.promise}xm.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};xm.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};BN();var jN="@firebase/database-compat",GN="2.0.11";var zN=new Mn("@firebase/database-compat"),m0=function(n){let e="FIREBASE WARNING: "+n;zN.warn(e)};var WN=function(n,e,t,r){if(!(r&&t===void 0)&&typeof t!="boolean")throw new Error(ht(n,e)+"must be a boolean.")},KN=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(ht(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var a_=class{constructor(e){this._delegate=e}cancel(e){W("OnDisconnect.cancel",0,1,arguments.length),Fe("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),r=>e(r)),t}remove(e){W("OnDisconnect.remove",0,1,arguments.length),Fe("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),r=>e(r)),t}set(e,t){W("OnDisconnect.set",1,2,arguments.length),Fe("OnDisconnect.set","onComplete",t,!0);let r=this._delegate.set(e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){W("OnDisconnect.setWithPriority",2,3,arguments.length),Fe("OnDisconnect.setWithPriority","onComplete",r,!0);let i=this._delegate.setWithPriority(e,t);return r&&i.then(()=>r(null),s=>r(s)),i}update(e,t){if(W("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,m0("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Fe("OnDisconnect.update","onComplete",t,!0);let r=this._delegate.update(e);return t&&r.then(()=>t(null),i=>t(i)),r}};var l_=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return W("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var ui=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return W("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return W("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return W("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return W("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return W("DataSnapshot.child",0,1,arguments.length),e=String(e),xs("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return W("DataSnapshot.hasChild",1,1,arguments.length),xs("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return W("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return W("DataSnapshot.forEach",1,1,arguments.length),Fe("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return W("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return W("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return W("DataSnapshot.ref",0,0,arguments.length),new Sn(this._database,this._delegate.ref)}get ref(){return this.getRef()}},nh=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,r,i){var s;W("Query.on",2,4,arguments.length),Fe("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",r,i),a=(u,d)=>{t.call(o.context,new ui(this.database,u),d)};a.userCallback=t,a.context=o.context;let c=(s=o.cancel)===null||s===void 0?void 0:s.bind(o.context);switch(e){case"value":return th(this._delegate,a,c),t;case"child_added":return t_(this._delegate,a,c),t;case"child_removed":return i_(this._delegate,a,c),t;case"child_changed":return n_(this._delegate,a,c),t;case"child_moved":return r_(this._delegate,a,c),t;default:throw new Error(ht("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,r){if(W("Query.off",0,3,arguments.length),KN("Query.off",e,!0),Fe("Query.off","callback",t,!0),Vh("Query.off","context",r,!0),t){let i=()=>{};i.userCallback=t,i.context=r,s_(this._delegate,e,i)}else s_(this._delegate,e)}get(){return QA(this._delegate).then(e=>new ui(this.database,e))}once(e,t,r,i){W("Query.once",1,4,arguments.length),Fe("Query.once","callback",t,!0);let s=n.getCancelAndContextArgs_("Query.once",r,i),o=new qe,a=(u,d)=>{let p=new ui(this.database,u);t&&t.call(s.context,p,d),o.resolve(p)};a.userCallback=t,a.context=s.context;let c=u=>{s.cancel&&s.cancel.call(s.context,u),o.reject(u)};switch(e){case"value":th(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":t_(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":i_(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":n_(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":r_(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(ht("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return W("Query.limitToFirst",1,1,arguments.length),new n(this.database,kt(this._delegate,ZA(e)))}limitToLast(e){return W("Query.limitToLast",1,1,arguments.length),new n(this.database,kt(this._delegate,e0(e)))}orderByChild(e){return W("Query.orderByChild",1,1,arguments.length),new n(this.database,kt(this._delegate,t0(e)))}orderByKey(){return W("Query.orderByKey",0,0,arguments.length),new n(this.database,kt(this._delegate,n0()))}orderByPriority(){return W("Query.orderByPriority",0,0,arguments.length),new n(this.database,kt(this._delegate,r0()))}orderByValue(){return W("Query.orderByValue",0,0,arguments.length),new n(this.database,kt(this._delegate,i0()))}startAt(e=null,t){return W("Query.startAt",0,2,arguments.length),new n(this.database,kt(this._delegate,XA(e,t)))}startAfter(e=null,t){return W("Query.startAfter",0,2,arguments.length),new n(this.database,kt(this._delegate,JA(e,t)))}endAt(e=null,t){return W("Query.endAt",0,2,arguments.length),new n(this.database,kt(this._delegate,HA(e,t)))}endBefore(e=null,t){return W("Query.endBefore",0,2,arguments.length),new n(this.database,kt(this._delegate,YA(e,t)))}equalTo(e,t){return W("Query.equalTo",1,2,arguments.length),new n(this.database,kt(this._delegate,s0(e,t)))}toString(){return W("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return W("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(W("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,r){let i={cancel:void 0,context:void 0};if(t&&r)i.cancel=t,Fe(e,"cancel",i.cancel,!0),i.context=r,Vh(e,"context",i.context,!0);else if(t)if(typeof t=="object"&&t!==null)i.context=t;else if(typeof t=="function")i.cancel=t;else throw new Error(ht(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return i}get ref(){return new Sn(this.database,new At(this._delegate._repo,this._delegate._path))}},Sn=class n extends nh{constructor(e,t){super(e,new ut(t._repo,t._path,new Pa,!1)),this.database=e,this._delegate=t}getKey(){return W("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return W("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,wr(this._delegate,e))}getParent(){W("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return W("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){W("Reference.set",1,2,arguments.length),Fe("Reference.set","onComplete",t,!0);let r=eh(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}update(e,t){if(W("Reference.update",1,2,arguments.length),Array.isArray(e)){let i={};for(let s=0;s<e.length;++s)i[""+s]=e[s];e=i,m0("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Tt("Reference.update",this._delegate._path),Fe("Reference.update","onComplete",t,!0);let r=$A(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}setWithPriority(e,t,r){W("Reference.setWithPriority",2,3,arguments.length),Fe("Reference.setWithPriority","onComplete",r,!0);let i=KA(this._delegate,e,t);return r&&i.then(()=>r(null),s=>r(s)),i}remove(e){W("Reference.remove",0,1,arguments.length),Fe("Reference.remove","onComplete",e,!0);let t=zA(this._delegate);return e&&t.then(()=>e(null),r=>e(r)),t}transaction(e,t,r){W("Reference.transaction",1,3,arguments.length),Fe("Reference.transaction","transactionUpdate",e,!1),Fe("Reference.transaction","onComplete",t,!0),WN("Reference.transaction","applyLocally",r,!0);let i=g0(this._delegate,e,{applyLocally:r}).then(s=>new l_(s.committed,new ui(this.database,s.snapshot)));return t&&i.then(s=>t(null,s.committed,s.snapshot),s=>t(s,!1,null)),i}setPriority(e,t){W("Reference.setPriority",1,2,arguments.length),Fe("Reference.setPriority","onComplete",t,!0);let r=WA(this._delegate,e);return t&&r.then(()=>t(null),i=>t(i)),r}push(e,t){W("Reference.push",0,2,arguments.length),Fe("Reference.push","onComplete",t,!0);let r=GA(this._delegate,e),i=r.then(o=>new n(this.database,o));t&&i.then(()=>t(null),o=>t(o));let s=new n(this.database,r);return s.then=i.then.bind(i),s.catch=i.catch.bind(i,void 0),s}onDisconnect(){return Tt("Reference.onDisconnect",this._delegate._path),new a_(new Vu(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var hi=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:a0,forceLongPolling:l0}}useEmulator(e,t,r={}){c0(this._delegate,e,t,r)}ref(e){if(W("database.ref",0,1,arguments.length),e instanceof Sn){let t=e_(this._delegate,e.toString());return new Sn(this,t)}else{let t=Zm(this._delegate,e);return new Sn(this,t)}}refFromURL(e){W("database.refFromURL",1,1,arguments.length);let r=e_(this._delegate,e);return new Sn(this,r)}goOffline(){return W("database.goOffline",0,0,arguments.length),u0(this._delegate)}goOnline(){return W("database.goOnline",0,0,arguments.length),h0(this._delegate)}};hi.ServerValue={TIMESTAMP:f0(),increment:n=>p0(n)};function $N({app:n,url:e,version:t,customAuthImpl:r,customAppCheckImpl:i,namespace:s,nodeAdmin:o=!1}){Cm(t);let a=new Oh("database-standalone"),c=new Tl("auth-internal",a);c.setComponent(new _t("auth-internal",()=>r,"PRIVATE"));let u;return i&&(u=new Tl("app-check-internal",a),u.setComponent(new _t("app-check-internal",()=>i,"PRIVATE"))),{instance:new hi(o_(n,c,u,e,o),n),namespace:s}}var QN=Object.freeze({__proto__:null,initStandalone:$N});var HN=hi.ServerValue;function YN(n){n.INTERNAL.registerComponent(new _t("database-compat",(e,{instanceIdentifier:t})=>{let r=e.getProvider("app-compat").getImmediate(),i=e.getProvider("database").getImmediate({identifier:t});return new hi(i,r)},"PUBLIC").setServiceProps({Reference:Sn,Query:nh,Database:hi,DataSnapshot:ui,enableLogging:d0,INTERNAL:QN,ServerValue:HN}).setMultipleInstances(!0)),n.registerVersion(jN,GN)}YN(Me);function Ka(n,e,t="on",r=_i){return new Nn(i=>{let s=null;return s=n[t](e,(o,a)=>{r.schedule(()=>{i.next({snapshot:o,prevKey:a})}),t==="once"&&r.schedule(()=>i.complete())},o=>{r.schedule(()=>i.error(o))}),t==="on"?{unsubscribe(){s!=null&&n.off(e,s)}}:{unsubscribe(){}}}).pipe(Ie(i=>{let{snapshot:s,prevKey:o}=i,a=null;return s.exists()&&(a=s.key),{type:e,payload:s,prevKey:o,key:a}}),fy())}function XN(n){return typeof n=="string"}function JN(n){return typeof n.exportVal=="function"}function E0(n){return n==null}function T0(n){return typeof n.set=="function"}function _0(n,e){return T0(e)?e:n.ref(e)}function I0(n,e){if(XN(n))return e.stringCase();if(T0(n))return e.firebaseCase();if(JN(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function A0(n){return(E0(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function S0(n,e,t){e=A0(e);let r=e.map(i=>Ka(n,i,"on",t));return to(...r)}function ZN(n,e,t){let r=S0(n,e).pipe(br((i,s)=>[...i,s],[]));return tk(n,r,t)}function ek(n,e){return Ka(n,"value","on",e).pipe(Ie(t=>{let r;return t.payload.forEach(i=>(r=i.key,!1)),{data:t,lastKeyToLoad:r}}))}function tk(n,e,t){return ek(n,t).pipe(gy(e),Ie(([i,s])=>{let o=i.lastKeyToLoad,a=s.map(c=>c.key);return{actions:s,lastKeyToLoad:o,loadedKeys:a}}),py(i=>i.loadedKeys.indexOf(i.lastKeyToLoad)===-1),Ie(i=>i.actions))}function y0(n,e){return function(r,i){return I0(r,{stringCase:()=>n.child(r)[e](i),firebaseCase:()=>r[e](i),snapshotCase:()=>r.ref[e](i)})}}function nk(n){return function(t){return t?I0(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function rk(n,e,t){return Ka(n,"value","once",t).pipe(un(r=>{let i=[jt(r)];return e.forEach(s=>i.push(Ka(n,s,"on",t))),to(...i).pipe(br(sk,[]))}),hl())}function b0(n,e){let t=n.length;for(let r=0;r<t;r++)if(n[r].payload.key===e)return r;return-1}function ik(n,e){if(E0(e))return 0;{let t=b0(n,e);return t===-1?n.length:t+1}}function sk(n,e){let{payload:t,prevKey:r,key:i}=e,s=b0(n,i),o=ik(n,r);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(c=>{let u={payload:c,type:"value",prevKey:a,key:c.key};return a=c.key,n=[...n,u],!1})}return n;case"child_added":if(s>-1)(n[s-1]?.key||null)!==r&&(n=n.filter(c=>c.payload.key!==t.key),n.splice(o,0,e));else{if(r==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===i?e:a);case"child_moved":if(s>-1){let a=n.splice(s,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function v0(n,e,t){return e=A0(e),rk(n,e,t)}function ok(n,e,t){let r=e.schedulers.outsideAngular,i=it(We).run(()=>n.ref);return{query:n,update:y0(i,"update"),set:y0(i,"set"),push:s=>i.push(s),remove:nk(i),snapshotChanges(s){return v0(n,s,r).pipe(Se(t))},stateChanges(s){return S0(n,s,r).pipe(Se(t))},auditTrail(s){return ZN(n,s,r).pipe(Se(t))},valueChanges(s,o){return v0(n,s,r).pipe(Ie(c=>c.map(u=>o&&o.idField?Zs(mi({},u.payload.val()),{[o.idField]:u.key}):u.payload.val())),Se(t))}}}function w0(n,e){return function(){return Ka(n,"value","on",e)}}function ak(n,e,t){return{query:n,snapshotChanges(){return w0(n,e.schedulers.outsideAngular)().pipe(Se(t))},update(r){return n.ref.update(r)},set(r){return n.ref.set(r)},remove(){return n.ref.remove()},valueChanges(){return w0(n,e.schedulers.outsideAngular)().pipe(Se(t),Ie(i=>i.payload.exists()?i.payload.val():null))}}}var lk=new Be("angularfire2.realtimeDatabaseURL"),ck=new Be("angularfire2.database.use-emulator"),uk=(()=>{class n{schedulers;database;injector=it(hn);constructor(t,r,i,s,o,a,c,u,d,p,g,y,S,N,k){this.schedulers=a;let q=c,B=Pr(t,o,r);u&&mo(B,o,d,g,y,S,p,N),this.database=Ei(`${B.name}.database.${i}`,"AngularFireDatabase",B.name,()=>{let O=o.runOutsideAngular(()=>B.database(i||void 0));return q&&O.useEmulator(...q),O},[q])}list(t,r){let i=it(We).runOutsideAngular(()=>_0(this.database,t)),s=i;return r&&(s=r(i)),ok(s,this,this.injector)}object(t){let r=it(We).runOutsideAngular(()=>_0(this.database,t));return ak(r,this,this.injector)}createPushId(){return it(We).runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(r){return new(r||n)(K(Ln),K(Un,8),K(lk,8),K(Vn),K(We),K(Rr),K(ck,8),K(_o,8),K(co,8),K(uo,8),K(ho,8),K(fo,8),K(po,8),K(go,8),K(qn,8))};static \u0275prov=xn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),ID=(()=>{class n{constructor(){Me.registerVersion("angularfire",zt.full,"rtdb-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=On({type:n});static \u0275inj=Dn({providers:[uk]})}return n})();var bD={production:!1,firebase:{apiKey:"********************************",authDomain:"********************************",projectId:"********************************",storageBucket:"********************************",messagingSenderId:"********************************",appId:"********************************",measurementId:"********************************"}};export{Pk as a,bD as b,_o as c,fx as d,Qx as e,ID as f};
